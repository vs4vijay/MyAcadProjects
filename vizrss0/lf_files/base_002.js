(function(a){a.widget("ui.AdRobot",{tile:1,ord:Math.floor(Math.random()*90000000)+10000000,fake_tile:1,fake_ord:Math.floor(Math.random()*90000000)+10000000,status:{},marquee_running:false,marquee_config:null,marquee_configs:{},interstitial_running:false,previous_skin_css_url:"",queued_ads:{},debug_mode:false,callback_methods:{},ad_info_visible:false,rightBarFixer:{running:false,start:function(b){this.running=true;jQuery("#rightbar_list_container").css({position:"relative",top:"-250px"});jQuery("#rightcontainer .rightbar_list").css({"margin-top":"250px"});jQuery("#rightcontainer .cn_pager.lower").css({bottom:"-2px"});jQuery(b).css({height:"250px"})},stop:function(b){this.running=false;jQuery("#rightbar_list_container").css({position:"static",top:"0px"});jQuery("#rightcontainer .rightbar_list").css({"margin-top":"0px"});jQuery("#rightcontainer .cn_pager.lower").css({bottom:"0px"})},fix:function(){if(this.running===true){var g=jQuery("#rightcontainer .inner");var e=jQuery(".inner .ad_300x250.rightbar");var f=jQuery("#rightbar_scroller");if(f[0].scrollTop===0){g.css({overflow:"visible"});e.css({"margin-top":"0px"});jQuery("#rightbar_list_container").css({top:"-250px"})}else{var b=Math.max(250-f[0].scrollTop,0);g.css({overflow:"hidden"});e.css({"margin-top":(-1*f[0].scrollTop)+"px"});var d=Math.min(f[0].scrollTop-250,0);jQuery("#rightbar_list_container").css({top:d+"px"})}}}},setIframeDimensions:function(d,e,b){jQuery(d).attr({width:e,height:b})},initialize:function(){jQuery.writeCapture.writeOnGetElementById=true;jQuery.writeCapture.autoAsync();var d=this;jQuery(document).ready(function(){d.checkStickyPreview()});jQuery(window).bind("maincontent.load",jQuery.proxy(this.resetDartParams,this));this.subscribeForEvent("maincontent.classicfrontpageloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.postloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.mainContentLoaded.bind(this));var e=window.location.href.match(/\?(.+)$/);if(e!==null){var b=window.gawker_parseQueryString(e[1]);if(b.addebug!==undefined){this.debug_mode=true}}jQuery(window).trigger("ad.adrobot.ready")},mainContentLoaded:function(b){if(!this.isFrontpage()){jQuery(".front_300x250").closest(".ad_300x250.rightbar").remove()}},resetDartParams:function(){this.tile=1;this.ord=this.generateOrd()},getDartParams:function(b){var d=[];d.push("sz="+b);if(b=="80x45"){d.push("tile="+this.fake_tile++);d.push("ord="+this.generateOrd())}else{d.push("tile="+this.tile++);d.push("ord="+this.ord)}return d},generateOrd:function(){return Math.floor(Math.random()*90000000)+10000000},checkStickyPreview:function(){var f=jQuery.cookie("GANJAFORCEVIEWDIR");if(f&&f!=="deleted"){var d=jQuery.cookie("GANJAFORCEVIEW");if(jQuery("#errorbar").length===0){var e=jQuery('<div id="errorbar" style="display: none;" />');e.append("This is a persistent skin preview for <strong>"+d+'</strong> showing on all pages. <a class="nocapture" href="/index.php?op=takeover_preview&view=default">Click here to return to normal.</a><br />');e.append('Preview for this page only: <input id="skin_preview_url" type="text" value="" style="width: 400px;"/>');jQuery("body").prepend(e)}jQuery("#errorbar").show();jQuery("#main-container").addClass("skinpreview");jQuery("#skin_preview_url").val(document.location+"?view="+d);var b=f;this.setSkinCSS(b+this.options.takeover_css_name)}},setSkinCSS:function(b){if(window.hyperionOptions!==undefined){return false}if(this.skinNeedsToChange(b)||b===""){var d=jQuery("head .takeover_css");if(b===""){d.remove()}else{jQuery.cookie("interstitial_count",0,{path:"/"});if(d.length===0){jQuery("head").append('<link class="takeover_css" rel="stylesheet" type="text/css" href="'+b+'">')}else{d.eq(0).attr("href",b)}}this.previous_skin_css_url=b;return true}else{return false}},skinNeedsToChange:function(b){var d=jQuery(".takeover_css");if(d.length===1){var e=d.eq(0).attr("href").split("?");if(e[0]===b){return false}}if(b!==this.previous_skin_css_url){return true}return false},marqueeConfig:function(d,b){if(this.marquee_configs[d]===undefined){this.marquee_configs[d]=b}},runMarquee:function(b){if(this.marquee_configs[b]!==undefined){this.marquee_config=this.marquee_configs[b];jQuery(document).trigger("ad.marquee.run");return this.marquee_config.marquee_should_run===true}return false},checkMarquee:function(b){if(this.marquee_configs[b]!==undefined){return this.marquee_configs[b].marquee_should_run===true}return false},queueAdRun:function(d,b){this.queued_ads[d]=b},runAdBySelector:function(b){var e=jQuery(b);if(e.length){var d=e.eq(0).attr("id").replace("ad_container_","");this.runAdFromQueue(d)}},runAdFromQueue:function(d){if(!this.queued_ads[d]){return false}var b=jQuery("#ad_container_"+d);if(b.length>0){b.AdUnit(this.queued_ads[d]);delete this.queued_ads[d]}},showAdInfo:function(b){if(b===true&&!this.ad_info_visible){return}var d={ad_random:"Random ID",size:"Size",hyperion_url:"Hyperion URL",zone:"Zone",keywords:"Keywords",dart_url:"DART URL",dart_params:"DART params",empty_ad:"Empty ad"};
jQuery(".ad_container").each(function(k,m){var p=null;var j=[];var r=jQuery(m);var g=r.data("ad_info");var k=0,q=0,h=0,n=0,o=null,s=0;var e=null;if(g!==undefined){var f=g[0].ad_random;if(jQuery("div#ad_info_"+f).length===0){h=g.length;k=h-1;if(window.adRobot.debug_mode===true){k=0}for(;k<h;k++){if(s>0){j.push("<hr />")}s++;for(p in d){if(d.hasOwnProperty(p)&&g[k].hasOwnProperty(p)){for(q=0,n=g[k][p].length;q<n;q++){if(g[k][p][q]!=undefined){e=d[p];o=g[k][p][q];if(p.indexOf("_url")>=0){j.push("<div><strong>"+e+'</strong>: <a href="'+o+'">'+o+"</a></div>")}else{j.push("<div><strong>"+e+"</strong>: "+o+"</div>")}}}}}}r.before('<div id="ad_info_'+f+'" class="ad_info" style="display: none;"></div>').prev("div .ad_info").html(j.join("\n"));if(r.closest(".ad_marquee").length>0){if(jQuery("#skin_ad_info").length===0){jQuery(".ad_marquee").before('<div id="skin_ad_info"></div>')}r.prev(".ad_info").appendTo(jQuery("#skin_ad_info"))}if(r.closest(".stamp_container").length>0){r.prev(".ad_info").prependTo(r.closest("li"))}}}});if(b!==true){this.ad_info_visible=!this.ad_info_visible}jQuery(".ad_info").toggle(this.ad_info_visible)},trackerTest:function(d){var b=0;var h={takeover:{label:"Takeover",selector:".ad_marquee .ad_container.takeover"},marquee:{label:"Marquee",selector:".ad_marquee .ad_container.marquee"},"7th_story":{label:"7th Story",selector:".sponsored_splash_post .ad_tracker-rightbar-sp .ad_container, .splashposts .post .ad_tracker-rightbar-sp .ad_container"},sidebar:{label:"Sidebar",selector:".rightbar_list .sponsored .ad_tracker-rightbar-sp .ad_container, #rightbar .sponsored .ad_tracker-rightbar-sp .ad_container"}};var f,e,g=null;for(e in h){if(h.hasOwnProperty(e)&&(d===undefined||d===e)){g=a(h[e].selector);for(b=0;b<g.length;b++){f=g.eq(b).data("ad_info");if(f!==undefined){if(d===undefined){this.logInfo(h[e].label+" Tracker",f)}else{return true}}}}}return false},logInfo:function(b,e){var f={size:"Size",dart_url:"DART URL",status:"Status"};var d=0;window.console.group(b);for(key in f){if(f.hasOwnProperty(key)){for(d=(e.length-1);d>=0;d--){if(e[d][key]!=undefined){window.console.log(f[key]+": "+e[d][key][e[d][key].length-1]);break}}}}window.console.groupEnd()},isFrontpage:function(){return(window.pageType==="frontpage"||window.pageType==="classic_frontpage"||window.pageType==="splash_post")},delay300x250:function(){return((this.marquee_config!==null&&this.marquee_config.marquee_should_run)||this.marquee_running||this.interstitial_running)},loadAdsense:function(){if(!this.ads_script){var b=this.ads_script=new Promise;gawker_getScript("http://www.google.com/jsapi").then(function(){google.load("ads","1",{callback:function(){b.resolve()}})})}return this.ads_script},initAdsense:function(d,b){if(!d&&b&&b[0]){d=b[0]}if(jQuery("#ad-unit-inner").length>0&&!SocialButtons.thirdpartyDisabled){this.loadAdsense().then(function(){if(typeof google!=="undefined"){var e={format:"468x60",ad_slot:"8492826073",ad_type:"text",hints:d};new google.ads.Ad("ca-pub-0457527031304647","ad-unit-inner",e)}})}}});a.extend(a.ui.AdRobot,{version:"1.0",defaults:{adserver_host:"localhost:8800",controlClass:"ad_control",takeover_css_name:"style.css"}})}(jQuery));(function(a){a.widget("ui.AdUnitAncestor",{xhr:null,default_sizes:["300x600","640x360","300x250"],refreshable_variants:["300x250_rightbar","300x250_inpost","300x600_inpost"],hyperion_url:"",dart_url:"",status:[],iteration:0,ad_conditions:{},special_togglers:{"80x45_default":{show:{right_on:function(b){var d=this.options.selectors;jQuery(b).closest(d["80x45_container"]).hover(function(){var f=jQuery(this).height();jQuery(this).height(f+"px");jQuery(d.thumb_container,jQuery(this)).hide();jQuery(".stamp_container",jQuery(this)).show()},function(){jQuery(d.thumb_container,jQuery(this)).show();jQuery(".stamp_container",jQuery(this)).hide()}).css({"min-height":"60px"});var e=jQuery(b+" img").attr("alt");if(e!=="Click here to find out more!"){jQuery(".broughtby",jQuery(b).closest(d["80x45_text"])).html(e)}}},hide:{right_on:function(b){}}},"300x250_inpost":{show:{right_on:function(b){var e=jQuery(b).find("iframe");var d=e.contents().find("body > div");if(d.length){e.attr({height:d.height()})}}}},"300x600_inpost":{show:{right_on:function(b){var e=0,d=0;var f=jQuery("iframe",jQuery(b));var g=f.contents().find("embed, img");for(e=0,d=g.length;e<d;e++){if(parseInt(g.eq(e).attr("width"),10)===160){f.attr({width:160});return true}}}}},"660x300_default":{show:{right_on:function(b){window.adRobot.interstitial_running=true;jQuery.cookie("interstitial_shown","true",{expires:(24*60*60),path:"/"});jQuery("#interstitial_bottom").show()}},hide:{right_on:function(b){window.adRobot.interstitial_running=false;jQuery("#interstitial_bottom").hide();jQuery(document).trigger("ad.inpost300.refresh")}}},"640x360_default":{show:{right_on:function(d){jQuery("body").removeClass("panorama-resized");var b=jQuery(d).find("iframe").contents().find(".pano");if(b.length){jQuery(d).find("iframe").attr({height:b.height()})}else{var e=jQuery(d).find("iframe").contents().find("body > a > img");
if(e.length){jQuery(d).find("iframe").attr({height:e.height()})}}}},hide:{right_on:function(b){window.adRobot.runAdBySelector(".ad_container.panorama")}}},"300x250_panorama":{show:{right_on:function(b){jQuery("body").addClass("panorama-resized");jQuery(b).closest(".ad_300x250").before('<div style="clear: both;"></div>')}},hide:{right_on:function(b){jQuery("body").removeClass("panorama-resized")}}}},initialize:function(){this.xhr=new XHR({klass:"adunit",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this),timeout:5000});this.setTogglers();this.options.original_size=this.options.size;this.options.dart_params=window.adRobot.getDartParams(this.options.original_size);this.options.size_variant=this.options.size+"_"+this.options.variant;this.options.target_selector="#ad_container_"+this.options.random;if(this.options.size_variant==="300x250_rightbar"&&window.post_data!==undefined&&window.post_data.hyperion!==undefined){this.options=a.extend({},window.post_data.hyperion,this.options)}this.addAdInfo("ad_random",this.options.random);this.addAdInfo("size",this.options.original_size);if(this.default_sizes.indexOf(this.options.size)>-1){this.options.size="defaults"}if(this.options.size_variant==="300x250_rightbar"){jQuery(window).bind("maincontent.load",jQuery.proxy(this.getDartParams,this));this.subscribeForEvent("maincontent.frontpageloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.classicfrontpageloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.postloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.mainContentLoaded.bind(this));jQuery(document).bind("ad.marquee.finished",jQuery.proxy(this.marqueeEventHandler,this))}var b=["660x300_default","300x600_inpost","300x250_inpost"];if(b.indexOf(this.options.size_variant)>-1){jQuery(document).bind("ad.interstitial.init",jQuery.proxy(this.interstitialEventHandler,this));jQuery(document).bind("ad.interstitial.started",jQuery.proxy(this.interstitialEventHandler,this));jQuery(document).bind("ad.interstitial.finished",jQuery.proxy(this.interstitialEventHandler,this));if(this.options.size_variant!=="660x300_default"){jQuery(document).bind("ad.inpost300.refresh",jQuery.proxy(function(){this.refreshAd({request_ad:true});this.unbindEvents()},this))}}this.requestAd()},setTogglers:function(){var b=null;for(b in this.options.special_togglers){if(this.options.special_togglers.hasOwnProperty(b)){this.special_togglers[b]=this.options.special_togglers[b]}}return this},unbindEvents:function(){jQuery(document).unbind(".interstitial");jQuery(document).unbind("ad.marquee.finished");jQuery(document).unbind("ad.inpost300.refresh")},requestAd:function(){this.hyperion_url="";this.dart_url="";var h=false;var e=false;if(this.options.forced_zone!==undefined){h=this.options.forced_zone}var g=window.location.href.match(/\?(.+)$/);if(g!==null){var d=window.gawker_parseQueryString(g[1]);if(d.adzone!==undefined){h=d.adzone}else{if(d.no_ads_for_me_rosebud!==undefined){if(d.no_ads_for_me_rosebud=="true"){e=true;jQuery.cookie("no_ads_for_me_rosebud",1,{expires:0.25,path:"/"})}else{jQuery.cookie("no_ads_for_me_rosebud",null)}}}}if(e===true||jQuery.cookie("no_ads_for_me_rosebud")==1){this.forgeFakeResponse({success:false})}else{if(h!==false&&this.options.request_ad===true){this.forgeFakeResponse({success:this.adConditionsApply(),ad_zone:h})}else{var j=["site_id="+this.options.site_id,"size="+this.options.size,"random="+this.options.random];if(window.pageType==="splash_post"){j.push("page_type=frontpage")}else{if(window.pageType==="tagpage"){j.push("page_type=tag")}else{j.push("page_type="+window.pageType)}}if(this.options.tags&&this.options.tags.length>0){for(var f=0,b=this.options.tags.length;f<b;f++){j.push("tags[]="+this.options.tags[f])}}if(document.referrer!==""){j.push("referer="+encodeURIComponent(document.referrer))}if(this.options.ged_zone!==undefined){j.push("ged_zone="+this.options.ged_zone)}if(this.options.issued!==undefined){j.push("issued="+this.options.issued)}j.push("jsonp=?");this.hyperion_url="http://"+this.options.adserver_host+"/ad/"+this.options.original_size+"?"+j.join("&");this.addAdInfo("hyperion_url",this.hyperion_url);if(this.adConditionsApply()&&this.options.request_ad===true){this.setStatus("hyperion_request_sent",true);this.xhr.getJSON(this.hyperion_url)}else{this.hideAd(this.options.target_selector,this.options.size_variant,false);this.setStatus("skipping_request",true)}}}},adConditionsApply:function(){if(this.options.sponsored!=undefined&&this.options.sponsored==true){return false}if(this.ad_conditions[this.options.size_variant]){return this.ad_conditions[this.options.size_variant](this.options.target_selector)}return true},updateOptions:function(b){for(var d in b){if(b.hasOwnProperty(d)){if(b[d]!==null){this.options[d]=b[d]}else{delete this.options[d]}}}},refreshAd:function(b){this.updateOptions(b);if(this.refreshable_variants.indexOf(this.options.size_variant)>-1){this.setStatus("refreshing");
this.iteration++;this.requestAd()}},handleAjaxRequest:function(){},handleAjaxSuccess:function(b){this.setStatus("hyperion_request_success");this.renderAd(b)},handleAjaxFail:function(){this.setStatus("hyperion_request_fail");if(this.options.fallback_zone){return this.forgeFakeResponse({success:true,ad_zone:this.options.fallback_zone})}else{return this.forgeFakeResponse({success:false})}},forgeFakeResponse:function(d){var b={action:"ad_select",success:d.success,random:this.options.random};if(d.ad_zone!==undefined){b.type="zone";b.params={ad_zone:d.ad_zone}}return this.handleAjaxSuccess(b)},renderAd:function(b){if(b.action==="ad_select"&&b.success===true){Logger.debugLog("rendering "+this.options.original_size+"@"+this.options.target_selector);if(b.type==="zone"){this.renderDartZone(b)}}else{jQuery(this.options.target_selector).html("");this.hideEmpty()}},renderDartZone:function(f){var d=[];if(window.crtg_content!==undefined){d.push(window.crtg_content)}var g=0,e=0;var h=[];for(g=0,e=this.options.keywords.length;g<e;g++){h.push(this.options.keywords[g])}if(this.options.original_size==="300x250"&&this.options.variant!="default"){h.push("slot="+this.options.variant)}if(this.auth.hasLevel("commenters")){h.push("commenter=yes");if(this.auth.hasLevel("starcommenters")){h.push("star=yes")}}var m=this.auth.ssoUser?this.auth.ssoUser:this.auth.sso;if(m&&m.displayName){h.push("loggedin=yes");h.push("username="+escape(escape(escape(m.displayName))));h.push("burner="+(m.authType==="burner"?"yes":"no"))}else{h.push("loggedin=no")}if(f.keywords){for(g=0,e=f.keywords.length;g<e;g++){if(d.indexOf(f.keywords[g])<0){h.push(f.keywords[g])}}}this.addAdInfo("keywords",h.join(", "));for(g=0,e=h.length;g<e;g++){d.push(h[g])}var n=this.options.site+"/"+f.params.ad_zone;var b="http://ad.doubleclick.net/N4246/adj/"+n+";"+d.join(";")+";"+this.options.dart_params.join(";")+"?";this.addAdInfo("zone",n);this.addAdInfo("dart_params",this.options.dart_params.join(" | "));var k=jQuery.proxy(this,"hideEmpty");if(this.options.mode=="iframe"){this.setStatus("iframe_render_starting");this.recreateIframe();this.setIframeContent(jQuery("#ad_iframe_"+this.options.random)[0],b,k);this.setStatus("iframe_render_started")}else{var j=['<script type="text/javascript" src="'+b+'"><\/script>'];j=j.join("\n");this.setStatus("div_render_starting");this.element.html(jQuery.writeCapture.sanitize(j,k));this.setStatus("div_render_started")}this.dart_url=b;this.addAdInfo("dart_url",this.dart_url)},cleanContainer:function(){jQuery("#ad_container_"+this.options.random).children().remove()},setIframeContent:function(f,h,j){function d(e){return e.contentWindow.document||e.contentWindow.window.document||e.contentDocument}var b=this.options.original_size;a(f).load(function(){if(b==="300x250"){window.setTimeout(function(){j(f,d(f))},1500)}else{j(f,d(f))}});try{f.src="/static/ad_iframe.html#"+this.options.random+"|"+encodeURIComponent(h)}catch(g){}},recreateIframe:function(){var d=jQuery("#ad_container_"+this.options.random);this.cleanContainer();var b=jQuery("<iframe></iframe>").attr(this.options.iframe_attributes);b.appendTo(d)},hideEmpty:function(){this.setStatus("hide_empty_called");if(this.adIsEmpty()===true){this.setStatus("ad_was_empty");Logger.debugLog(this.options.original_size+" was empty");if(this.options.original_size=="300x600"){this.element.find("iframe").attr({width:300,height:250}).contents().empty();this.options.iframe_attributes.height=250;this.options.original_size="300x250";this.options.dart_params=window.adRobot.getDartParams(this.options.original_size);this.iteration++;this.requestAd()}else{this.hideAd(this.options.target_selector,this.options.size_variant,true)}}else{this.setStatus("ad_was_there");this.showAd(this.options.target_selector,this.options.size_variant)}},adIsEmpty:function(){var f=this.element[0],d="",j=[],b=false;if(jQuery("table",f).length>0){b=false}else{if(jQuery("iframe",f).length>0){var g=jQuery("iframe",f).contents();var h=g.find("body");var e=g.find("head, body");d=h.html();j=e.find("[src]")}else{d=f.innerHTML;j=jQuery("[src]",f)}if(jQuery.trim(d).length===0){b=true}else{j.each(function(l,k){if(k.src&&k.src.match(/817-(grey|grey_|blank|blank_).gif/)){b=true}})}}this.addAdInfo("empty_ad",b);return b},showAd:function(b,d){if(d==="300x250_rightbar"&&window.adRobot.delay300x250()){jQuery("#tomorrowsnews").show()}if(d!=="300x250_rightbar"||!window.adRobot.delay300x250()){if(d==="660x300_default"){if(jQuery.browser.safari){jQuery(b).fadeIn("slow")}else{jQuery(b).slideDown("slow")}}else{jQuery(b).show()}this.callSpecialTogglers(b,d,"show")}},hideAd:function(b,e,d){if(e==="660x300_default"){jQuery(b).slideUp("slow")}else{jQuery(b).hide()}if(d===true){this.callSpecialTogglers(b,e,"hide")}},callSpecialTogglers:function(b,f,g){if(this.special_togglers[f]&&this.special_togglers[f][g]){var d=this.special_togglers[f][g];if(d.on_ready){var e=this;jQuery().ready(function(){jQuery.proxy(d.on_ready,e)(b)})}if(d.right_on){jQuery.proxy(d.right_on,this)(b)
}}},setStatus:function(g,f){this.addAdInfo("status",g);if(f===true){this.status=[];jQuery("#ad_info_"+this.options.random).remove()}var d=new Date();var e=d.getTime();var b={status_text:g,timestamp:e};this.status.push(b)},getDartParams:function(){this.options.dart_params=window.adRobot.getDartParams(this.options.original_size);this.options.refreshable=true},mainContentLoaded:function(d){if(this.options.refreshable===undefined||this.options.refreshable===true||d.params.data.sponsored===true||this.options.sponsored===true){var b={request_ad:true,tags:null,sponsored:null,ged_zone:null};if(d.params.data.tags!==undefined){b.tags=d.params.data.tags}if(d.params.data.sponsored!==undefined){b.sponsored=d.params.data.sponsored}if(d.params.data.ged_zone!==undefined){b.ged_zone=d.params.data.ged_zone}this.refreshAd(b)}},marqueeEventHandler:function(b){switch(b.namespace){case"init.marquee":jQuery(this.options.target_selector).hide();break;case"finished.marquee":if(false===this.adIsEmpty()){this.showAd(this.options.target_selector,"300x250_rightbar")}break}},interstitialEventHandler:function(b){switch(b.namespace){case"init.interstitial":break;case"interstitial.started":if(this.browser=="ie"){jQuery("#interstitial_countdown_container").css("opacity",1);jQuery("#interstitial_bottom_info").css("opacity",1);jQuery("#bannercontainer").css("opacity",1)}else{jQuery("#interstitial_countdown_container").animate({opacity:1},500);jQuery("#interstitial_bottom_info").animate({opacity:1},500);jQuery("#bannercontainer").animate({opacity:1},500)}break;case"finished.interstitial":if(this.options.original_size==="660x300"){this.hideAd(".ad_interstitial","660x300_default",true);jQuery("body").removeClass("interstitialed")}else{jQuery(document).trigger("ad.inpost300.refresh")}this.unbindEvents();break}},addAdInfo:function(b,e){var d=this.element.data("ad_info");if(d===undefined){d=[]}if(d[this.iteration]===undefined){d[this.iteration]={}}if(d[this.iteration][b]===undefined){d[this.iteration][b]=[]}d[this.iteration][b].push(e);this.element.data("ad_info",d)}});a.extend(a.ui.AdUnitAncestor,{version:"1.0",defaults:{adserver_host:"localhost:8800",controlClass:"ad_control"}})})(jQuery);(function(a){a.widget("ui.AdminLogWidget",{initialize:function(){this.settings=[];this.xhr=new XHR({klass:"adminlog",success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.page=0;this.showWidget()},showWidget:function(){this.loadData()},loadData:function(){var b={op:"commentadminstat",id:this.options.user_id,page:this.page};if(this.controls.indicator){this.controls.indicator.show()}this.xhr.send("/index.php",b)},handleClick:function(d){var b=this.getParam("cn",d.target);switch(b){case"next":this.page++;this.loadData();d.stopPropagation();d.preventDefault();break;case"prev":if(this.page>0){this.page--}this.loadData();d.stopPropagation();d.preventDefault();break}},handleAjaxSuccess:function(b){this.element.html(b.content);this.setControls();this.controls.indicator.hide()}});a.extend(a.ui.AdminLogWidget,{version:"1.0",defaults:{controlClass:"adminlogcontrol"}})})(jQuery);(function(a){a.widget("ui.AgeGate",{initialize:function(){var b=jQuery.cookie("visitor_birthdate");if(b!=null){parts=b.split("_");daysLeft=this.getDaysLeft(this.options.limit,parts[0],parts[1],parts[2]);if(daysLeft==0){var d=this.options.handler(this.options.object,this.options.id);jQuery("#"+this.options.id).get(0).innerHTML=d.output;if(d.postShow!==undefined){d.postShow()}return true}else{jQuery("#"+this.options.id)[0].innerHTML=jQuery("#agegate_container_rejected")[0].innerHTML.replace(/IDHERE/,this.options.id);roundbox=jQuery("#agegate_"+this.options.id+" .roundbox")[0];roundbox.style.marginTop=Math.floor((this.options.object.height-roundbox.scrollHeight-10)/2)+"px"}}else{jQuery("#"+this.options.id)[0].innerHTML=jQuery("#agegate_container")[0].innerHTML.replace(/IDHERE/,this.options.id);this.setupForm()}jQuery("#agegate_"+this.options.id)[0].style.width=this.options.object.width+"px";jQuery("#agegate_"+this.options.id)[0].style.height=this.options.object.height+"px"},setupForm:function(){jQuery("INPUT.agegate_control").focus(function(){if(this.value==this.defaultValue){this.value=""}if(this.value!=this.defaultValue){this.select()}this.style.color="black"});jQuery("INPUT.agegate_control").blur(function(){if(a.trim(this.value)==""){this.value=(this.defaultValue?this.defaultValue:"");this.style.color="lightgrey"}});jQuery("INPUT.agegate_control").keypress(function(b){if((b.which>31&&b.which<48)||(b.which>57&&b.which<127)){return false}});roundbox=jQuery("#agegate_"+this.options.id+" .roundbox")[0];roundbox.style.marginTop=Math.floor((this.options.object.height-roundbox.scrollHeight-10)/2)+"px";this.setControls();this.registerEventHandler(this.controls.agegate_form,"submit",this.validateAge.bind(this));this.agegate_validator=new Validator(jQuery.extend({},{scope:this.controls.agegate_form}))},validateAge:function(b){this.agegate_validator.hideErrors();
if(this.agegate_validator.validate()){year=this.controls.year[0].value;month=this.controls.month[0].value;day=this.controls.day[0].value;jQuery.cookie("visitor_birthdate",year+"_"+month+"_"+day);gates=GawkerClientside.widgets.agegate;for(i=0;i<gates.length;i++){daysLeft=this.getDaysLeft(gates[i].options.limit,year,month,day);if(daysLeft==0){var d=gates[i].options.handler(gates[i].options.object,gates[i].options.id);jQuery("#"+gates[i].options.id).get(0).innerHTML=d.output;if(d.postShow!==undefined){d.postShow()}}else{jQuery("#"+gates[i].options.id)[0].innerHTML=jQuery("#agegate_container_rejected")[0].innerHTML.replace(/IDHERE/,gates[i].options.id);jQuery("#agegate_"+gates[i].options.id)[0].style.width=gates[i].options.object.width+"px";jQuery("#agegate_"+gates[i].options.id)[0].style.height=gates[i].options.object.height+"px";roundbox=jQuery("#agegate_"+gates[i].options.id+" .roundbox")[0];roundbox.style.marginTop=Math.floor((gates[i].options.object.height-roundbox.scrollHeight-10)/2)+"px"}}}else{this.agegate_validator.showErrors()}b.stopPropagation();b.preventDefault()},getDaysLeft:function(b,e,f,d){now=new Date();birth=Date.UTC(e,f,d,0,0,0,0);nowyear=now.getYear();nowyear+=nowyear<1900?1900:0;start=Date.UTC((nowyear-b),now.getMonth()+1,now.getDate(),0,0,0,0);if(start>birth){daysLeft=0}else{daysLeft=Math.floor((birth-start)/(86400*1000))}return daysLeft}});a.extend(a.ui.AgeGate,{version:"1.0",defaults:{controlClass:"agegate_control"}})})(jQuery);(function(a){a.widget("ui.PromoteTweetWidget",{controls:{},params:{},xhr:null,initialize:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));var b=this;this.xhr=new XHR({klass:"promotetweet",beforeSend:function(d){b.handleAjaxRequest(d)},error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},showWidget:function(){jQuery(".content.tweets .commenttools").show()},hideWidget:function(){jQuery(".content.tweets .commenttools").hide();jQuery(".content.tweets .admin_links").hide()},authEventHandler:function(b){switch(b.name){case"user.auth.success":if(this.auth.hasLevel("authors")){this.showWidget()}else{this.hideWidget()}break;default:this.hideWidget();break}},handleClick:function(g){var b=jQuery(g.target);var f=this.getParam("tweetid",b);if(b.hasClass("cn_promote")){if(b.hasClass("hasPost")){var d="https://publish."+this.auth.site.canonicalHost.replace(/^([^\.]*\.)?([^\.]*\.[^\.]*)$/,"$2")+"/ged/"+this.getParam("postId",b);location.href=d}else{this.getUserList(f,this.getParam("tweetfeed",b))}g.stopPropagation();g.preventDefault()}else{if(b.hasClass("cn_closeadmin")){jQuery(".tweet_"+f+" .admin_links").hide();g.stopPropagation();g.preventDefault()}else{if(b.hasClass("cn_promotelink")){this.promoteTweet(f,this.getParam("userid",b),this.getParam("feed",b));g.stopPropagation();g.preventDefault()}}}},getUserList:function(d,b){this.xhr.send("/index.php",{op:"tweet_authorlist",tweetId:d,feed:b});this.showProgress(true,d)},promoteTweet:function(e,b,d){this.xhr.send("/index.php",{op:"tweet_bump",postId:e,feed:d,authorId:b});this.showProgress(true,e)},showProgress:function(b,d){if(!d){d=0}jQuery(".tweetPromoteProgress").appendTo((b?".comment.tweet.tweet_"+d+" .commenttools":"#tweetPromoteToolsContainer"))},handleAjaxRequest:function(){},handleAjaxSuccess:function(f){this.showProgress(false);switch(f.action){case"tweet_authorlist":var e=jQuery(".tweet_"+f.tweetId+" .admin_links");e.empty();if(f.success){e.append('<span class="smallfont">Choose an author:</span> ');for(var d=0,b=f.users.length;d<b;d++){e.append('<a href="#" class="smallfont ptc cn_promotelink feed_'+f.feed+" tweetid_"+f.tweetId+" userid_"+f.users[d].id+'">'+f.users[d].name+"</a> ")}e.append('<a href="#" class="ptc tweetid_'+f.tweetId+' cn_closeadmin closeButton">x</a>');e.show()}break;case"tweet_promote":jQuery(".tweet_"+f.tweetId+" .admin_links").hide();if(f.success){jQuery(".cn_promote.tweetid_"+f.tweetId).addClass("hasPost");jQuery(".cn_promote.tweetid_"+f.tweetId).removeClass("noPost");jQuery(".cn_promote.tweetid_"+f.tweetId).addClass("postId_"+f.postId)}else{jQuery(".tweet_"+f.tweetId+" .admin_message").text("Twetter promotion failed. Please try again.");jQuery(".tweet_"+f.tweetId+" .admin_message").show()}break}},handleAjaxFail:function(){this.showProgress(false)}});a.extend(a.ui.PromoteTweetWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"ptc"}})})(jQuery);(function(a){a.widget("ui.ChartbeatWidget",{xhr:null,pulseHost:"",links:[],interval:5,runChartbeat:true,initialize:function(){var b=this;this.xhr=new XHR({klass:"chartbeat",type:"POST",beforeSend:function(d){b.handleAjaxRequest(d)},error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.pulseHost=this.options.host;this.interval=this.options.interval;this.runChartbeat=this.options.runChartbeat;if(!this.interval||!this.pulseHost){this.runChartbeat=false}if(this.runChartbeat){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));
this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("navigation.loaded",this.parseChartbeatLinks.bind(this));this.subscribeForEvent("chartbeat.iterationFinished",this.runNextCheck.bind(this));this.subscribeForEvent("navigation.load",this.suspendChartbeat.bind(this));this.subscribeForEvent("maincontent.postloaded",this.resumeChartbeat.bind(this));this.subscribeForEvent("maincontent.frontpageloaded",this.resumeChartbeat.bind(this));this.parseChartbeatLinks();this.waitingForNextCheck=false;this.chartbeatSuspended=false;this.runNextCheck();this.animationQueue=0}},authEventHandler:function(b){},handleClick:function(b){},handleAjaxRequest:function(){},parseHost:function(d){if(this.hostCache===undefined){this.hostCache={}}if(this.hostCache[d]===undefined){var b=new RegExp("([^.]+).[^.]+$").exec(d);if(b===null){return d}this.hostCache[d]=b[1]+".com"}return this.hostCache[d]},parseChartbeatLinks:function(){var b=[];var d={host:this.parseHost(location.host),path:location.pathname};var d={host:this.parseHost(location.host),path:"null"};b.push(d);var e=this;jQuery("a.liveData").each(function(g){var h="";var j="";if(this.cbHost!==undefined){h=this.cbHost;j=this.cbPath}else{var f=new RegExp("https?://([^/]+)(.*)").exec(this.href);if(f!==null){h=e.parseHost(f[1]);j=f[2];this.cbHost=h;this.cbPath=j}}d={host:h,path:j};b.push(d)});this.links=b},runNextCheck:function(){if(this.waitingForNextCheck){return}this.waitingForNextCheck=true;var b=this;setTimeout(function(){b.waitingForNextCheck=false;if(b.runChartbeat&&!this.chartbeatSuspended){b.getChartbeatData(b.links,location.host)}else{this.raiseEvent("chartbeat.iterationFinished",{})}},this.interval*1000)},getChartbeatData:function(h,b){b=this.parseHost(b);var d=[];var j={host:[],path:[],op:"ajax_remoteservice",type:"chartbeat"};for(var e=0;e<h.length;e++){var g=h[e];var f=b;if(g.host!==undefined){f=g.host}j.host.push(f);j.path.push(g.path)}this.xhr.send("index.php",j)},showChartbeatData:function(f){var m={};for(var g=0;g<f.length;g++){var k=f[g];if(k.path===null){k.path=""}if(m[k.host]===undefined){m[k.host]={}}m[k.host][k.path]={"new":k["new"],"return":k["return"],people:k["new"]+k["return"]}}var e=this;jQuery("a.liveData").each(function(o){if(this.cbHost!==undefined){var s=this.cbHost;var n=this.cbPath.replace("+"," ");if(m[s]===undefined){return true}var p=m[s][n];if(p!==undefined){var r=e.getParam("liveData",jQuery(this));if(r!==null){e.setNumber(".liveDataContainer_"+r,p.people)}else{var q=p["new"]+" new and "+p["return"]+" returning visitor";this.title=q}}}});var l=this.parseHost(location.host);if(m[l][""]!==undefined){var h=m[l][""]["people"];this.setNumber("#siteVisitors",h);var b=parseInt(jQuery("#siteVisitorRatio").css("width").replace("%",""),10);var d=Math.round(m[l][""]["new"]/m[l][""]["people"]*100-3);if(b!=d){var j=(d>b?"+":"-")+"="+Math.abs(d-b)+"%";jQuery("#siteVisitorRatio").animate({width:j},"normal")}}if(!this.waitingForNextCheck&&this.animationQueue==0){this.runNextCheck()}},setNumber:function(k,g){var e=jQuery(k);if(e.length==0||g<1){return}var d=parseInt(e.html().replace(",",""),10);var j=Math.abs(g-d);if(j==0){return}var f=1;if(j>100){f=Math.ceil(j/100)}var h=(g>d);f=f*(h?1:-1);this.animationQueue++;var b=(e.attr("id").length>0?e.attr("id"):e.attr("class"));if(h){e.closest(".viewer-count").removeClass("trendingDown").addClass("trendingUp")}else{e.closest(".viewer-count").removeClass("trendingUp").addClass("trendingDown")}this.changeNumber(d+f,g,h,f,e)},changeNumber:function(m,n,g,f,b){try{if((g&&m>n)||(!g&&m<n)){m=n}var k=m+"";var d=/(\d+)(\d{3})/;while(d.test(k)){k=k.replace(d,"$1,$2")}b.html(k);var j=this;if((g&&m<n)||(!g&&m>n)){setTimeout(function(){j.changeNumber((m+f),n,g,f,b)},5)}else{this.animationQueue--;var h=(b.attr("id").length>0?b.attr("id"):b.attr("class"));if(this.animationQueue==0){this.raiseEvent("chartbeat.iterationFinished",{})}}}catch(l){this.animationQueue--}},suspendChartbeat:function(){this.chartbeatSuspended=true},resumeChartbeat:function(){this.chartbeatSuspended=false},handleAjaxSuccess:function(b){this.showChartbeatData(b)},handleAjaxFail:function(){}});a.extend(a.ui.ChartbeatWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"chartbeat_control"}})})(jQuery);(function(b){var a=b.extend({},{login_state:"loggedout:idle",mode:"commentform",initialize:function(){this.subscribeForEvent("user.",this.authEventHandler.bind(this));this.validator=new Validator(jQuery.extend({},{scope:this.controls.postform}));this.subscribeForEvent("navigation.load",this.navigationEventHandler.bind(this));this.subscribeForEvent("commentform.",this.eventHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.postEventHandler.bind(this));this.subscribeForEvent("maincontent.tagpageloaded",this.postEventHandler.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.forumEventHandler.bind(this));this.commentMode="text";this.registerEventHandler(this.controls.submit,"click",this.handleSubmit.bind(this));
this.registerEventHandler(this.controls.cancel,"click",this.handleCancel.bind(this));this.registerEventHandler(this.controls.switchtab,"click",this.handleSwitchTab.bind(this));this.registerEventHandler(this.controls.postform,"submit",this.handleSubmit.bind(this));this.registerEventHandler(this.controls.image_url,"change",this.handleImagePreview.bind(this));this.registerEventHandler(this.controls.video_url,"change",this.handleVideoPreview.bind(this));this.registerEventHandler(this.controls.select_image_url,"click",this.setImageUrlForm.bind(this));if(this.controls.select_image_upload!==undefined){this.registerEventHandler(this.controls.select_image_upload,"click",this.setImageUploadForm.bind(this))}this.xhr=new XHR({klass:"commentform",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)})},authEventHandler:function(d){switch(d.name){case"user.auth.success":if(this.login_state=="loggedout:submit"){this.login_state="loggedin:idle";this.handleSubmit({})}this.login_state="loggedin:idle";this.controls.op.val("addcomment");this.controls.anonemailinput.val("");this.controls.anonnewsletter.val("");this.showFormUser();break;case"user.auth.failure":this.login_state="loggedout:idle";this.hideFormUser();break;case"user.emailcomment":this.login_state="guest:submit";break}},navigationEventHandler:function(d){if(d.name=="navigation.load"){this.hideForm()}},handleSubmit:function(e){e.stopPropagation();e.preventDefault();var f=false;this.validator.hideErrors();this.validator.validate();if(typeof this.validator.errorlist.entry!="undefined"){f=true}if(typeof this.validator.errorlist.image_url!="undefined"&&this.controls.mode.val()=="image"){f=true}if(typeof this.validator.errorlist.video_url!="undefined"&&this.controls.mode.val()=="video"){f=true}if(f){if(this.options.show_validation_errors){this.validator.showErrors()}return}if(this.login_state=="loggedout:idle"||this.login_state=="loggedout:submit"){this.login_state="loggedout:submit";this.raiseEvent("presence.requiresequence.guest",{});return}if(!jQuery.browser.msie){this.controls.entry_preview.html(this.controls.entry.val());this.controls.entry.val(this.controls.entry_preview.html())}var d=this.controls.postform.serializeArray();if(window.pageType==="site_comments_admin"){d.push({name:"external_tools",value:true})}this.xhr.send("/index.php",d)},handleAjaxRequest:function(){this.controls.submit.attr("disabled","disabled");this.controls.cancel.attr("disabled","disabled");this.controls.indicator.show()},handleAjaxSuccess:function(d){this.controls.submit.attr("disabled","");this.controls.cancel.attr("disabled","");this.controls.indicator.hide();if(d.code!==undefined&&d.code==="ACCESS_DENIED"){d.message="Something went wrong. Please refresh the page and try again."}switch(d.action){case"addcomment":case"addguestcomment":if(d.success===true){this.hideForm();this.resetFormValues();if(d.action==="addguestcomment"){var e=jQuery('<div class="ignoremeforgood">'+d.content+"</div>");jQuery(".metatext",e).html('<span class="msghighlited">(Comment Pending. Please check your email for a verification link.)</span>');d.content=e.html();this.login_state="loggedout:idle"}this.raiseEvent("threads.insertcomment",{comment:d});if(d.message!==undefined){Message.showMessage(d.message,this.controls.message[0],{stable:false,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)})}}else{if(d.message!==undefined){Message.showMessage(d.message,this.controls.message[0],{stable:false,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)})}}Debug.log({mode:"AJAX",url:"op:addcomment-ajaxsuccess",options:{data:d}});break;case"editcomment":if(d.success){this.raiseEvent("threads.replacecomment",{comment:d});this.raiseEvent("commentform.close",{});this.resetFormValues();this.setMode()}else{Message.showMessage("Comment edit failed",this.controls.message[0],{stable:false,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)})}break}},handleAjaxFail:function(d){this.controls.indicator.hide();this.controls.submit.attr("disabled","");this.controls.cancel.attr("disabled","");Message.showMessage("Comment save failed",this.controls.message[0],{stable:false,duration:3000,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)});Debug.log({mode:"AJAX",url:"op:addcomment-ajaxfail",options:{data:arguments}})},handleCancel:function(d){var e=this.controls.comment_id.val();this.resetFormValues();this.setMode();this.raiseEvent("commentform.close",{refresh_thread:false,comment_id:e});this.raiseEvent("commentform.cancel",{comment_id:e});d.stopPropagation();d.preventDefault()},handleSwitchTab:function(d){if(this.controls.expandedform.is(":visible")===false){this.expandForm(true)}var e=this.getParam("t",d.target);
this.switchtab(e,true);this.validator.hideErrors();jQuery("#comment_validation_error_message").removeClass("show_text show_image show_video");jQuery("#comment_validation_error_message").addClass("show_"+e);d.stopPropagation();d.preventDefault()},handleImagePreview:function(d){return false},handleVideoPreview:function(d){return false},expandForm:function(d){if(d){this.controls.expandedform.show();this.element.addClass("opened")}else{this.controls.expandedform.hide();this.controls.image_upload_external.hide();this.element.removeClass("opened")}},openForm:function(d){this.element.fadeIn("normal",function(){this.switchtab(this.commentMode,null,d)}.bind(this))},hideForm:function(e){if(this.mode=="postform"){var d=jQuery(".postform_container");if(d.length>0){d.append(this.element)}else{this.element.hide()}if(e!==undefined){jQuery(".cid_"+e).show()}}else{this.element.hide();this.resetFormValues();jQuery(".commentform_container").append(this.element)}},switchtab:function(g,f,d){if(false&&f){var e=false;jQuery(this.options.fields).each(function(h,j){var k=this.controls[j].val();if(this.controls[j].is("SELECT")!==true&&k!==""){e=true}}.bind(this));if(e){if(!window.confirm("Unsaved changes, do you want to clear data?")){return false}}}this.controls.mode.val(g);jQuery(".tabs li").removeClass("selected");jQuery(".tabs li.t_"+g).addClass("selected");jQuery(".tabs li.t_"+g).closest(".form_part").removeClass("pf_text pf_image pf_video pf_quote").addClass("pf_"+g);jQuery(["tab","extension"]).each(function(h,j){jQuery("."+j+"").hide();jQuery("."+j+".t_"+g).show()});if(jQuery("textarea:visible, input:visible",this.element).get(0)&&!d){jQuery("textarea:visible, input:visible",this.element).get(0).focus()}this.controls.expandedform.removeClass("preview_shown")},resetFormValues:function(){var d=["parent_id","comment_id","entry","quote","image_file","image_url","image_format","image_upload","comment_id","video_url","quote_url","anonemailinput","anonnewsletter"];jQuery(d).each(jQuery.proxy(function(f,h){try{this.controls[h].val("")}catch(g){}},this));try{this.controls.fileuploadform.fileUpload("destroy","comment_image_upload")}catch(e){}},eventHandler:function(d){switch(d.name){case"commentform.open":this.commentMode="text";this.openWidget(d.params);break;case"commentform.setreplyto":this.setReplyto(d.params);break;case"commentform.setedit":this.setEdit(d.params);break;case"commentform.close":jQuery(".autogrow").remove();case"commentform.cancel":this.hideForm(d.params.comment_id);break;case"commentform.guestsubmit":this.setMode("guest",d.params);this.controls.postform.submit();break;case"commentform.guestcancel":this.setMode("normal",d.params);break}},postEventHandler:function(d){if(d.name=="maincontent.postloaded"||d.name=="maincontent.tagpageloaded"){this.mode="commentform";this.controls.root_id.val(d.params.data.originalPostId);this.controls.sitetag.val("")}},forumEventHandler:function(d){if(d.name=="maincontent.forumloaded"){this.mode="postform";this.controls.root_id.val(d.params.data.sitetag.id);this.controls.sitetag.val(d.params.data.sitetag.name);this.commentMode="text";this.openWidget({after:jQuery(".postform_container"),dont_expand_form:false})}},refreshWidget:function(){this.setControls();if(this.auth.authenticated&&this.auth.user.fb_uid){jQuery(".fbuser").show()}else{jQuery(".fbuser").hide()}},openWidget:function(e){var d=null;if(e.after!==undefined){d=e.after}else{d=jQuery(".input_box_place")}d.after(this.element);if(e.clear!==undefined&&e.clear===true){this.resetFormValues()}if(e.dont_expand_form===undefined||e.dont_expand_form!==true){this.expandForm(true);this.openForm(e.nofocus)}else{this.expandForm(false)}this.openForm(e.nofocus);this.controls.entry.autogrow();this.raiseEvent("commentform.opened",{})},setReplyto:function(d){this.controls.parent_id.val(d.replyto);this.controls.comment_id.val("");this.controls.entry.get(0).focus()},setEdit:function(d){var e=new XHR({klass:"getcomment",beforeSend:function(){},error:function(){},success:function(g){if(g.success===true){if(g.comment_text.indexOf('class="commentImage"')>-1){this.commentMode="image"}else{if(g.comment_text.indexOf('class="youtube-player"')>-1){this.commentMode="video"}else{this.commentMode="text"}}this.setMode("edit",{comment:g});var h=jQuery(".cid_"+g.comment_id).hide();this.openWidget({after:h,dont_expand_form:false,clear:false})}else{var f=jQuery(".cid_"+g.comment_id+" .please_leave_a_message");Message.showMessage("Comment read failed",f.get(0),{stable:false})}}.bind(this)});e.send("/index.php",{op:"ajax_getcomment",id:d.comment_id})},setMode:function(g,e){switch(g){case"guest":this.controls.op.val("addguestcomment");this.login_state="guest:submit";this.controls.anonemailinput.val(e.email);this.controls.anonnewsletter.val(e.newsletter);break;case"author":this.controls.op.val("postauthorcomment");break;case"edit":this.controls.op.val("editcomment");this.controls.comment_id.val(e.comment.comment_id);this.controls.parent_id.val(e.comment.parent_id);this.controls.entry.val(e.comment.original_text);
var f=e.comment.comment_text.match(/embed\/(.*?)"/);if((f!=null)&&(this.commentMode=="video")){this.controls.video_url.val("http://youtube.com/watch?v="+f[1])}else{var d=e.comment.comment_text.match(/img src="(.*?)"/);if(d!=null&&(this.commentMode=="image")){this.controls.image_url.val(d[1])}}break;default:this.controls.op.val("addcomment");this.controls.anonemailinput.val("");this.controls.anonnewsletter.val("");break}},showFormUser:function(){if(this.auth.authenticated){var d=22;var e=this.auth.user.smartName;if(this.auth.user.smartName.length>d){e=this.auth.user.smartName.substr(0,d)+"..."}this.controls.author_link.attr({href:"/people/"+this.auth.user.username});this.controls.author_link.text(e).show();this.controls.author_image.attr({src:"http://cache.gawkerassets.com/assets/images/commenter/"+this.auth.user.avatarPath+"_32.jpg"}).show()}},hideFormUser:function(){this.controls.author_link.attr({href:"#"}).hide();this.controls.author_link.text("").hide();this.controls.author_image.attr({src:"http://cache.gawkerassets.com/assets/images/commenter/noimage.gif"}).hide()},setImageUploadForm:function(d){d.stopPropagation();d.preventDefault();this.controls.image_url_wrap.hide();this.controls.image_upload_wrap.show();this.controls.fileuploadform.fileUpload({namespace:"comment_image_upload",url:"/index.php",method:"POST",fieldName:"image_upload",formData:{op:"comment_image_upload"},multiFileRequest:false,initUpload:function(h,g,e,k,f,j){this.controls.image_upload_result.html("please wait");j()}.bind(this),onLoad:function(j,h,e,k,g){if(k.statusText=="OK"){var f=jQuery.parseJSON(k.responseText);if(f.success===true){this.controls.image_file.val(f.path);this.controls.image_format.val(f.format);Message.showMessage("Image uploaded",this.controls.image_upload_result[0],{stable:false,onComplete:function(){this.controls.image_upload_result.html('<a href="'+f.thumb+'" target="_new">View image</a>')}.bind(this)})}else{this.controls.image_file.val("");this.controls.image_upload_result.html("");if(f.message!==undefined){Message.showMessage(f.message,this.controls.image_upload_result[0],{stable:false})}}}}.bind(this)})},setImageUrlForm:function(d){d.stopPropagation();d.preventDefault();this.controls.image_upload_wrap.hide();this.controls.image_url_wrap.show();this.controls.fileuploadform.fileUpload("destroy","comment_image_upload")}});b.widget("ui.CommentFormWidget",a);b.extend(b.ui.CommentFormWidget,{version:"1.0",defaults:{onHide:{},onShow:{},onReset:{},controlClass:"pfc",externalElement:"",show_validation_errors:true}})})(jQuery);(function(a){a.widget("ui.CommenterWidget",{initialize:function(){this.xhr=new XHR({klass:"commenter",type:"POST",beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.subscribeForEvent("threads.threadloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("threads.listloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("maincontent.profilepageloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this))},eventThreadLoadedHandler:function(b){this.resetElements();this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.setControls();this.showIcons()},eventAuthHandler:function(b){this.showIcons()},handleClick:function(f){var d=jQuery(f.target);var g=this.getParam("cn",d);var b=this.getParam("bid",d);switch(g){case"buddy":this.toggleBuddy(b);f.stopPropagation();f.preventDefault();break;case"ffbox_toggle":this.toggleFriendsBox();f.stopPropagation();f.preventDefault();break}},ajaxRequestHandler:function(){},ajaxSuccessHandler:function(e){switch(e.action){case"saveusertag":if(e.objectId!==undefined){this.controls.buddy.filter(".bid_"+e.objectId+".inprogress").removeClass("inprogress")}if(e.success===true){if(e.command=="tag"){this.auth.user.buddies.push(e.objectId)}else{var b=this.auth.user.buddies.indexOf(e.objectId);var f=[];for(var d=0;d<this.auth.user.buddies.length;d++){if(d!=b){f.push(this.auth.user.buddies[d])}}this.auth.user.buddies=f}this.auth.resetRevision();this.showIcons()}break;case"ajax_buddylist":this.controls.ffbox_placeholder.html(e.content).slideDown();this.eventThreadLoadedHandler({});break}},ajaxFailHandler:function(b){this.controls.buddy.filter(".inprogress").removeClass("inprogress")},showIcons:function(){if(this.controls.buddy===undefined){return false}if(this.auth.authenticated){this.controls.buddy.show()}else{this.controls.buddy.hide();return false}this.controls.buddy.removeClass("buddy_true");var b=null;this.controls.buddy.each(function(d,e){b=this.getParam("bid",e);if(this.auth.user.buddies!==undefined&&this.auth.user.buddies.indexOf(b)!==-1){jQuery(e).addClass("buddy_true")}}.bind(this))},toggleBuddy:function(d){var b={op:"saveusertag",objectType:"USER",objectId:d};
if(jQuery.inArray(d,this.auth.user.buddies)===-1){b.tagName="buddy"}else{b.unTagName="buddy"}this.controls.buddy.filter(".bid_"+d).addClass("inprogress");this.xhr.send(this.options.action_url,b)},toggleFriendsBox:function(){if(this.controls.ffbox_wrapper.hasClass("opened")){this.controls.ffbox_placeholder.slideUp("fast");this.controls.ffbox_wrapper.removeClass("opened")}else{this.controls.ffbox_wrapper.addClass("opened");if(this.controls.ffbox_placeholder.html()===""){var b=this.getParam("userid",this.controls.ffbox_wrapper);var d={op:"ajax_buddylist",user_id:b};this.xhr.send(this.options.action_url,d)}else{this.controls.ffbox_placeholder.slideDown()}}}});a.extend(a.ui.CommenterWidget,{version:"1.0",defaults:{action_url:"/index.php",onHide:{},onShow:{},onReset:{},controlClass:"cw",externalElement:"#comments, .user-profile, .biguserlist, .userlist"}})})(jQuery);(function(a){a.widget("ui.CommenterAdminWidget",{controls:{},has_admin_rights:false,initialize:function(){this.xhr=new XHR({klass:"commenteradmin",type:"POST",beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.subscribeForEvent("commenteradmin.",this.eventHandler.bind(this));this.subscribeForEvent("threads.",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("maincontent.profilepageloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},eventHandler:function(b){switch(b.name){case"commenteradmin.setstar":this.setStarStatus({commenter_id:b.params.commenter_id,star:b.params.star,comment_id:b.params.comment_id});break;case"commenteradmin.starset":this.userStarredHandler(b.params);break;case"commenteradmin.changestate":this.setUserState({commenter_id:b.params.commenter_id,state:b.params.state,comment_id:b.params.comment_id});break;case"commenteradmin.statechanged":this.userStateChangeHandler(b.params);break}},eventThreadLoadedHandler:function(b){if(b.name==="threads.listloaded"||b.name==="maincontent.profilepageloaded"){this.loadControls()}},eventAuthHandler:function(b){this.setUserRights()},handleClick:function(g){var f=jQuery(g.target);var k=this.getParam("cn",f);var j=f.closest(".comment");var h=this.getParam("aid",j);var d=this.getParam("cid",j);if(!this.has_admin_rights){g.stopPropagation();g.preventDefault();return false}switch(k){case"approveuser":this.raiseEvent("commenteradmin.changestate",{commenter_id:h,state:"approve",comment_id:d});jQuery(".admin_links",j).hide();g.stopPropagation();g.preventDefault();break;case"togglestar":var b=(this.getParam("s",f)=="t")?true:false;this.raiseEvent("commenteradmin.setstar",{commenter_id:h,star:b,comment_id:d});g.stopPropagation();g.preventDefault();break;case"adminpage":document.location="/index.php?op=userlist_search&id="+h+"&siteId="+siteConfig.id;jQuery(".admin_links",j).hide();g.stopPropagation();g.preventDefault();break;case"toggleadminlinks":jQuery(".admin_links",j).toggle();g.stopPropagation();g.preventDefault();break}},ajaxRequestHandler:function(){},ajaxSuccessHandler:function(b){var d={};switch(b.action){case"setstarcommenter":if(b.success===true){d={commenter_id:b.commenterId,comment_id:b.commentId,star:b.starcommenter};this.raiseEvent("commenteradmin.starset",d)}break;case"approveuser":if(b.success===true){d={commenter_id:b.commenterId,comment_id:b.commentId,state:b.action.slice(0,-4)};this.raiseEvent("commenteradmin.statechanged",d)}break}},ajaxFailHandler:function(b){},setUserRights:function(){if(!this.auth.authenticated||!this.auth.hasLevel("commentadmins")){this.element.find(".cn_togglestar.s_t").css({display:"none"});this.has_admin_rights=false}else{if(this.auth.hasLevel("commentadmins")){this.element.find(".cn_togglestar").css({display:"block"});this.has_admin_rights=true}}this.element.find(".cn_togglestar.ts_b").removeClass("s_b");if(this.auth.authenticated&&this.auth.hasLevel("superusers")){this.element.find(".cn_togglestar.ts_b").addClass("s_b")}},loadControls:function(){this.tearDownEventHandler(this.element,"click",this.handleClick.bind(this));this.resetElements();this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.setControls();this.setUserRights()},setStarStatus:function(d){if(typeof d!=="object"||d.commenter_id===undefined){return false}if(d.star===undefined){d.star=true}var b={op:"setstarcommenter",id:d.commenter_id,starcommenter:d.star,cid:d.comment_id,siteId:siteConfig.id};this.xhr.send(this.options.action_url,b)},userStarredHandler:function(b){if(typeof b!=="object"||b.commenter_id===undefined){return false}if(b.star===true){this.element.find(".aid_"+b.commenter_id+" .cn_togglestar").removeClass("s_t").addClass("s_f")}else{if(b.star===false){this.element.find(".aid_"+b.commenter_id+" .cn_togglestar").removeClass("s_f").addClass("s_t")}}this.raiseEvent("threadadmin.priorityset",{comment_id:b.comment_id,priority:(b.starcommenter===true)?0:1});
this.raiseEvent("threadadmin.messageadd",{comment_id:b.comment_id,type:"starredBy",message:"%user starred by %another user"})},setUserState:function(d){if(typeof d!=="object"||d.commenter_id===undefined){return false}var b={op:"changeuserstatus",action:"approve",id:d.commenter_id,siteId:siteConfig.id,commentId:d.comment_id,reloadGroups:true};this.xhr.send(this.options.action_url,b)},userStateChangeHandler:function(b){this.element.find(".aid_"+b.commenter_id+".us_pending").removeClass("us_pending");this.raiseEvent("threadadmin.commentapproved",{comment_id:b.comment_id});this.raiseEvent("threadadmin.messageadd",{comment_id:b.comment_id,type:"approvedBy",message:"%user approved by %another user"})}});a.extend(a.ui.CommenterAdminWidget,{version:"2.0",defaults:{action_url:"/index.php",onHide:{},onShow:{},onReset:{},controlClass:"cra",externalElement:"#comments, .postlist, .profile-header"}})})(jQuery);(function(a){a.widget("ui.Marquee",{marquee_running:false,image_counter:0,videoevent:null,finishedevent:null,initialize:function(){this.videoevent=jQuery.proxy(this.videoInit,this);this.finishedevent=jQuery.proxy(this.marqueeFinished,this);jQuery(document).bind("ad.marquee.run",jQuery.proxy(this.runMarquee,this));jQuery(document).bind("ad.marquee.run",jQuery.proxy(this.runTrackers,this));jQuery(document).bind("ad.marquee.reset",jQuery.proxy(this.reset,this));this.subscribeForEvent("maincontent.load",jQuery.proxy(this.reset,this));if(window.adRobot.marquee_config){jQuery(document).trigger("ad.marquee.run")}},runMarquee:function(d){var b=window.adRobot.marquee_config;if(b.marquee_should_run===true){this.marquee_running=true;window.adRobot.marquee_running=true;jQuery("body").addClass("marqueed");jQuery(document).bind("video.init",this.videoevent);if(b.width===null||b.height===null){var f=jQuery(".displayItem");b.width=f.width();b.height=f.height()}jQuery(".ad_marquee").show();this.injectMarquee();if(b.frequency_limit_on===true){if(b.frequency!==undefined&&b.frequency>0){jQuery.cookie("marquee_shown_"+b.view_name,1,{expires:(b.frequency/24),path:"/"})}}jQuery(document).bind("ad.marquee.finished",this.finishedevent);jQuery("#marquee-frame").css({height:b.height+"px",width:b.width+"px"}).show();jQuery("#rightcontainer").css({zIndex:1897})}else{jQuery(".marqueed").removeClass("marqueed")}},runTrackers:function(b){this.triggerTracker("marquee");this.triggerTracker("hd_marquee");this.triggerTracker("takeover")},reset:function(b){this.marquee_running=false;window.adRobot.marquee_running=false;jQuery(document).unbind("video.init",this.videoevent);jQuery(".ad_marquee").hide();jQuery(".marqueed").removeClass("marqueed");jQuery(document).unbind("ad.marquee.finished",this.finishedevent);this.showIllustration()},videoInit:function(d){var b=(jQuery("#mediaDisplay").height()||385)+"px";jQuery("#aboveheadlinevideo, #topvideo").css({height:b});jQuery("object, iframe",jQuery("#aboveheadlinevideo, #topvideo")).hide()},triggerTracker:function(b){var e=jQuery(".ad_container."+b);if(e.length){var d=e.attr("id").replace("ad_container_","");window.adRobot.runAdFromQueue(d)}},imageLoaded:function(){jQuery("#marquee_image").fadeIn("fast",function(){setTimeout(function(){jQuery("#marquee_image").fadeOut("fast",function(){marquee_finished()})},6000)})},injectMarquee:function(){var d=window.adRobot.marquee_config;if(d.is_ipad===true){var b=jQuery("<a>").attr({href:d.link,target:"_blank"});var e=jQuery("<img/>").attr({id:"marquee_image",src:d.image,width:d.width,height:d.height}).bind("load",jQuery.proxy(this.imageLoaded,this)).appendTo(b);b.appendTo(jQuery("#marquee-frame"))}else{AC_FL_RunContent("codebase","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0","width",d.width,"height",d.height,"src",d.swfFile,"quality","high","pluginspage","http://www.adobe.com/go/getflashplayer","align","middle","play","true","loop","true","scale","showall","wmode","transparent","devicefont","false","id","RSSTicker_gawker","bgcolor","transparent","name","RSSTicker_gawker","menu","true","allowFullScreen","false","allowScriptAccess","always","movie",d.swfFile,"salign","","insertinto",jQuery("#marquee-frame").attr("id"),"rev",d.rev)}},marqueeFinished:function(d,b){if(b!==undefined&&b.force!==undefined&&b.force===true){this.showIllustration(true)}else{this.showIllustration()}jQuery("#rightcontainer").css({zIndex:1950});jQuery(document).unbind("ad.marquee.finished",this.finishedevent)},showIllustration:function(b){if(b===true||this.marquee_running===false){this.marquee_running=false;jQuery(".ad_marquee").hide();jQuery("object, iframe",jQuery("#aboveheadlinevideo, #topvideo")).show();jQuery(".marqueed").removeClass("marqueed")}}});a.extend(a.ui.Marquee,{version:"1.0",defaults:{controlClass:"mc"}})}(jQuery));function marqueeCalled(){var a=window.adRobot.marquee_config;var b=function(){jQuery("object, iframe",jQuery("#aboveheadlinevideo, #topvideo")).show();jQuery(".marqueed").removeClass("marqueed")};if(a.splash!=undefined&&a.splash.load_splash===true){if(a.splash.splash_delay>0){window.setTimeout(b,a.splash.splash_delay)
}else{b()}}}function marquee_finished(){window.adRobot.marquee_running=false;window.adRobot.marquee_config.marquee_config=false;window.adRobot.marquee_config.marquee_should_run=false;jQuery(document).trigger("ad.marquee.finished",{force:true})}function closeExpandedAd(){}(function(a){a.widget("ui.MessagingWidget",{controls:{},initialize:function(){this.subscribeForEvent("maincontent.profilepageloaded",this.eventPageLoadedHandler.bind(this));this.validator=new Validator(jQuery.extend({},{scope:this.controls.form}));this.xhr=new XHR({klass:"messaging",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},handleSubmit:function(b){this.validator.hideErrors();if(this.validator.validate()){this.xhr.send(this.options.action_url,{op:"postmessage",messageText:this.controls.text.val(),attachedObjId:this.controls.attachedObjId.val(),sentToId:this.controls.sentToId.val(),status:((this.controls.public_message.get(0).checked)?"PUBLIC":"PRIVATE")})}else{if(this.options.show_validation_errors){this.validator.showErrors()}}b.preventDefault();b.stopPropagation();return false},handleClick:function(g){var f=jQuery(g.target);var j=this.getParam("cn",f);switch(j){case"openform":this.controls.form.slideDown("fast");g.preventDefault();g.stopPropagation();break;case"cancel":this.controls.form.slideUp("fast",jQuery.proxy(function(){this.resetForm()},this));g.preventDefault();g.stopPropagation();break;case"submit":this.controls.form.submit();g.preventDefault();g.stopPropagation();break;case"delete":var b=jQuery(g.target).data("messageid");if(b===undefined){break}this.deleteMessage(b);g.preventDefault();g.stopPropagation();break;case"reply":g.preventDefault();g.stopPropagation();var d=jQuery(g.target).data("replyid");var h=jQuery(g.target).data("replyuserid");if(d===undefined||h===undefined){break}jQuery("#message_"+d+" .form_place").after(this.controls.form);this.controls.attachedObjId.val(d);this.controls.sentToId.val(h);this.controls.form.slideDown("fast");break}},eventPageLoadedHandler:function(b){this.resetElements();this.setControls();this.registerEventHandler(this.controls.form,"submit",this.handleSubmit.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},handleAjaxRequest:function(){this.controls.indicator.show()},handleAjaxSuccess:function(d){switch(d.action){case"postmessage":if(d.success===true){Message.showMessage("Message sent.",this.controls.message[0],{stable:false,onComplete:function(){this.controls.form.slideUp("fast",jQuery.proxy(function(){this.resetForm()},this))}.bind(this)})}this.controls.indicator.hide();break;case"changemessagestatus":if(d.success===true){var b=jQuery("#message_"+d.messageId);jQuery(".icon_progress",b).show();Message.showMessage("Post deleted",jQuery(".messagetext",b).get(0),{stable:false,onComplete:function(){b.next("hr").remove();b.remove()}.bind(this,b)})}break}},handleAjaxFail:function(){var b="Error occurred, please try again later.";Message.showMessage(b,this.controls.message[0]);this.controls.indicator.hide()},authEventHandler:function(b){if(this.auth.authenticated){this.controls.openform.show()}else{this.controls.openform.hide()}},resetForm:function(){this.controls.text.val("");this.controls.attachedObjId.val("");this.controls.public_message.get(0).checked=false;this.controls.form_default_place.after(this.controls.form)},deleteMessage:function(d){var b={op:"changemessagestatus",publishStatus:"DELETED",id:d};if(window.confirm("Are you sure you want to delete this message?")){jQuery("#message_"+d+" .icon_progress").show();this.xhr.send(this.options.action_url,b)}}});a.extend(a.ui.MessagingWidget,{version:"0.1",defaults:{action_url:"/index.php",controlClass:"mw",externalElement:".commenter_messaging_external, .commenter_tools, .userlist"}})})(jQuery);(function(a){a.widget("ui.PostStatusToggler",{xhr:null,initialize:function(){this.xhr=new XHR({klass:"post_status_toggler",success:this.promoteSuccess.bind(this),error:this.ajaxFailure.bind(this)});this.registerEventHandler(this.element,"click",this.handleStatusToggleClick.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},authEventHandler:function(b){switch(b.name){case"user.auth.success":this.showWidget();break;case"user.auth.failure":this.hideWidget();break}},handleStatusToggleClick:function(d){var b=jQuery("a",d.target);if(b.hasClass(this.options.classes.promote)){d.stopPropagation();d.preventDefault();this.promoteItem(b.parent())}else{if(b.hasClass(this.options.classes.demote)){d.stopPropagation();d.preventDefault();this.demoteItem(b.parent())}else{if(b.hasClass(this.options.classes.sitetag)){d.stopPropagation();d.preventDefault();this.removeSiteTag(b.parent())}}}},getPostInfo:function(e,b){var d={el:e,id:this.getParam(this.options.prefixes["postid"],e)};if(b){d.realm=this.getParam(this.options.prefixes["postrealm"],e)}else{d.issued=this.getParam(this.options.prefixes["postissued"],e)
}d.message=jQuery(".cn_message",e.parent());d.indicator=jQuery(".cn_indicator",e.parent());return d},promoteItem:function(b){this.context=this.getPostInfo(b,true);this.context.addclass="demote";this.context.removeclass="promote";this.context.indicator.show();this.xhr.send(this.options.promote_url,{id:this.context.id,publishStatus:"PUBLISHED",realm:this.context.realm})},demoteItem:function(b){this.context=this.getPostInfo(b,true);this.context.addclass="promote";this.context.removeclass="demote";this.context.indicator.show();this.xhr.send(this.options.promote_url,{id:this.context.id,publishStatus:"REVIEWED",realm:this.context.realm})},removeSiteTag:function(b){this.context=this.getPostInfo(b,false);this.context.addclass="removesitetag";this.context.removeclass="addsitetag";this.context.indicator.show();this.xhr.send(this.options.sitetag_url,{postId:this.context.id,postIssued:this.context.issued})},promoteSuccess:function(d){this.context.indicator.hide();Message.showMessage(d.message,this.context.message[0]);var b=jQuery("a",this.context.el);if(d.deleted){var e=jQuery("#id_"+d.id+"_"+d.issued);window.setTimeout(function(){e.hide()},3000)}if(d.success){b.removeClass(this.options.classes[this.context.removeclass]);b.addClass(this.options.classes[this.context.addclass]);b.attr("title",this.options.titles[this.context.addclass]);b.attr("alt",this.options.titles[this.context.addclass])}},ajaxFailure:function(){this.context.indicator.hide();Message.showMessage("Network problem has occured.",this.context.message[0])},showWidget:function(){if(this.auth.user&&this.auth.hasLevel("editors")&&typeof this.controls.actionbutton!="undefined"){this.controls.actionbutton.show()}},hideWidget:function(){if(typeof this.controls.actionbutton!="undefined"){this.controls.actionbutton.hide()}}});a.extend(a.ui.PostStatusToggler,{version:"1.0",defaults:{controlClass:"pstcontrol",classes:{promote:"doPromote",demote:"doDemote",sitetag:"doRemoveSiteTag",removesitetag:"deleteButton",addsitetag:"addButton"},prefixes:{postid:"tpid",postissued:"tpissued",postrealm:"tprealm"},titles:{promote:"Promote this post",demote:"Demote this post",addsitetag:"Add this crosspromoted post to this site",removesitetag:"Remove this crosspromoted post from this site"},promote_url:"/index.php?op=changepoststatus",sitetag_url:"/index.php?op=removesitetag"}})})(jQuery);(function(a){a.widget("ui.SandboxWidget",{initialize:function(b){this.registerEventHandler(this.element,"click",this.handleClicks.bind(this));this.subscribeForEvent("maincontent.postloaded",(function(d){return function(f){d.setControls()}})(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},handleClicks:function(d){var b=this.getParam("cn",d.target);if(b=="ssousermigrate_link"){d.stopPropagation();d.preventDefault();this.commondialogs.toggleDialog({which:"ssousermigrate"})}},authEventHandler:function(f){a(".sandboxMsg").hide();if(f.name=="user.auth.failure"){a(".sandboxMsg.sandboxLoginLabel").show()}else{if(f.name=="user.auth.success"){var d=false;if(this.auth.user.aka!==undefined&&this.auth.user.aka!==null&&this.auth.user.aka.length>0){for(var b=0;b<this.auth.user.aka.length;b++){if(this.auth.user.aka[b].authApp=="ZAP"){d=true}}}if(!d){a(".sandboxMsg.sandboxConvertLabel").show()}}}if(window.Powwow!==undefined){Powwow.loadUser()}}});a.extend(a.ui.SandboxWidget,{version:"1.0",defaults:{controlClass:"sb_control"}})})(jQuery);(function(a){a.widget("ui.SearchFormWidget",{initialize:function(){if(this.controls.q[0].value==""){this.controls.q[0].value=this.options.defaultValue;this.controls.q.addClass("noq")}this.xhr=new XHR({klass:"search",success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.registerEventHandler(this.controls.form[0],"submit",this.handleSubmit.bind(this));if(this.controls.submit!==undefined){this.registerEventHandler(this.controls.submit[0],"click",this.handleSubmit.bind(this))}this.registerEventHandler(this.controls.q[0],"focus",this.inputFocus.bind(this));this.registerEventHandler(this.controls.q[0],"blur",this.inputBlur.bind(this));this.subscribeForEvent("searchform.searchFinished",this.searchFinished.bind(this));this.subscribeForEvent("searchform.searchFailed",this.searchFailed.bind(this));this.selectFilter("filter","all");this.selectFilter("sort","date");this.searchRunning=false},selectFilter:function(b,d){if(this.searchRunning){return false}jQuery(".searchControl.cn_"+b).removeClass("selected");jQuery(".searchControl.cn_"+b+".cn_"+b+"_"+d).addClass("selected");var e=this.controls.q.val();if(e!=""&&e.toLowerCase()!="search"){this.handleSubmit()}},handleClick:function(d){var b=jQuery(d.target);if(b.hasClass("cn_filter")){this.selectFilter("filter",this.getModifier(b,"filter"));d.preventDefault()}if(b.hasClass("cn_sort")){this.selectFilter("sort",this.getModifier(b,"sort"));d.preventDefault()}},getModifier:function(f,e){var j={filter:"all",sort:"date"};var h=j[e];var d=f.attr("class");if(d!==undefined){d=d.split(" ");
var g="cn_"+e+"_";for(var b=0;b<d.length;b++){if(d[b].indexOf(g)==-1){continue}h=d[b].substr(g.length)}}return h},handleSubmit:function(g){Logger.debugLog("SearchFormWidget handleSubmit");this.controls.msg.hide();if(this.controls.q.val()==""){Message.showMessage("Please provide a search phrase.",this.controls.q[0],{stable:false})}else{var d=this.getModifier(jQuery(".searchControl.cn_filter.selected"),"filter");var b=this.getModifier(jQuery(".searchControl.cn_sort.selected"),"sort");this.controls.q.get(0).disabled=true;var f=this.controls.q.val();this.controls.q.val("Searching...");this.searchRunning=true;this.raiseEvent("navigation.searchInitiated",{q:f,filter:d,sort:b})}if(g!==undefined){g.preventDefault();g.stopPropagation()}return false},handleAjaxSuccess:function(b){},searchFinished:function(b){this.searchRunning=false;this.controls.q.get(0).disabled=false;this.controls.q.val(b.params.q);if(b.params.nochange){return true}var d="";if(b.params.results>0){d=b.params.results+" post"+(b.params.results>1?"s":"")+' found for "'+b.params.q+'"'}else{d='Your search "'+b.params.q+'" did not match any posts'}this.controls.msg.html(d);this.controls.msg.show()},searchFailed:function(b){this.searchRunning=false;this.controls.q.get(0).disabled=false;this.controls.q.val("Search");this.controls.msg.html("Search failed, please try again later");this.controls.msg.show()},inputFocus:function(b){Logger.debugLog("SearchFormWidget inputFocus");if(this.controls.q[0].value==this.options.defaultValue){this.controls.q[0].value=""}this.controls.q.removeClass("noq");this.controls.msg.hide()},inputBlur:function(b){Logger.debugLog("SearchFormWidget inputBlur");if(this.controls.q[0].value==""){this.controls.q.addClass("noq");this.controls.q[0].value=this.options.defaultValue}}});a.extend(a.ui.SearchFormWidget,{version:"1.0",defaults:{controlClass:"searchControl",defaultValue:"Search"}})})(jQuery);jQuery.widget("ui.spongeclient",{timeout_handler:null,default_options:{sponge_host:"sponge.gawker.com:8093",sponge_api_version:"v1",version:"0.2",chartbeat_update_interval:60,sponge_update_intervals:[60,120,180,300,600],sponge_update_limit:20,catch_events:["maincontent.postloaded","maincontent.forumloaded","maincontent.frontpageloaded","maincontent.classicfrontpageloaded"]},add_commas:function(b){b+="";x=b.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var a=/(\d+)(\d{3})/;while(a.test(x1)){x1=x1.replace(a,"$1,$2")}return x1+x2},_init:function(){for(var a in this.default_options){if(this.options[a]===undefined){this.options[a]=this.default_options[a]}}jQuery(window).bind("navigation.load",jQuery.proxy(function(b){this.hideWidget();if(this.timeout_handler!==null){clearTimeout(this.timeout_handler)}},this));jQuery(window).bind(this.options.catch_events.join(" "),jQuery.proxy(function(b){if(this.active){this.getChartbeatData()}},this));this.debug=false;this.first=true;this.notificationSent=new Array();this.getLatestPost()},startNotifier:function(){this.getLatestPost();return"post notifier started"},getLatestPost:function(){if(typeof spongelatestpost!=="undefined"){return false}var a="http://"+this.options.sponge_host+"/api/"+this.options.sponge_api_version+"/getLatestPost/?siteId="+notification_options.siteId;this.sponge_update_intervals=this.options.sponge_update_intervals.slice(0);this.sponge_update_count=0;this.xhr=jQuery.ajax({url:a,crossDomain:true,dataType:"jsonp",jsonp:"jsonP",jsonpCallback:"spongelatestpost",success:jQuery.proxy(function(d){var b=d.data.kinjalatestpost[notification_options.siteId];if(typeof b.postId!=="undefined"){this.latestPostId=d.data.kinjalatestpost[notification_options.siteId].postId;if(this.first&&this.debug){this.latestPostId=5885998;this.first=false}this.getNewPost()}else{if(typeof this.latestpost_timer!=="undefined"){window.clearTimeout(this.latestpost_timer)}this.latestpost_timer=setTimeout(jQuery.proxy(function(){this.getLatestPost()},this),(15*1000))}},this)})},refreshLatestPost:function(){if(typeof this.newpost_timer!=="undefined"){window.clearTimeout(this.newpost_timer)}if(typeof this.latestpost_timer!=="undefined"){window.clearTimeout(this.latestpost_timer)}this.latestpost_timer=setTimeout(jQuery.proxy(function(){this.getLatestPost()},this),(70*1000))},getNewPost:function(){if(typeof spongenewpost!=="undefined"){return false}var a="http://"+this.options.sponge_host+"/api/"+this.options.sponge_api_version+"/getPostsSince/?siteId="+notification_options.siteId+"&postId="+this.latestPostId;this.xhr=jQuery.ajax({url:a,crossDomain:true,dataType:"jsonp",jsonp:"jsonP",jsonpCallback:"spongenewpost",success:jQuery.proxy(function(e){if(typeof this.newpost_timer!=="undefined"){window.clearTimeout(this.newpost_timer)}var d=e.data.kinjapostssince[notification_options.siteId];if(d.ready==true&&typeof d.count!=="undefined"){var b=d.count;if(b>0&&(typeof this.notificationSent[this.latestPostId]=="undefined"||this.notificationSent[this.latestPostId]!=b)){this.notificationSent[this.latestPostId]=b;window.setTimeout(function(){jQuery(".newstory a").html(b==1?"New story posted":"New stories posted");
jQuery(".newstory").slideDown("500")},5*60*1000)}if((b<2)&&(this.sponge_update_count++<this.options.sponge_update_limit)){if(this.sponge_update_intervals.length){interval=this.sponge_update_intervals.shift()}else{interval=this.options.sponge_update_intervals[this.options.sponge_update_intervals.length-1]}this.newpost_timer=setTimeout(jQuery.proxy(function(){this.getNewPost()},this),(interval*1000))}}else{this.newpost_timer=setTimeout(jQuery.proxy(function(){this.getNewPost()},this),(15*1000))}},this)})},getChartbeatData:function(){this.getChartbeatDataForUrl(this.getCurrentUrl(this.options.forDomain));this.timeout_handler=setTimeout(jQuery.proxy(function(){this.getChartbeatData()},this),(this.options.chartbeat_update_interval*1000));this.active=true},getChartbeatDataForUrl:function(a){if(a===false){return false}if(typeof spongeresponse!=="undefined"){return false}var b="http://"+this.options.sponge_host+"/api/"+this.options.sponge_api_version+"/getStats/?url="+a+"&source=chartbeat";this.xhr=jQuery.ajax({url:b,crossDomain:true,dataType:"jsonp",jsonp:"jsonP",jsonpCallback:"spongeresponse",success:jQuery.proxy(this.insertResults,this)})},insertResults:function(d){delete this.xhr;if(d.meta===undefined||d.meta.success!==true){this.hideWidget();return false}var b=0;for(var a in d.data){chartbeat_data=d.data[a].chartbeat;if(chartbeat_data.ready===undefined||(chartbeat_data.ready!==undefined&&chartbeat_data.ready===true)){this.hideProgress();b=chartbeat_data.people;if(parseInt(b,10)===0){b=1}jQuery("#cb_number").html(this.add_commas(b))}else{this.showProgress()}}this.showWidget()},getCurrentUrl:function(b){if(!b){var a=jQuery("link[rel=canonical]").attr("href")}else{a=window.location.protocol+"//"+siteConfig.canonicalHost}a=a.replace(".local",".com");return a},showWidget:function(){if(this.element.is(":visible")){this.element.hide()}this.element.show()},hideWidget:function(){this.element.hide();this.hideProgress()},showProgress:function(){jQuery("#cb_progress").show();jQuery("#cb_label").hide()},hideProgress:function(){jQuery("#cb_progress").hide();jQuery("#cb_label").show()},stop:function(){if(this.xhr){this.xhr.abort()}clearTimeout(this.timeout_handler);this.active=false},start:function(){this.stop();this.getChartbeatData()}});jQuery.widget("ui.spongestatsclient",{timeout_handler:null,default_options:{sponge_protocol:"http",sponge_host:"api.gawker.com/sponge",sponge_api_version:"v1",version:"0.2",views_limit:1000,comments_limit:100,stats_enabled:true},requests_running:0,_init:function(){var a;for(a in this.default_options){if(this.options[a]===undefined){this.options[a]=this.default_options[a]}}},getStats:function(j,a,k){var f=[],b=5,m,e,n,g,d,h;if(this.options.stats_enabled!==true){return false}if(j.length===0){return false}h=this.options.sponge_protocol+"://"+this.options.sponge_host+"/api/"+this.options.sponge_api_version+"/getStats/";for(g=0,d=j.length;g<d;g++){m=Math.floor(g/b);if(f[m]===undefined){f[m]={params:{url:[],source:["views","comments"]}}}f[m].params.url.push(j[g])}for(g=0,d=f.length;g<d;g++){e=f[g].params;n="spcb_"+jQuery().crypt({method:"md5",source:"_"+e.url.join(" ")});if(jQuery.isFunction(window[n])){continue}this.requests_running++;this.xhr=jQuery.ajax({url:h,crossDomain:true,data:e,traditional:true,dataType:"jsonp",jsonp:"jsonP",jsonpCallback:n,success:jQuery.proxy(k,a)})}}});(function(a){a.widget("ui.ThreadWidget",{controls:{},params:{post_id:null,thread_id:null,mode:"all",page:0,append:false,repliesmode:"hide",nouser:false},threadlist:{},selected_thread:null,thread_visible:true,auth_done:false,post_load_done:false,initialize:function(){this.xhr=new XHR({klass:"thread",type:"GET",disableToken:true,beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.eventPostLoadedHandler.bind(this));this.subscribeForEvent("maincontent.tagpageloaded",this.eventPostLoadedHandler.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.eventForumLoadedHandler.bind(this));this.subscribeForEvent("commentform.",this.eventCommentFormHandler.bind(this));this.subscribeForEvent("threads.",this.eventHandler.bind(this))},traverse:function(){var b=this;var d=function(e,j,h){var g=b.getParam("cid",j),f=e.find(".jumpto_"+g).closest(".comment");j.addClass("l_"+h);if(f.length){f.each(function(k,l){d(e,jQuery(l),h+1)})}};this.controls.threadlist.find(".thread").each(function(f,g){d(jQuery(g),jQuery(g).children(".comment"),0)})},eventAuthHandler:function(b){if(this.auth_done===false){this.auth_done=true;if(this.post_load_done){this.parseUserSettings();this.loadThreadsForPost()}}},eventPostLoadedHandler:function(d){if(d.params.data.action=="post"||d.params.data.action=="tag"){this.resetElements();this.setControls();this.parseUserSettings();this.hideThreads();this.traverse();if(d.params.data.disable_comments===true){return false
}this.post_load_done=true;this.registerDOMHandlers();this.params.post_id=d.params.data.originalPostId||d.params.data.id;if(window.location.href.indexOf("?comment=")!=-1){var b=(window.location.href.match(/[?&]comment=(?:([0-9]+)\:)?([0-9]+)/));if(b!==null&&b[2]!==undefined){this.selected_thread=b[2];this.params.mode="permalink"}}if(this.auth_done===true){this.loadThreadsForPost()}}},eventForumLoadedHandler:function(b){this.params.mode="all";this.raiseEvent("threads.listloaded",{});this.resetElements();this.setControls();this.traverse();this.registerDOMHandlers()},eventCommentFormHandler:function(b){switch(b.name){case"commentform.cancel":if(this.thread_visible===false){this.showThreads()}if(this.params.thread_id&&jQuery(".t_"+this.params.thread_id).length>0){jQuery(".t_"+this.params.thread_id+" .comment:hidden").show()}break;case"commentform.open":this.setPagerMode("comment");break;case"commentform.setreplyto":this.setPagerMode();break;case"commentform.close":this.setPagerMode();break}},eventHandler:function(d){var b={};switch(d.name){case"threads.updatelist":this.loadThreadList();break;case"threads.listloaded":if(this.controls.showfeatured!==undefined){this.setPagerMode()}jQuery("#comments").lytebox({pager:false,spinner:true});break;case"threads.reloadthread":b.selected_thread=d.params.selected_thread;this.loadThread(b);break;case"threads.threadloaded":jQuery("#comments").lytebox({pager:false});break;case"threads.showthreads":this.showThreads();break;case"threads.insertcomment":this.appendComment(d.params.comment);break;case"threads.replacecomment":this.replaceComment(d.params.comment);break}},handleClick:function(k){var g=this.getParam("cn",jQuery(k.target));var n=null;switch(g){case"openthread":n=this.getParam("tid",jQuery(k.target));if(!n){k.stopPropagation();k.preventDefault()}this.loadThread({selected_thread:n,jumpto:false});k.stopPropagation();k.preventDefault();break;case"threadexpand":this.loadThread({jumpto:false});k.stopPropagation();k.preventDefault();break;case"togglereplies":n=this.getParam("tid",jQuery(k.target));var o=this.element.find(".t_"+n);var b=o.find(".cn_togglereplies").eq(0);var l=o.find(".replies").eq(0);var j=o.find("span.repliestoggle").eq(0);if(l.is(":visible")){l.slideUp("fast");j.html("Show");b.addClass("show").removeClass("hide")}else{l.slideDown("fast");j.html("Hide");b.addClass("hide").removeClass("show")}k.stopPropagation();k.preventDefault();break;case"jumpto":n=this.getParam("jumpto",jQuery(k.target));jQuery.scrollTo(".cid_"+n,"fast");k.stopPropagation();k.preventDefault();break;case"showfeatured":this.showSpinner();this.params.mode="featured";this.params.append=false;this.params.page=0;this.loadThreadList();k.stopPropagation();k.preventDefault();break;case"showall":this.showSpinner();this.params.mode="all";this.params.append=false;this.loadThreadList();k.stopPropagation();k.preventDefault();break;case"nextpage":this.params.page++;this.params.append=true;this.loadThreadList();k.stopPropagation();k.preventDefault();break;case"newdiscussion":this.raiseEvent("commentform.open",{clear:true,after:jQuery(".input_box_place")});k.stopPropagation();k.preventDefault();break;case"reply":var t=jQuery(k.target).closest(".comment");var f=this.getParam("cid",t);this.raiseEvent("commentform.open",{after:jQuery(".cid_"+f)});this.raiseEvent("commentform.setreplyto",{replyto:f});k.stopPropagation();k.preventDefault();break;case"question":var m=jQuery(k.target).children(".shortcomment_explained");if(jQuery(k.target).children(".shortcomment_explained:visible").length===0){m.show();m.bind("clickoutside",function(){m.hide();m.unbind("clickoutside")})}else{m.hide()}k.stopPropagation();k.preventDefault();break;case"dismiss":var h=jQuery(k.target).closest(".comment"),o=jQuery(k.target).closest(".thread"),s=this;var p=function(v){var u=s.getParam("cid",v),e=o.find(".jumpto_"+u).closest(".comment");if(e.length){e.each(function(w,y){e=e.add(p(jQuery(y)))})}return e};var l=p(h);var d=h.find(".pw_dismissedtext");var q=l.length+1;var r=q==1?"One comment has been moved to its":(""+q+" comments have been moved to their");d.html(d.html().replace("This comment has been moved to its",r));l.addClass("pw_dismissed_child");h.addClass("pw_dismissed");l.each(function(u,v){jQuery(v).height(jQuery(v).height())});k.stopPropagation();k.preventDefault();break}},loadThreadsForPost:function(){try{var b=-1;this.params.page=0;this.params.append=false;this.loadThreadList()}catch(d){}},loadThreadList:function(){try{var d={op:this.options.thread_action,post_id:this.params.post_id,mode:this.params.mode,page:this.params.page,repliesmode:this.params.repliesmode,nouser:this.params.nouser};if(this.selected_thread!==undefined){d.selected_thread=this.selected_thread;this.selected_thread=null}if(this.feature.isOn("powwow")){d.powwow=true}this.xhr.send("/index.php",d)}catch(b){}},loadThread:function(e){if(e.selected_thread!==undefined||(e.collapse_thread!==undefined&&e.collapse_thread)){this.params.thread_id=e.selected_thread}var d=this.controls.threadlist.find(".t_"+this.params.thread_id);
if(e.jumpto===true&&d.length>0){jQuery.scrollTo(d,"fast")}d.addClass("inprogress");var b={op:"commentthread",thread_id:this.params.thread_id,jumpto:e.jumpto};if(e.selected_comment){b.comment_id=e.selected_comment}if(window.pageType==="site_comments_admin"){b.external_tools=true}this.xhr.send("/index.php",b)},appendComment:function(d){if(d.is_reply===true){var b=jQuery(".cid_"+d.thread_id).closest(".thread");jQuery(".comment:last",b).after(d.content)}else{if(this.params.mode=="featured"){this.controls.threadlist.children().remove();this.controls.threadlist.html(d.content)}else{this.controls.threadlist.prepend(d.content);this.showThreads()}}},replaceComment:function(d){var b=jQuery(".cid_"+d.comment_id);if(b.length>0){b.replaceWith(d.content).show()}},hideThreads:function(){if(this.controls.threadlist!==undefined){this.controls.threadlist.children().hide();this.thread_visible=false}},showThreads:function(){if(this.controls.threadlist!==undefined){this.controls.threadlist.children().show();this.thread_visible=true}},setPagerMode:function(b){if(b===undefined){b=this.params.mode}this.controls.showfeatured.removeClass("selected");this.controls.showall.removeClass("selected");this.controls.newdiscussion.removeClass("selected");switch(b){case"permalink":break;case"all":this.controls.showall.addClass("selected");break;case"featured":this.controls.showfeatured.addClass("selected");break;case"comment":this.controls.newdiscussion.addClass("selected");break}},ajaxRequestHandler:function(){},ajaxSuccessHandler:function(d){if(d.action=="threadlist"){if(this.params.append===true){this.controls.threadlist.append(d.content)}else{this.controls.threadlist.html(d.content)}this.setControls();this.traverse();if(this.params.mode=="all"&&d.pager===true){this.controls.nextpage.show()}else{this.controls.nextpage.hide()}this.raiseEvent("threads.listloaded",{selected_thread:d.selected_thread});if(jQuery(".comment_list_placeholder .thread").length===0){this.raiseEvent("commentform.open",{clear:true,after:jQuery(".input_box_place"),nofocus:true})}this.hideSpinner();this.markSelfComments()}else{if(d.action=="commentthread"){jQuery(".inprogress").removeClass("inprogress");if(d.moved_comment!==true){var b=jQuery(".t_"+d.thread_id);if(b.length>0){b.html(d.content).slideDown("normal",function(){if(d.jumpto===true){var e=".t_"+d.thread_id;if(d.comment_id>0){e=".comment.cid_"+d.comment_id}jQuery.scrollTo(e,"fast")}})}}this.raiseEvent("threads.threadloaded",{data:d})}}},ajaxFailHandler:function(b){},registerDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));jQuery(document).bind("keyup",this.keyupHandler.bind(this))},keyupHandler:function(b){},unregisterDOMHandlers:function(){this.tearDownEventHandler(this.element,"click",this.handleClick.bind(this));jQuery(document).unbind("keyup",this.keyupHandler.bind(this))},refreshWidget:function(){this.setControls();this.traverse();this.toggleEditIcons()},parseUserSettings:function(){this.params.repliesmode="hide";if(this.auth.authenticated){this.params.mode=(this.params.mode!="permalink")?"all":"permalink";this.params.nouser=false}else{this.params.mode=(this.params.mode!="permalink")?"featured":"permalink";this.params.nouser=true}},markSelfComments:function(){if(this.auth.user!==null){jQuery(".comment.aid_"+this.auth.user.id).addClass("self")}},hideSpinner:function(){jQuery(this.controls.spinner).spin(false)},showSpinner:function(){jQuery(this.controls.spinner).spin("small")}});a.extend(a.ui.ThreadWidget,{version:"1.0",defaults:{action_name:"commentlist",thread_action:"threadlist",onHide:{},onShow:{},onReset:{},controlClass:"tc",externalElement:"#comments"}})})(jQuery);(function(a){a.widget("ui.ThreadAdminWidget",{controls:{},scope:"thread",initialize:function(){this.xhr=new XHR({klass:"threadadmin",type:"POST",beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.subscribeForEvent("threadadmin.",this.eventHandler.bind(this));this.subscribeForEvent("threads.",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},eventHandler:function(d){switch(d.name){case"threadadmin.messageadd":break;case"threadadmin.setpriority":break;case"threadadmin.priorityset":var f=this.element.find(".cid_"+d.params.comment_id).parents(".thread");var b=this.getParam("t",f);this.handlePriorityChange({comment_id:d.params.comment_id,priority:d.params.priority,thread_root_id:b});break;case"threadadmin.commentapproved":break;case"threadadmin.commentdeleted":this.element.find(".threadwrap.tid_"+d.params.comment_id).fadeOut();break;case"threadadmin.userstatusset":this.handleUserStatusChange({comment_id:d.params.comment_id,commenter_id:d.params.commenter_id,action:d.params.action});break}},eventThreadLoadedHandler:function(b){switch(b.name){case"threads.listloaded":case"threads.threadloaded":case"threads.insertcomment":case"threads.replacecomment":this.tearDownEventHandler(this.element,"click",this.handleClick.bind(this));
this.resetElements();this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.setControls();this.showIcons();break}},eventAuthHandler:function(b){this.showIcons()},handleClick:function(f){var d=jQuery(f.target);var j=this.getParam("cn",d);var h=d.closest(".comment");var b=this.getParam("cid",h);var g=this.getParam("aid",h);if(d.hasClass("single")){this.scope="comment"}else{this.scope="thread"}switch(j){case"promote":case"adminpromote":if(h.hasClass("us_pending")||h.hasClass("us_banned")){this.changeUserStatus({comment_id:b,commenter_id:g,action:"approve"})}else{this.setPriority({comment_id:b,priority:1,star_user:false})}f.preventDefault();f.stopPropagation();break;case"demote":case"admindemote":this.setPriority({comment_id:b,priority:0,star_user:false});f.preventDefault();f.stopPropagation();break;case"admindelete":this.setState({comment_id:b,commenter_id:g,state:"DELETED"});f.preventDefault();f.stopPropagation();break;case"adminpending":this.changeUserStatus({comment_id:b,commenter_id:g,action:"maybe"});f.preventDefault();f.stopPropagation();break;case"adminlinks":this.toggleAdminBox({comment_id:b,commenter_id:g});f.preventDefault();f.stopPropagation();break;case"adminpage":this.toggleAdminBox({});window.location="http://commentadmin."+window.location.hostname+"/index.php?op=userlist_search&id="+g+"&siteId="+siteConfig.id;f.preventDefault();f.stopPropagation();break;case"edit":case"adminedit":this.editComment({comment_id:b});f.preventDefault();f.stopPropagation();break;case"approveuser":this.controls.s_ind.show();this.changeUserStatus({comment_id:b,commenter_id:g,action:"approve"});f.preventDefault();f.stopPropagation();break;case"openwarndialog":this.toggleWarnDialog({comment_id:b,commenter_id:g});this.toggleAdminBox({});f.preventDefault();f.stopPropagation();break;case"closewarndialog":this.toggleWarnDialog({});this.toggleAdminBox({});f.preventDefault();f.stopPropagation();break;case"submituserwarn":this.submitWarning({comment_id:b,commenter_id:g});f.stopPropagation();f.preventDefault();break;case"communitypolicy":this.raiseEvent("policypopup.toggle",{});f.stopPropagation();f.preventDefault();break}},ajaxRequestHandler:function(){this.controls.s_ind.show()},ajaxSuccessHandler:function(d){this.controls.s_ind.hide();var e={};var b=jQuery(".comment.cid_"+d.commentId+" .please_leave_a_message");switch(d.action){case"promotethread":if(d.success===true){e={comment_id:d.commentId,priority:d.priority};this.raiseEvent("threadadmin.priorityset",e)}else{Message.showMessage(d.message,b[0],{stable:false})}break;case"changecommentstatus":if(d.success===true){e={comment_id:d.commentId};if(d.publishStatus=="DELETED"){this.raiseEvent("threadadmin.commentdeleted",e)}}else{Message.showMessage("Comment status setting failed, please try again later",b[0],{stable:false})}break;case"approveuser":if(d.success===true){e={comment_id:d.commentId,commenter_id:d.commenterId,action:"approve"};this.raiseEvent("threadadmin.userstatusset",e)}else{Message.showMessage("User approve failed, please try again later",b[0],{stable:false})}break;case"maybeuser":if(d.success===true){e={comment_id:d.commentId,commenter_id:d.commenterId,action:"maybe"};this.raiseEvent("threadadmin.userstatusset",e)}else{Message.showMessage("Setting user pending status failed, please try again later",b[0],{stable:false})}break;case"ajax_warncommenter":this.controls.uw_progress.hide();if(d.success){Message.showMessage("Success",this.controls.uw_message[0],{stable:false,onComplete:function(){this.toggleWarnDialog({});var f='(see <a href="/communitypolicy" class="tac cn_policylink">Community Policy</a>)';var g;g='<a href="/people/'+this.auth.user.username+'/">'+this.auth.user.displayName+"</a> ";if(d.type){switch(d.type){case"warn":g+="warned ";break;case"suspend":g+="suspended ";break;case"ban":g+="banned ";break}g+="this user"}if(d.tagname){if(d.type){g+=" and "}g+='moved this <a href="/'+d.tagname+"/forum?comment="+d.moved_id+'">thread</a> to <a href="/'+d.tagname+'/forum">#'+d.tagname+"</a>";this.element.find(".cid_"+d.root_id+" .ctedit").html("");this.element.find(".cid_"+d.root_id+" .metatext").append('<div class="warnedBy">'+g+" "+f+"</div>");this.element.find(".thread.t_"+d.root_id+" .threadfooter").html("")}else{this.element.find(".cid_"+d.id+" .metatext").append('<div class="warnedBy">'+g+" "+f+"</div>")}}.bind(this,d)})}else{Message.showMessage(d.reason,this.controls.uw_message[0],{stable:false,onComplete:function(){}})}break}},ajaxFailHandler:function(b){this.controls.s_ind.hide()},showIcons:function(){if(this.controls.adminlinks===undefined){return false}if(this.controls.promote){this.controls.promote.css({display:"none"})}if(this.controls.demote){this.controls.demote.css({display:"none"})}if(this.controls.adminedit){this.controls.adminedit.css({display:"none"})}this.element.find(".cn_togglestar").removeClass("hoverable");this.element.find(".cn_togglestar").attr("title","");if(!this.auth.authenticated){return false}if(this.auth.hasLevel("editors",siteConfig.id)){this.element.find(".p_1 .cn_demote").css({display:""});
this.element.find(".p_0 .cn_promote").css({display:""});this.controls.adminlinks.css({display:""});this.element.find(".cn_togglestar").addClass("hoverable");this.element.find(".cn_togglestar").attr("title","Toggle star")}else{if(this.auth.hasLevel("commentadmins",siteConfig.id)){this.controls.adminlinks.css({display:""});this.element.find(".cn_togglestar").addClass("hoverable");this.element.find(".cn_togglestar").attr("title","Toggle star");this.element.find(".p_0 .cn_promote").css({display:""})}else{if(this.auth.hasLevel("starcommenters",siteConfig.id)){this.element.find(".p_0 .cn_promote").css({display:""})}}}if(this.auth.hasLevel("commentadmins",siteConfig.id)){this.controls.adminedit.css({display:""})}this.controls.edit.css({display:"none"});this.element.find(".ue.aid_"+this.auth.user.id+" .commentedit").css({display:""})},toggleAdminBox:function(b){if(this.controls.adminbox===undefined){return false}if(b.comment_id===undefined||this.controls.adminbox.is(":visible")){this.controls.adminbox_placetobe.append(this.controls.adminbox).hide()}else{this.element.find(".cid_"+b.comment_id).append(this.controls.adminbox.show())}},setPriority:function(d){var b={op:"ajax_promotethread",comment_id:d.comment_id,priority:d.priority};this.xhr.send(this.options.action_url,b)},handlePriorityChange:function(b){this.controls.s_ind.hide();this.toggleAdminBox({});if(this.scope==="comment"){this.element.find(".cid_"+b.comment_id).removeClass("p_0 p_1").addClass("p_"+b.priority)}else{if(b.thread_root_id){this.raiseEvent("threads.reloadthread",{selected_thread:b.thread_root_id})}}},setState:function(d){var b={op:"changecommentstatus",id:d.comment_id,publishStatus:d.state};this.xhr.send(this.options.action_url,b)},changeUserStatus:function(d){if(d.commenter_id===undefined||d.action===undefined){return false}var b={op:"changeuserstatus",action:d.action,id:d.commenter_id,siteId:siteConfig.id,commentId:d.comment_id};this.xhr.send(this.options.action_url,b)},handleUserStatusChange:function(b){this.controls.s_ind.hide();this.toggleAdminBox({});switch(b.action){case"approve":this.element.find(".aid_"+b.commenter_id).removeClass("cs_draft us_pending us_banned");this.element.find(".cid_"+b.comment_id+" cite").after('<span class="promotedBy">approved by '+this.auth.user.smartName+"</span>");break;case"maybe":this.element.find(".aid_"+b.commenter_id).addClass("cs_draft us_pending");break}},toggleWarnDialog:function(b){if(b.comment_id===undefined&&this.controls.warndialog.is(":visible")){this.controls.warndialog_placetobe.append(this.controls.warndialog).hide();this.controls.uw_moveto.unbind("change");this.controls.uw_state.val("");this.controls.uw_moveto.val("");this.controls.uw_moveto_other.val("").hide()}else{this.element.find(".cid_"+b.comment_id).append(this.controls.warndialog.show());this.controls.uw_moveto.bind("change",function(){if(this.controls.uw_moveto.val()=="other"){this.controls.uw_moveto_other.show()}else{this.controls.uw_moveto_other.hide()}}.bind(this))}},submitWarning:function(f){var b=this.controls.uw_moveto.val();if(b=="other"){b=this.controls.uw_moveto_other.val()}if(b.substring(0,1)=="#"){b=b.substring(1)}var e=this.controls.uw_state.val();if(b||e){var d={op:"ajax_warncommenter",id:f.comment_id,tagname:b,type:e};this.controls.uw_progress.show();this.xhr.send(this.options.action_url,d)}else{this.toggleWarnDialog({})}},editComment:function(b){if(b.comment_id===undefined){return false}this.raiseEvent("commentform.setedit",{comment_id:b.comment_id});this.toggleAdminBox({})}});a.extend(a.ui.ThreadAdminWidget,{version:"1.0",defaults:{action_url:"/index.php",onHide:{},onShow:{},onReset:{},controlClass:"tac",externalElement:"#comments"}})})(jQuery);(function($){$.widget("ui.UserWidget",{xhr:null,default_options:{},initialize:function(){this.xhr=new XHR({klass:"presence",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClicks.bind(this));var panels={};if(this.controls.userinit_dialog){panels.userinit={el:this.controls.userinit_dialog}}if(this.controls.burnerlogin_dialog){panels.burnerlogin={el:this.controls.burnerlogin_dialog};$("#burnerLoginForm").submit(this.handleBurnerLogin.bind(this))}if(this.controls.burnercreate_dialog){panels.burnercreate={el:this.controls.burnercreate_dialog,focus:$(".burnercreate_dialog #burnerCreateScreenName")};$("#burnerCreateForm").submit(this.handleBurnerCreate.bind(this))}if(this.controls.burnercreatesuccess_dialog){panels.burnercreatesuccess={el:this.controls.burnercreatesuccess_dialog}}if(this.controls.oauthscreenname_dialog){panels.oauthscreenname={el:this.controls.oauthscreenname_dialog};$("#oauthScreenForm").submit(this.handleOauthScreen.bind(this));var obj=this}if(this.controls.oauthclaim_dialog){panels.oauthclaim={el:this.controls.oauthclaim_dialog};$("#oauthClaimForm").submit(this.handleOauthClaim.bind(this))}if(this.controls.resetpw_dialog){panels.resetpw={el:this.controls.resetpw_dialog};
$("#resetKinjaPwForm").submit(this.handleResetKinjaPw.bind(this))}if(this.controls.converted_dialog){panels.converted={el:this.controls.converted_dialog}}if(this.controls.login_dialog){panels.login={el:this.controls.login_dialog};$("#kinjaLoginForm").submit(this.handleKinjaLogin.bind(this))}if(this.controls.oauthconvert_dialog){panels.oauthconvert={el:this.controls.oauthconvert_dialog}}if(this.controls.user_dialog){panels.user={el:this.controls.user_dialog}}if(this.controls.recaptcha_dialog){panels.recaptcha={el:this.controls.recaptcha_dialog}}this.commondialogs.initDialogs({overlay:this.controls.overlay,panels:panels,group:false});if(location.search.indexOf("dialog=")!==-1){var obj=this;setTimeout(function(){var dialogName=location.search.replace(/^.*dialog=([a-z]+).*$/,"$1");obj.commondialogs.toggleDialog({which:dialogName})},1000)}this.subscribeForEvent("presence.requiredialog",this.outsideEventHandler.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("presence.requiresequence.",this.outsideEventHandler.bind(this));this.subscribeForEvent("dialog.afterOpen.",this.handleDialogOpen.bind(this));jQuery("body").live("loginRequest",$.proxy(function(){this.raiseEvent("presence.requiresequence.guest",{})},this));this.auth.getUserState()},toggleUserInitDialog:function(e){this.commondialogs.toggleDialog({which:"userinit"})},handleClicks:function(e){var target=$(e.target);var controlName=this.getParam("cn",e.target);if(target.attr("id")==="burnerButton"){this.commondialogs.toggleDialog({which:"burnercreate"});e.stopPropagation();e.preventDefault()}else{if(controlName==="togglelogindialog"){this.toggleUserInitDialog(e);e.stopPropagation();e.preventDefault()}else{if(target.attr("id")==="burnerLoginButton"){this.commondialogs.toggleDialog({which:"burnerlogin"});e.stopPropagation();e.preventDefault()}else{if(controlName==="touserinit"){this.toggleUserInitDialog(e);e.stopPropagation();e.preventDefault()}else{if(controlName==="toburnercreate"){this.commondialogs.toggleDialog({which:"burnercreate"});e.stopPropagation();e.preventDefault()}else{if(target.attr("id")==="burnerRegisterButton"||controlName==="toggleburnercreate"){this.commondialogs.toggleDialog({which:"burnercreate"});e.stopPropagation();e.preventDefault()}else{if(controlName==="login_oauth"){var loginType=this.getParam("type",e.target);this.oauthLogin(loginType);e.stopPropagation();e.preventDefault()}else{if(controlName==="logout_link"){e.stopPropagation();e.preventDefault();this.mystate="loggedin:logging_out:clicked";this.controls.user_menu.hide();if(this.controls.loginmessage!==undefined){this.controls.loginmessage.html("")}var public_profile=this.auth.user?"/people/"+this.auth.user.username:false;var s=document.createElement("script");s.type="text/javascript";s.src="/sso/logout_request";s.async=true;var obj=this;globalLogoutFunc=function(){obj.auth.getUserState();if(window.Powwow!==undefined){Powwow.loadUser()}if(window.location.pathname.indexOf("/me/")==0||window.location.pathname=="/me"){if(public_profile){window.location.href=public_profile}}obj.controls.user_dialog.hide()};jQuery("body").append(s);var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(s,r);this.controls.profile_link.html("Logging out...");if(this.controls.logout_panel){this.controls.logout_panel.hide()}}else{if(controlName==="profile_link"){e.stopPropagation();e.preventDefault();this.raiseEvent("notification.togglelist")}else{if(controlName==="profile_link_icon"){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog({which:"user"})}else{if(controlName==="toggleclaim"){e.stopPropagation();e.preventDefault();this.showClaimDialog()}else{if(controlName==="kinjalogin"){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog({which:"login"})}else{if(controlName==="converted_ok"){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog({which:"converted"})}else{if(controlName==="burnercreatesucces_ok"){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog({which:"burnercreatesuccess"})}else{if(controlName==="toggleforgotpassword"){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog({which:"resetpw"})}else{if(controlName.indexOf("_cancel")!==-1){e.stopPropagation();e.preventDefault();var dialogName=controlName.replace("_cancel","");this.commondialogs.toggleDialog({which:dialogName})}else{if(controlName==="overlay"){if(jQuery(".cn_ssousermigrate_dialog:visible").length==0&&jQuery(".cn_burnercreatesuccess_dialog:visible").length==0){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog()}}else{if(controlName==="recaptcha_submit"){e.stopPropagation();e.preventDefault();this.submitCaptcha()}}}}}}}}}}}}}}}}}}},handleAjaxRequest:function(e){},handleAjaxFail:function(e){this.workingInBackground=false},handleAjaxSuccess:function(data){var action=null;if(data.action!==undefined){action=data.action}else{if(data.meta!==undefined&&data.meta["method"]!==undefined){action=data.meta["method"]
}}this.workingInBackground=false;switch(action){case"registerBurner":if(data.meta.success){jQuery("#burnerCreateSuccessScreenName").html($("#burnerCreateScreenName").val());jQuery("#burnerCreateSuccessToken").html(data.data.token);if(window.Powwow!==undefined){Powwow.loadUser()}this.auth.getUserState();this.justLoggedIn=false;this.commondialogs.toggleDialog({which:"burnercreatesuccess"})}else{if(data.data.type=="InvalidRecaptchaException"){this.showMessage("burnerCreate","CaptchaFail");Recaptcha.reload()}else{if(data.data.type=="InvalidScreenNameException"){this.showMessage("burnerCreate","Invalid")}else{this.showMessage("burnerCreate","Fail")}}}break;case"checkLogin":var prefix="";if(data.target==="oauthscreenform"){if(data.success&&data.available&&data.valid){this.workingInBackground=true;this.xhr.send("/sso/attach?username="+encodeURIComponent($("#oauthScreenName").val()))}else{if(!data.valid){this.showMessage("oauthScreenName","Invalid")}else{if(data.inKinja&&!data.inSso){this.showMessage("oauthScreenName","Kinja")}else{this.showMessage("oauthScreenName","Fail")}}}}else{if(data.target==="burnercreate"){if(data.success&&data.available&&data.valid){this.hideMessages("burnerCreate");this.displayBurnerCaptcha()}else{if(!data.valid){this.showMessage("burnerCreate","Invalid")}else{if(data.inKinja&&!data.inSso){this.showMessage("burnerCreate","Kinja")}else{this.showMessage("burnerCreate","Fail")}}}}else{switch(data.target){case"login":prefix="burnerLogin";break;case"create":prefix="burnerCreate";break;case"oauthscreenname":prefix="oauthScreenName";if(data.success&&!data.available){this.existingScreenName=true}break}if(data.success&&data.available&&data.valid){this.showMessage(prefix,"Success")}else{if(!data.valid){this.showMessage(prefix,"Invalid")}else{if(data.inKinja&&!data.inSso){this.showMessage(prefix,"Kinja")}else{this.showMessage(prefix,"Fail")}}}}}break;case"burnerLogin":if(data.meta.success){this.showMessage("burnerLogin","Success");if(window.Powwow!==undefined){Powwow.loadUser()}this.auth.getUserState();this.justLoggedIn=false;(function(obj){setTimeout(function(){obj.commondialogs.toggleDialog({})},1000)})(this)}else{this.showMessage("burnerLogin","Fail")}break;case"attach":if(data.success){this.showMessage("oauthScreenName","Saved");if(window.Powwow!==undefined){Powwow.loadUser()}this.auth.getUserState();(function(obj){setTimeout(function(){obj.commondialogs.toggleDialog({})},1000)})(this)}else{if(!data.valid){this.showMessage("oauthScreenName","Invalid")}else{this.showMessage("oauthScreenName","NotSaved")}}break;case"attach_existing":if(data.success){this.commondialogs.toggleDialog({which:"converted"});if(window.Powwow!==undefined){Powwow.loadUser()}this.auth.getUserState()}else{this.showMessage("oauthClaim","NotSaved")}break;case"kinja_login":if(data.success){this.commondialogs.toggleDialog({which:"oauthconvert"})}else{this.showMessage("kinjaLogin","Fail")}break;case"resetpassword":if(data.success){$("#resetKinjaPwdSuccessMessage").html(data.message);this.showMessage("resetKinjaPwd","Success");(function(obj){setTimeout(function(){obj.commondialogs.toggleDialog({})},1000)})(this)}else{$("#resetKinjaPwdFailMessage").html(data.message);this.showMessage("resetKinjaPwd","Fail")}}},addCheckLogin:function(selector,prefix,target,callback){(function(obj){var timer=null;$(selector).keyup(function(e){if(callback!==undefined){callback()}if(timer!==null){clearTimeout(timer)}if($(e.target).val().length==0){obj.hideMessages()}else{timer=setTimeout(function(){obj.showMessage(prefix,"Check");obj.checkLogin($(selector).val(),target)},1000)}})})(this)},checkLogin:function(username,target){this.xhr.send("/sso/checkLogin?target="+target+"&username="+encodeURIComponent(username))},handleBurnerLogin:function(e){e.stopPropagation();e.preventDefault();var screenName=$("#burnerLoginScreenName").val();var token=$("#burnerLoginToken").val($("#burnerLoginToken").val().replace(/[^a-zA-Z]/g,"")).val();if(screenName.length===0){this.showMessage("burnerLogin","NameEmpty")}else{if(token.length===0){this.showMessage("burnerLogin","TokenEmpty")}else{if(this.workingInBackground!==true){this.workingInBackground=true;var s=document.createElement("script");s.async="async";var funcName="burnerLogin"+Math.round(Math.random()*1000000);var obj=this;eval(funcName+" = function(data) {obj.handleAjaxSuccess(data)};");s.src=window.ssoOptions.ssoHost+"/v1/burnerLogin?consumer="+window.ssoOptions.consumerId+"&username="+encodeURIComponent(screenName)+"&burner="+token+"&cookieSuffix="+window.ssoOptions.cookieSuffix+"&jsonP="+funcName;var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;head.insertBefore(s,head.firstChild);this.showMessage("burnerLogin","Login")}}}},handleBurnerCreate:function(e){e.stopPropagation();e.preventDefault();var screenName=$("#burnerCreateScreenName").val();if(screenName.length===0){this.showMessage("burnerCreate","NameEmpty")}else{if(this.workingInBackground!==true){this.checkLogin(screenName,"burnercreate");
this.showMessage("burnerCreate","Check")}}},displayBurnerCaptcha:function(){var screenName=$("#burnerCreateScreenName").val();var callback=(function(obj,name,options){return function(challenge,response){obj.commondialogs.toggleDialog({which:"burnercreate",resetName:false});var s=document.createElement("script");s.async="async";var funcName="getBurner"+Math.round(Math.random()*1000000);eval(funcName+" = function(data) {obj.handleAjaxSuccess(data)};");var params=["consumer="+options.consumerId,"loginName="+encodeURIComponent(name),"cookieSuffix="+options.cookieSuffix,"recaptcha_challenge_field="+encodeURIComponent(challenge),"recaptcha_response_field="+encodeURIComponent(response),"jsonP="+funcName];s.src=window.ssoOptions.ssoHost+"/v1/registerBurner?"+params.join("&");var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;head.insertBefore(s,head.firstChild);obj.showMessage("burnerCreate","Create")}})(this,screenName,window.ssoOptions);this.displayCaptcha(callback)},displayCaptcha:function(callback){this.captchaCallback=callback;if(window.Recaptcha!==undefined){this.showCaptcha(false)}else{var that=this;var checkRecaptcha=function(tries){if(tries===undefined){tries=0}if(tries<50){if(window.Recaptcha===undefined){setTimeout(function(){checkRecaptcha(tries+1)},100)}else{that.showCaptcha(true)}}};var s=document.createElement("script");s.async="async";s.src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js";var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;head.insertBefore(s,head.firstChild);checkRecaptcha()}},showCaptcha:function(init){this.commondialogs.toggleDialog({which:"recaptcha"});if(init){Recaptcha.create(window.ssoOptions.recaptchaKey,"recaptchaContainer",{callback:Recaptcha.focus_response_field})}else{Recaptcha.reload({callback:Recaptcha.focus_response_field})}function focusCaptchaField(tries){var el=document.getElementById("recaptcha_response_field");if(el){el.focus()}else{if(tries<50){setTimeout(function(){focusCaptchaField(tries+1)},700)}}}focusCaptchaField(0)},submitCaptcha:function(){this.captchaCallback(Recaptcha.get_challenge(),Recaptcha.get_response())},showClaimDialog:function(){var screenName=$("#oauthScreenName").val();$("#oauthClaimScreenNameData").val(screenName);$("#oauthClaimScreenName").html(screenName);this.commondialogs.toggleDialog({which:"oauthclaim"})},handleOauthScreen:function(e){e.stopPropagation();e.preventDefault();var screenName=$("#oauthScreenName").val();if(screenName.length===0){this.showMessage("oauthScreenName","Empty")}else{if(this.existingScreenName){this.showClaimDialog()}else{if(this.workingInBackground!==true){this.workingInBackground=true;this.checkLogin(screenName,"oauthscreenform");this.showMessage("oauthScreenName","Save")}}}},handleOauthClaim:function(e){e.stopPropagation();e.preventDefault();var username=$("#oauthClaimScreenName").html();var password=$("#oauthClaimPassword").val();if(password.length===0){this.showMessage("oauthClaim","Empty")}else{if(this.workingInBackground!==true){this.workingInBackground=true;this.showMessage("oauthClaim","Save");this.xhr.send("/sso/attach_existing",{username:username,password:password})}}},handleKinjaLogin:function(e){e.stopPropagation();e.preventDefault();var username=$("#kinjaLoginUsername").val();var password=$("#kinjaLoginPassword").val();if(username.length===0){this.showMessage("kinjaLogin","EmptyUsername")}else{if(password.length===0){this.showMessage("kinjaLogin","EmptyPassword")}else{if(this.workingInBackground!==true){this.workingInBackground=true;this.showMessage("kinjaLogin","Save");this.xhr.send("/sso/kinja_login",{username:username,password:password})}}}},handleResetKinjaPw:function(e){e.stopPropagation();e.preventDefault();var email=jQuery("#kinjaResetEmail").val();if(email.length==0){this.showMessage("resetKinjaPwd","Empty")}else{if(email.match(/^.+@[a-zA-Z0-9\-\.]+$/)==null){this.showMessage("resetKinjaPwd","Invalid")}else{if(this.workingInBackground!==true){this.workingInBackground=true;var params={email:email,recaptcha_challenge_field:jQuery("#recaptcha_challenge_field").val(),recaptcha_response_field:jQuery("#recaptcha_response_field").val()};this.xhr.send("/index.php?op=emailpassword",params);this.showMessage("resetKinjaPwd","Sending")}}}},delFetchUserState:function(){var domain=location.host.replace(/^(.+\.)?([a-zA-Z0-9]+\.[a-zA-Z0-9]+)$/,"$2");jQuery.cookie("fetchUserState2",null,{path:"/",domain:"."+domain});jQuery.cookie("fetchUserState2",null,{path:"/",domain:domain});jQuery.cookie("fetchUserState2",null,{path:"/"})},oauthLogin:function(type){var url="/sso/login_request?&provider="+type.replace(/[^a-z]/,"");this.delFetchUserState();var obj=this;var checkCookies=function(){if(jQuery.cookie("fetchUserState2")==1){obj.commondialogs.toggleDialog({});var regNeedle="redirectToProfilePage=1";obj.auth.resetRevision();if(document.cookie.indexOf(regNeedle)!=-1||document.location.pathname.substring(0,3)=="/me"){obj.delFetchUserState();
window.location="/me#|profileedit"}else{if(window.Powwow!==undefined){Powwow.loadUser()}}obj.auth.getUserState();obj.justLoggedIn=true}else{setTimeout(checkCookies,200)}};checkCookies();window.open(url,"","width=900,height=500")},handleDialogOpen:function(e){this.workingInBackground=false;var dialogName=e.name.replace("dialog.afterOpen.","");switch(dialogName){case"burnercreate":if(e.params.resetName===undefined||e.params.resetName===true){this.hideMessages("burnerCreate");$("#burnerCreateScreenName").val("")}break;case"burnerlogin":this.hideMessages("burnerLogin");$("#burnerLoginScreenName").val("");$("#burnerLoginToken").val("");break;case"oauthscreenname":this.hideMessages("oauthScreenName");if(jQuery.cookie("newUser")==0){jQuery("#oauthScreenNameReturningUserLabel").show();jQuery("#oauthScreenNameNewUserLabel").hide()}else{jQuery("#oauthScreenNameReturningUserLabel").hide();jQuery("#oauthScreenNameNewUserLabel").show()}$("#oauthScreenName").val("");break;case"oauthclaim":this.hideMessages("oauthClaim");$("#oauthClaimPassword").val("");break;case"login":this.hideMessages("kinjaLogin");$("#kinjaLoginUsername").val("");$("#kinjaLoginPassword").val("");break;case"resetpw":if(this.recaptchaKey===undefined){this.recaptchaKey=$("#kinjaResetRecaptcha").html();$("#kinjaResetRecaptcha").html("")}if(window.Recaptcha===undefined){(function(key){$.getScript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){try{Recaptcha.create(key,"kinjaResetRecaptcha")}catch(e){}})})(this.recaptchaKey)}else{try{if($("#kinjaResetRecaptcha").html()==""){Recaptcha.create(key,"kinjaResetRecaptcha")}else{Recaptcha.reload()}}catch(e){}}this.hideMessages("resetKinjaPwd");$("#kinjaResetEmail").val("");break;case"converted":var provider="";if(this.ssoUser!==null&&this.ssoUser!==undefined){provider=this.ssoUser.authType;provider=provider.substr(0,1).toUpperCase()+provider.substr(1)}$("#convertedProviderName").html(provider);break}},outsideEventHandler:function(e){switch(e.name){case"presence.requiresequence.guest":this.toggleUserInitDialog(e);break}},authEventHandler:function(e){this.authEventObject=e;var is_init=this.inState("init");var max_name_length=22;var ssoFailure=function(obj){obj.controls.profile_panel.hide();obj.controls.login_panel.show();obj.mystate="loggedout:no_dialog";if(obj.options.loginNeeded==true){obj.commondialogs.toggleDialog({which:"login"})}};switch(e.name){case"user.auth.ssoSuccess":this.ssoUser=e.source.data.user;if(e.source.data.user.converted>0){if(this.controls.profile_link){var profileLabel=e.source.data.user.displayName;if(profileLabel.length>max_name_length){profileLabel=profileLabel.substr(0,max_name_length)+"..."}profileLabelTxt=profileLabel;profileLabel+='<span id="profileNotificationCounter" class="site-bg-color" style="display:none"></span>';var href="/me";var isBurner=false;jQuery("#userNotificationContainer").removeClass("burner");jQuery("#userMenu").removeClass("burner");if(e.source.data.user.authType=="burner"){isBurner=true}if(this.controls.profile_link){this.controls.profile_link.attr("href",href).html(profileLabel)}if(this.controls.profile_link_icon){this.controls.profile_link_icon.attr("href",href).attr("title",profileLabelTxt)}if(this.controls.goto_profile){this.controls.goto_profile.attr("href",href);this.controls.goto_profile.show()}}this.controls.profile_panel.show();this.controls.login_panel.hide();if(this.justLoggedIn!==undefined&&this.justLoggedIn===true){this.justLoggedIn=false;var user=this.auth.ssoUser;if(user===null&&this.auth.kinjaUserId>0){this.commondialogs.toggleDialog({which:"oauthconvert"})}}this.mystate="loggedin"}else{if(e.source.data.user.converted==0){ssoFailure(this);if(this.justLoggedIn!==undefined&&this.justLoggedIn===true){this.justLoggedIn=false;this.commondialogs.toggleDialog({which:"oauthscreenname"})}}}break;case"user.auth.ssoFailure":this.ssoUser=null;ssoFailure(this);break}if(typeof(this.dialogHandler)=="function"){this.dialogHandler()}this.dialogHandler=-1;if(is_init&&window.location.hash.length>0){var hashparts=window.location.hash.split("|");if(hashparts.length>1){this.raiseEvent("presence.requiredialog",{mode:hashparts[1],hash:window.location.pathname})}}if(pageType=="frontpage"){jQuery.cookie("ad_url_visited_"+this.auth.site.canonicalHost.replace(/\./,"_"),"true",{expires:2592000,path:"/"})}},showMessage:function(prefix,selectedId){this.hideMessages(prefix);jQuery("#"+prefix+selectedId+"Message").show()},hideMessages:function(prefix){jQuery("."+prefix+"Message").hide()}});$.extend($.ui.UserWidget,{version:"1.0",defaults:{controlClass:"user_control"}})})(jQuery);(function(a){a.widget("ui.WarningCountWidget",{xhr:null,initialize:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.xhr=new XHR({klass:"warningcount",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)})},handleClick:function(g){var f=this.getParam("cn",jQuery(g.target));switch(f){case"decrease":case"increase":var j=prompt("Add some comment please");
if(null!=j){var d=this.getParam("uId",jQuery(g.target));var h={op:"changewarningcount",userId:d,direction:(jQuery(g.target).hasClass("cn_decrease")?-1:1),comment:j};this.xhr.send(this.options.action_url,h);jQuery("#action_indicator_"+d).show()}g.stopPropagation();g.preventDefault();break;case"history_toggle":var d=this.getParam("uId",jQuery(g.target));var b=jQuery("#warning_history_container_"+d)[0];if(b.style.display=="none"){b.style.display="";this.loadHistory(d)}else{b.style.display="none"}g.stopPropagation();g.preventDefault();break}},handleAjaxRequest:function(){},handleAjaxSuccess:function(b){jQuery("#action_indicator_"+b.userId).hide();jQuery(".cn_history_toggle").filter(".uId_"+b.userId)[0].innerHTML=b.warnCount;this.loadHistory(b.userId)},handleAjaxFail:function(){jQuery("#action_indicator_"+data.userId).hide()},loadHistory:function(b){var d={op:"userlist_warning_history",userId:b};jQuery("#warning_history_openable_indicator_"+b).show();jQuery("#warning_history_"+b).hide();jQuery("#warning_history_"+b).load(this.options.action_url,d,function(){jQuery("#warning_history_openable_indicator_"+b).hide();jQuery("#warning_history_"+b).show()})},hideWidget:function(){},showWidget:function(){},resetWidget:function(){}});a.extend(a.ui.WarningCountWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"warningcount_control"}})})(jQuery);(function(a){a.widget("ui.AdUnit",a.extend({},a.ui.AdUnitAncestor.prototype,{}));a.extend(a.ui.AdUnit,{version:"1.0",defaults:a.extend({},a.ui.AdUnitAncestor.defaults,{adserver_host:"localhost:8800",controlClass:"ad_control",selectors:{"80x45_container":".post",thumb_container:".thumb_container","80x45_text":".hwrap"},special_togglers:{"300x250_rightbar":{show:{right_on:function(b){jQuery("#tomorrowsnews").hide();if(window.navigator.userAgent.match(/iPad/i)===null){window.adRobot.rightBarFixer.start(b);window.adRobot.rightBarFixer.fix()}}},hide:{right_on:function(b){if(window.navigator.userAgent.match(/iPad/i)===null){var d=jQuery("#rightcontainer");var e=jQuery("#rightbar_scroller");if(e.length){if(false===(window.adRobot.marquee_running||window.adRobot.interstitial_running)){e.height(d.height()-e.offset().top+jQuery(window).scrollTop())}window.adRobot.rightBarFixer.stop(b);window.adRobot.rightBarFixer.fix();jQuery("#tomorrowsnews").show()}}}}}}})})}(jQuery));(function(a){a.widget("ui.EditorControlsWidget",{adminlinks_open:false,initialize:function(){this.xhr=new XHR({klass:"editorcontrols",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});var b={};var d=false;if(this.controls.starinvite_form){b.starinvite={el:this.controls.starinvite_dialog,focus:this.controls.starinvite_email};this.starinvite_validator=new Validator(jQuery.extend({},{scope:this.controls.starinvite_form}));this.registerEventHandler(this.controls.starinvite_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.starinvite_form,"submit",this.handleStarInviteSubmit.bind(this));this.controls.starinvite_form[0].reset();d=true}if(this.controls.tagheader_form){b.tagheader={el:this.controls.tagheader_dialog,focus:this.controls.tagheader_entry};this.tagheader_validator=new Validator(jQuery.extend({},{scope:this.controls.tagheader_form}));this.registerEventHandler(this.controls.tagheader_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.tagheader_form,"submit",this.handleTagheaderSubmit.bind(this));this.controls.tagheader_form[0].reset();d=true}if(d){this.commondialogs.initDialogs({overlay:this.controls.overlay,panels:b,group:this.options.dialoggroup?this.options.dialoggroup:false})}this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.loadedEventHandler.bind(this))},bindDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},authEventHandler:function(b){switch(b.name){case"user.auth.success":if(this.auth.hasLevel("authors","highest")){this.loadControls()}else{jQuery(".editorControlsWidget_external.popup_anchor").html("")}break;case"user.auth.failure":jQuery(".editorControlsWidget_external.popup_anchor").html("");break}},loadControls:function(){var d=this;var b=jQuery(".editorControlsWidget_external.popup_anchor");var e={op:"ajax_editorcontrols",postId:this.getParam("postid",b),referencePostId:this.getParam("referencepostid",b)};b.load("/index.php",e,function(){d.resetElements();d.setControls();d.bindDOMHandlers();d.setupControls();d.raiseEvent("editorcontrols.loaded",{})})},setupControls:function(){var g=false;if(this.controls.for_editors){if(this.auth.hasLevel("authors")){this.controls.for_editors.show()}else{this.controls.for_editors.hide()}}if(this.controls.starinvite_link){if(this.auth.hasLevel("commentadmins")){var f=this.controls.starinvite_email[0].className.split("valid_limit_comma-").pop().split(" ")[0];this.controls.starinvite_email.removeClass("valid_limit_comma-"+f);
this.starinvite_validator.setupInfield(this.controls.starinvite_email[0]);this.controls.starinvite_left.html("");this.controls.starinvite_link.show()}else{if(this.auth.hasLevel("commenters")){var d=this.getParam("limitnormal",this.controls.starinvite_link);var j=parseInt(this.getParam("epoch",this.controls.starinvite_link),10);var b=parseInt(this.getParam("timeframe",this.controls.starinvite_link),10);if(this.auth.hasLevel("starcommenters")){d=this.getParam("limitstar",this.controls.starinvite_link)}d=parseInt(d,10);var h=d?d:10;if(this.auth&&this.auth.now&&this.auth.user&&this.auth.user.lastInviteTime){var e=parseInt(this.auth.user.lastInviteTime,10);if((this.auth.now-e)<(b-((e-j)%b))){h=d-parseInt(this.auth.user.recentInviteCount,10)}}var f=this.controls.starinvite_email[0].className.split("valid_limit_comma-").pop().split(" ")[0];this.controls.starinvite_email.removeClass("valid_limit_comma-"+f).addClass("valid_limit_comma-"+h);this.starinvite_validator.setupInfield(this.controls.starinvite_email[0]);this.controls.starinvite_left.html("("+h+" left)");if(h>0){this.controls.starinvite_link.show()}}else{this.controls.starinvite_link.hide()}}}if(this.controls.tagheader_link){if(this.controls.tagheader_enabled.html()=="true"){if(this.auth.hasLevel("editors")){this.controls.tagheader_entry.val(this.controls.tagheader_entry_orig.html().trim());this.controls.tagheader_postid.val(this.controls.tagheader_postid_orig.html());this.controls.tagheader_id.val(this.controls.tagheader_postid_orig.html());this.controls.tagheader_tags.val(this.controls.tagheader_tags_orig.html());this.controls.tagheader_link.show()}}}if(g){this.element.eq(0).show()}else{this.element.eq(0).hide()}},loadedEventHandler:function(b){if(this.auth.hasLevel("authors","highest")){this.loadControls()}else{jQuery(".editorControlsWidget_external.popup_anchor").html("")}},handleClick:function(d){var b=this.getParam("cn",d.target);switch(b){case"draft_link":if(confirm("Delete post?")){var f=[];f.push("op=changepoststatus");f.push("v2=true");f.push("id="+this.getParam("postId",this.controls.draft_link));f.push("publishStatus=DRAFT");f.push("realm=");this.xhr.send("/index.php",f.join("&"))}break;case"starinvite_link":this.controls.starinvite_postid.val(this.getParam("postId",d.target));case"starinvite_cancel":if(this.auth.hasLevel("commentadmins")||this.auth.hasLevel("commenters")){if(this.controls.starinvite_copy){this.controls.starinvite_copy.html("To create invites, paste in a list of comma-separated email addresses, and then click send invites.")}}else{if(this.auth.hasLevel("starcommenters")){if(this.controls.starinvite_copy){this.controls.starinvite_copy.html("To create invites for new users, paste in a list of comma-separated email addresses, and then click send invites.")}}}this.commondialogs.toggleDialog({which:"starinvite"});break;case"tagheader_link":case"tagheader_cancel":if(this.auth.hasLevel("editors")){this.commondialogs.toggleDialog({which:"tagheader"})}break;case"toggleadminlinks":jQuery("#editorControlsWidget").toggle();this.adminlinks_open=!this.adminlinks_open;break;default:return true;break}d.stopPropagation();d.preventDefault();return false},handleKeyUp:function(b){switch(b.keyCode){case jQuery.ui.keyCode.ESCAPE:this.commondialogs.toggleDialog();break}},handleStarInviteSubmit:function(b){b.stopPropagation();b.preventDefault();this.starinvite_validator.hideErrors();if(this.starinvite_validator.validate()){this.mystate="starinvite_sent";this.xhr.send(this.options.starinvite_action_url,this.controls.starinvite_form.serialize())}else{this.mystate="starinvite_dialog_visible";if(this.options.show_validation_errors){this.starinvite_validator.showErrors()}}},handleTagheaderSubmit:function(b){b.stopPropagation();b.preventDefault();this.tagheader_validator.hideErrors();if(this.tagheader_validator.validate()){this.mystate="tagheader_sent";this.xhr.send(this.options.tagheader_action_url,this.controls.tagheader_form.serialize())}else{this.mystate="tagheader_dialog_visible";if(this.options.show_validation_errors){this.tagheader_validator.showErrors()}}},handleAjaxRequest:function(){switch(this.mystate){case"starinvite_sent":this.disableInputs("starinvite");this.controls.starinvite_indicator.show();break;case"tagheader_sent":this.disableInputs("tagheader");this.controls.tagheader_indicator.show();break}},handleAjaxSuccess:function(e){if(e.postSave){e={action:"postSave",success:e.postSave.success,postid:e.postSave.postId}}switch(e.action){case"changeposttag_add":if(e.success){this.controls.top_link.hide();this.controls.untop_link.show()}break;case"changeposttag_remove":if(e.success){this.controls.top_link.show();this.controls.untop_link.hide()}break;case"starinvite":this.enableInputs("starinvite");this.controls.starinvite_indicator.hide();if(e.success){if(!this.auth.hasLevel("commentadmins")){var d=e.left?e.left:0;var b=this.controls.starinvite_email[0].className.split("valid_limit_comma-").pop().split(" ")[0];this.controls.starinvite_email.removeClass("valid_limit_comma-"+b).addClass("valid_limit_comma-"+d);
this.starinvite_validator.setupInfield(this.controls.starinvite_email[0]);this.controls.starinvite_left.html("("+d+" left)");this.auth.resetRevision();if(d==0){this.controls.starinvite_link.hide()}Message.showMessage((e.message?e.message:"Invitation(s) sent. "+d+" left."),this.controls.starinvitemessage[0])}else{Message.showMessage((e.message?e.message:"Invitation(s) sent."),this.controls.starinvitemessage[0])}this.fireEvent("onInviteSuccess",this,true);this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"starinvite",sync_this:this.syncEffect.bind(this)}});this.controls.starinvite_email.val("");this.mystate="idle"}else{Message.showMessage((e.message?e.message:"Invitation failed."),this.controls.starinvitemessage[0]);this.mystate="starinvite_dialog_visible"}break;case"postSave":this.enableInputs("tagheader");this.controls.tagheader_indicator.hide();if(e.success){Message.showMessage((e.message?e.message:"Tagheader saved."),this.controls.tagheadermessage[0]);this.fireEvent("onTagheaderSuccess",this,true);this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"tagheader",sync_this:this.syncEffect.bind(this)}});this.controls.tagheader_entry_orig.html(this.controls.tagheader_entry.val());this.mystate="idle"}else{Message.showMessage((e.message?e.message:"Tagheader save failed."),this.controls.tagheadermessage[0]);this.mystate="tagheader_dialog_visible"}break}},handleAjaxFail:function(){switch(this.mystate){case"starinvite_sent":this.enableInputs("starinvite");this.mystate="starinvite_dialog_visible";break;case"tagheader_sent":this.enableInputs("tagheader");this.mystate="tagheader_dialog_visible";break}},disableInputs:function(b){switch(b){case"starinvite":this.controls.starinvite_email[0].disabled=true;this.controls.starinvite_submit[0].disabled=true;this.controls.starinvite_cancel[0].disabled=true;break;case"tagheader":this.controls.tagheader_entry[0].disabled=true;this.controls.tagheader_submit[0].disabled=true;this.controls.tagheader_cancel[0].disabled=true;break}},enableInputs:function(b){switch(b){case"starinvite":this.controls.starinvite_email[0].disabled=false;this.controls.starinvite_submit[0].disabled=false;this.controls.starinvite_cancel[0].disabled=false;break;case"tagheader":this.controls.tagheader_entry[0].disabled=false;this.controls.tagheader_submit[0].disabled=false;this.controls.tagheader_cancel[0].disabled=false;break}}});a.extend(a.ui.EditorControlsWidget,{version:"1.0",defaults:{controlClass:"editor_control",externalElement:".presence_control_external, .editorControlsWidget_external",show_validation_errors:true,starinvite_action_url:"/index.php?op=sendinvite",tagheader_action_url:"/index.php?op=admin_savepost",onInviteSuccess:function(b){window.setTimeout(function(){b.syncEffect()},1000);return"will_sync"},onTagheaderSuccess:function(b){window.setTimeout(function(){b.syncEffect()},1000);return"will_sync"}}})})(jQuery);(function(a){a.widget("ui.GalleryWidget",{post_id:null,initialize:function(){this.subscribeForEvent("maincontent.postloaded",this.postLoadedHandler.bind(this));this.subscribeForEvent("navigation.loaded",this.setGalleryData.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.galleryData=null;this.fadeTime=500;this.first_run=true;var b=this;jQuery(document).ready(function(){this.first_run=true;b.bindClickHandlers();b.enablePager();if(window.galleryData!=undefined){b.galleryData=galleryData}})},postLoadedHandler:function(b){this.post_id=b.params.data.id;this.original_post_id=b.params.data.originalPostId;this.bindClickHandlers();this.enablePager()},prepareOverlay:function(){if(typeof this.overlaydiv=="undefined"){var d=jQuery("#illustration_overlay");if(d.length>0){var e=d.attr("data-src");this.overlaydiv=jQuery(document.createElement("div"));this.overlaydiv.attr("id","illustration_overlay");this.overlaydiv.hide();overlayimg=jQuery(document.createElement("img"));overlayimg.attr("src",e);d.remove();jQuery("#gallery_container").before(this.overlaydiv);this.overlaydiv.html(overlayimg);var b=this.overlaydiv;overlayimg.load(function(){b.css("width",overlayimg.width());b.css("height",overlayimg.height())})}}},bindClickHandlers:function(){var b=this;jQuery(".gallery_item a").bind("click",function(f){b.clickHandler(f)});jQuery(".cn_previmage").bind("click",function(f){b.loadNeighbor(false);f.preventDefault();f.stopPropagation()});jQuery(".cn_nextimage").bind("click",function(f){b.loadNeighbor(true);f.preventDefault();f.stopPropagation()});jQuery("img.cn_currentimage").bind("load",function(f){if(b.inTransition()){b.finishTransition()}});var d=b.getParam("thumb",jQuery(".gallery_item.item.current"));if(d!=null){b.loadItem(d)}},enablePager:function(){var b=false;jQuery(".gallery_image").hover(function(){b=true;jQuery(".gallery_image .controls").css("opacity","1");jQuery(".gallery_image #gallery_other_sizes").css("opacity","1")},function(){b=false;setTimeout(function(){if(!b){jQuery(".gallery_image .controls").css("opacity","0");
jQuery(".gallery_image #gallery_other_sizes").css("opacity","0")}},2000)})},handleClick:function(l){var m=jQuery(l.target);if(m.hasClass("cn_thumbnext")||m.hasClass("cn_thumbprev")){l.preventDefault();l.stopPropagation();var k=jQuery(".galcn.cn_thumblist");var p=jQuery("#thumb_container").width();var d=jQuery("#thumb_list_window").width();var o=parseInt(k.css("left"),10);if(isNaN(o)){o=0}o=-1*o;var j=null;var g=null;jQuery("#thumb_container div.gallery_item").each(function(){var q=jQuery(this);var r=q.position().left;var e=r+q.width();if(r>=o){if(j===null){j=q;return false}else{if(e<=o+d){g=q}else{return false}}}});var b=parseInt(this.getParam("thumb",j),10);var n=o;var h=0;if(m.hasClass("cn_thumbnext")){h=2}else{h=-2}var f=null;while(f===null||f.length==0){f=jQuery("#thumb_container div.gallery_item.thumb_"+(b+h));h+=(h>0?-1:1)}n=-1*f.position().left;if(n>0){n=0}else{if(-1*n+d>p){n=(p-d)*-1}}if(n!=o){k.animate({left:n},200);this.disableButtons(n,p)}}},disableButtons:function(f,d){var e=jQuery("#thumb_navigation .cn_thumbprev");var b=jQuery("#thumb_navigation .cn_thumbnext");if(f==0){e.addClass("inactive")}else{if(e.hasClass("inactive")){e.removeClass("inactive")}}if((d-600)==f*-1){b.addClass("inactive")}else{if(b.hasClass("inactive")){b.removeClass("inactive")}}},moveToItem:function(j){var d=jQuery(".gallery_item.item.thumb_"+j);var b=jQuery("#thumb_list_window").width();var h=jQuery("#thumb_container").width();if(b>h){return false}var e=d.width();var f=d.position().left;var g=-1*Math.round(f-b/2+e/2);if(g>0){g=0}else{if(-1*g+b>h){g=-1*(h-b)}}jQuery(".galcn.cn_thumblist").animate({left:g},200);this.disableButtons(g,h)},clickHandler:function(b){b.preventDefault();b.stopPropagation();var d=this.getParam("imageLink",jQuery(b.target).parent("a"));this.loadItem(d)},setGalleryData:function(b){if(typeof b.params.data.gallery!="undefined"){this.galleryData=b.params.data.gallery}else{this.galleryData=null}},getCurrentPos:function(){return parseInt(jQuery(".cn_currentimageoverlay").html(),10)},loadNeighbor:function(b){if(this.galleryData===null){return}var e=this.getCurrentPos();var d=this.galleryData.images.length;if(b){e++;if(e>d){e=1}}else{e--;if(e<1){e=d}}this.loadItem(e)},loadItem:function(h){this.moveToItem(h);if(this.galleryData===null||this.inTransition()){return}var l=this.getCurrentPos();jQuery(".gallery_item.thumb_"+l).removeClass("current");jQuery(".gallery_item.thumb_"+h).addClass("current");jQuery(".cn_currentimageoverlay").html(h);if(window.pageType!="tag"&&document.location.href!=jQuery("#thumb_list a.imageLink_"+h).attr("href")){this.raiseEvent("navigation.setLocationString",{href:jQuery("#thumb_list a.imageLink_"+h).attr("href")+document.location.search})}jQuery(".nextpost-overlay").css({visibility:"visible"});var r=this.galleryData.images[h-1];var j=this.galleryData.images[h-1];var o=jQuery(".cn_currentimage");var f=jQuery(".cn_currentvideo");var b=jQuery(".cn_currentcaption");if(h==1){try{if(this.browser=="ie"){jQuery(".permalink .permatag").show();jQuery(".permalink h1.title").show();jQuery(".permalink div.nodebyline").show();jQuery(".permalink .cn_currentcaption").addClass("selectedbyline")}else{jQuery(".permalink .permatag").animate({opacity:1},this.fadeTime,"linear",function(){a(this).show()});jQuery(".permalink h1.title").animate({opacity:1},this.fadeTime,"linear",function(){a(this).show()});jQuery(".permalink div.nodebyline").animate({opacity:1},this.fadeTime,"linear",function(){a(this).show()});jQuery(".permalink .cn_currentcaption").addClass("selectedbyline")}}catch(m){}}else{try{if(this.browser=="ie"){jQuery(".permalink .permatag").hide();jQuery(".permalink h1.title").hide();jQuery(".permalink div.nodebyline").hide();jQuery(".permalink .cn_currentcaption").removeClass("selectedbyline")}else{jQuery(".permalink .permatag").animate({opacity:0},this.fadeTime,"linear",function(){a(this).hide()});jQuery(".permalink h1.title").animate({opacity:0},this.fadeTime,"linear",function(){a(this).hide()});jQuery(".permalink div.nodebyline").animate({opacity:0},this.fadeTime,"linear",function(){a(this).hide()});jQuery(".permalink .cn_currentcaption").removeClass("selectedbyline")}}catch(m){}}for(var g=0;g<b.length;g++){var s=jQuery(b[g]);if(!s.hasClass("current")){s.addClass("next");s.html(j.caption)}}if(h==1){if(typeof this.overlaydiv=="undefined"){this.prepareOverlay()}if(typeof this.overlaydiv!=="undefined"){this.overlaydiv.show()}}else{if(typeof this.overlaydiv!=="undefined"){this.overlaydiv.hide()}}var q=false;if(j.videoData==false){for(var g=0;g<o.length;g++){var s=jQuery(o[g]);if(!s.hasClass("current")){s.addClass("next");break}}var n=jQuery(".cn_currentimage.next").attr("src");if(n==j.bigimage){q=true}else{if(this.browser=="ie"){var p=jQuery(".cn_currentimage.next");var k='<img src="'+j.bigimage+'" class="'+p.attr("class")+'" style="'+p.attr("style")+'" />';p.replaceWith(k)}else{jQuery(".cn_currentimage.next").attr("src",j.bigimage)}}var d=false;var u=["","800","1600"];for(var g=0;g<u.length;g++){var t=u[g];
if(j["bigimage"+t]===undefined){jQuery("#gallery_size_"+t).hide();continue}d=true;jQuery("#gallery_link_1600").attr("href",j["bigimage"+t])}if(d){jQuery("#gallery_other_sizes").show()}else{jQuery("#gallery_other_sizes").hide()}}else{for(var g=0;g<f.length;g++){var s=jQuery(f[g]);if(!s.hasClass("current")){s.addClass("next");break}}jQuery("#gallery_other_sizes").hide();j.videoData.wrap=false;j.videoData.height=360;j.videoData.width=640;VideoHandler.dumpObject(j.videoData,jQuery(".cn_currentvideo.next")[0].id);q=true}jQuery("#gallery_link_1600 img.hiddenthumb").attr("src",j.bigimage);jQuery(".postContainer").lytebox();this.fadeInOverlay(q);if(this.first_run){this.first_run=false}else{this.raiseEvent("gallery.paged",{post_id:this.post_id,original_post_id:this.original_post_id})}},positionOverlay:function(g){var b=jQuery("#gallery_transition_overlay");c=0;var f=null;var e=g;var d=g.offset();while(f===null){f=e.offsetParent();var j=f.css("position");if(j!="static"){var h=f.offset();if(h!=null){d.top-=h.top;d.left-=h.left}break}if(f!=e){e=f;if(e[0].tagName.toLowerCase()!="body"){f=null}}}return b},fadeInOverlay:function(f){if(f===undefined){f=false}var d=jQuery(".cn_currentimage.current, .cn_currentvideo.current");var b=this.positionOverlay(d);jQuery(".spinner",b).spin("large","#999");var e=this;b.css("opacity",0);b.show();if(this.browser=="ie"){b.css("opacity",0.8);jQuery(".cn_currentcaption.current").css("opacity",0.2);this.fadeOutOverlay()}else{b.animate({opacity:0.8},this.fadeTime,"linear",function(){if(f){e.fadeOutOverlay()}});jQuery(".cn_currentcaption.current").animate({opacity:0.2},this.fadeTime,"linear")}},fadeOutOverlay:function(){var e=jQuery(".cn_currentimage.current, .cn_currentvideo.current");e.hide();e.removeClass("current");if(e.hasClass("cn_currentvideo")){e.html("")}var d=jQuery(".cn_currentimage.next, .cn_currentvideo.next");d.show();d.removeClass("next").addClass("current");var b=this.positionOverlay(d);jQuery(".spinner",b).spin(false);b.hide();jQuery(".cn_currentcaption.current").removeClass("current").hide();jQuery(".cn_currentcaption.next").removeClass("next").addClass("current").css("opacity",1).show();jQuery(".permalink .cn_currentcaption .pm_byline").hide();jQuery(".permalink .selectedbyline .pm_byline").show()},finishTransition:function(){this.fadeOutOverlay()},inTransition:function(){return(jQuery(".cn_currentimage.next, .cn_currentvideo.next").length>0)},transitions:{imageImage:function(){},imageVideo:function(){},videoImage:function(){},videoVideo:function(){}}});a.extend(a.ui.GalleryWidget,{version:"1.0",defaults:{controlClass:"galcn",externalElement:".galcn_external"}})})(jQuery);var SocialButtons={thirdpartyDisabled:gawker_parseQueryString(window.location.search.substring(1)).thirdparty==="false",referrerDomain:gawker_getDomain(document.referrer),referrers:{"twitter.com":"twitter","t.co":"twitter","linkedin.com":"linkedin","www.linkedin.com":"linkedin","www.stumbleupon.com":"stumbleupon"},scripts:{},getScript:function(a){if(this.thirdpartyDisabled){return Promise.NEVER}else{if(!this.scripts[a]){this.scripts[a]=gawker_getScript(a)}return this.scripts[a]}},googleplusScript:function(){window.___gcfg={parsetags:"explicit"};return this.getScript("https://apis.google.com/js/plusone.js")},fbScript:function(){window.fbAsyncInit=function(){FB.init({appId:"236575159691634",status:true,cookie:true,xfbml:true})};return this.getScript("//connect.facebook.net/en_US/all.js")},twitterScript:function(){return this.getScript("//platform.twitter.com/widgets.js")},stumbleuponScript:function(){return this.getScript("//platform.stumbleupon.com/1/widgets.js")},linkedinScript:function(){return this.getScript("//platform.linkedin.com/in.js")},update:function(b){if(b.length){b.children().hide();var d=this.referrers[this.referrerDomain];if(!this[d]){d="facebook"}var a=b.children("."+d).show();this[d](a)}},facebook:function(a){this.fbScript().then(function(){if(window.FB){FB.XFBML.parse(a[0])}})},twitter:function(){this.twitterScript().then(function(){if(window.twttr){twttr.widgets.load()}})},stumbleupon:function(){this.stumbleuponScript().then(function(){if(window.STMBLPN){STMBLPN.processWidgets()}})},linkedin:function(a){a.append('<script type="IN/Share" data-url="'+jQuery("link[rel=canonical]").attr("href")+'" data-counter="right"><\/script>');this.linkedinScript().then(function(){console.log(IN,IN.parse);if(window.IN){IN.init()}})}};(function(a){a.widget("ui.TopSwitch",{initialize:function(){this.subscribeForEvent("navigation.loaded",this.mainContentLoaded.bind(this))},mainContentLoaded:function(f){var d=f.params.data;if(d.action=="tag"||d.action=="forum"||(d.action=="post"&&this.getUrlParams().tag)){if(typeof d.sitetag=="undefined"){d.sitetag={url:""}}if(d.sitetag.name==null){d.sitetag.name=this.getUrlParams().tag?this.getUrlParams().tag:""}var b=(d.sitetag.name.length>24)?d.sitetag.name.substr(0,24)+"...":d.sitetag.name;this.element.html('<h1><a id="switch_topstories" href="'+d.sitetag.url+(d.sitetag.isForumTag?"forum/":"")+'" title="'+d.sitetag.name+'">'+b+"</a></h1>").addClass("selected");
if(d.action!="forum"){d.title=d.title+" stories - "+siteConfig.title}}else{this.element.html('<a id="switch_topstories" title="Switch to top stories" href="/">Top Stories</a>').toggleClass("selected",d.action=="splash_post")}}});a.widget("ui.MainContentWidget",{initialize:function(){this.subscribeForEvent("maincontent.load",this.mainContentEventHandlerLoad.bind(this));this.subscribeForEvent("navigation.loaded",this.mainContentEventHandlerLoaded.bind(this));this.subscribeForEvent("navigation.load",this.setCleanState.bind(this));this.subscribeForEvent("maincontent.profilepageloaded",this.profilePageLoaded.bind(this));jQuery("#switch_topstories").closest("li").TopSwitch();this.subscribeForEvent("gallery.paged",function(d){this.reloadTrackers({post_id:d.params.original_post_id})}.bind(this));this.postShown=false;this.spongesettings={retries:10,interval:1};jQuery(document).scroll(function(d){jQuery(this).stop()});jQuery(".mainContent").delegate(".scrolltonewcomment","click",jQuery.proxy(function(d){d.stopPropagation();d.preventDefault();jQuery(window).scrollTo("#thread_navigation",300);if(this.feature.isOn(this.feature.POWWOW)&&typeof Powwow!=="undefined"){Powwow.openCommentForm()}else{jQuery("#thread_new").click()}return false},this));this.xhr=new XHR({klass:"maincontent",success:this.handleAjaxSuccess.bind(this)});if(window.ganjaStaticAjaxContent!==undefined){this.handleAjaxSuccess(window.ganjaStaticAjaxContent)}SocialButtons.fbScript();var b=jQuery.cookie("____GSW");if(b==="hd"||window.location.search=="?hd=off"||window.location.search=="?ie9preview=off"||window.location.search.match(/\?rnd=[0-9]+/)){jQuery.cookie("____GSW",null,{expires:30,path:"/",domain:window.cookieDomain.replace(/^\./,"")});jQuery.cookie("____GSW",null,{expires:30,path:"/",domain:"."+window.cookieDomain.replace(/^\./,"")})}},mainContentEventHandlerLoad:function(k){var h=k.params.href;var d=null;var b=h.match(/^\/([0-9]{5,})/);var g="misc";if(b!==null){d=b[1];g="post"}else{var f=h.match(/^\/[a-z0-9]+\/([0-9]{5,})/);if(f!==null){d=f[1]}g="misc"}this.xhr.send(h);var j=jQuery("#postTransitionOverlay");j.html('<div class="progress_indicator"></div>').show();jQuery(".progress_indicator",j).spin("large");j.height(jQuery("#container").height());if(this.browser=="ie"){j.css("filter","alpha(opacity=70);  ")}else{j.fadeTo(250,0.7)}},setCleanState:function(){jQuery("#rssUserLink").remove()},profilePageLoaded:function(d){var b=d.params.data.user.smartName+"'s posts";jQuery('<link rel="alternate" type="application/rss+xml" id="rssUserLink" title="'+b+'" href="/author/'+d.params.data.user.username+'.xml" />').appendTo("head")},handleAjaxSuccess:function(b){if(b.success){if(b.sitetag){b.title=b.sitetag.name.charAt(0).toUpperCase()+b.sitetag.name.substr(1)+" "+siteConfig.slogan+" - "+siteConfig.title}if(b.action=="forum"){b.title=siteConfig.title+" "+b.sitetag.name.charAt(0).toUpperCase()+b.sitetag.name.substr(1)+" Forum"}if(b.action=="classic"){jQuery("#post_date_views .frontpage_only").html("BLOG VIEW").show();jQuery("#post_date_views .postpage_only").hide()}this.raiseEvent("navigation.loaded",{data:b})}},mainContentEventHandlerLoaded:function(h){var b={};var g=h.params.data;var f=false;b.cb_author=g.cb_author;b.cb_sections=g.cb_sections;if(g.originalPostId){b.post_id=g.originalPostId}else{if(g.id){b.post_id=g.id}else{b.post_id="SITE:"+siteConfig.id}}var d="misc";if(g.action=="post"){d="post"}else{if(g.action=="frontpage"||g.action=="splash_post"||g.action=="classic_frontpage"){d="frontpage"}}if(d=="post"){if(g.interstitial){this.pendingData=g;this.raiseEvent("rightbar.suspendNavigation",{});g=jQuery.extend(true,{},g);g.html=g.interstitial;f=true}}else{if(d=="frontpage"){jQuery.cookie("interstitial_count",0,{path:"/"})}}if(g.html==undefined&&g.content!==undefined){g.html=g.content}this.showItem(g,f);if(d=="frontpage"){this.raiseEvent("maincontent.frontpageloaded",{data:g})}else{if(d=="classic"){this.raiseEvent("maincontent.classicfrontpageloaded",{data:g})}}this.reloadTrackers(b)},showItem:function(K,h){var u=K.id;var q=K.html;if(h==undefined){h=false}this.setMetaTags(K);var r=HtmlObjects.parseText(q);q=r.text;var w=r.handlers;var f=q.match(/<script[^>]*>\s*VideoHandler.dumpObject[^<]*<\/script>/g);if(f===null){f=[]}for(var H=0;H<f.length;H++){var v=q.match(/<script[^>]*>\s*VideoHandler.dumpObject\( (\{.*?\}), '([^']+)'(, (true|false))?(, (true|false))? \)\s*<\/script>/);if(v!==null){try{var p=jQuery.parseJSON(v[1]);if(typeof K.post_age_limit!="undefined"){p.agegate=K.post_age_limit}var t=(v[4]!==undefined&&v[4]==="true");var y=(v[6]!==undefined&&v[6]==="true");var F=v[2];var d=function(){var M=p;var l=F;var j=t;var e=y;return function(){VideoHandler.dumpObject(M,l,j,e)}};w.push(d());q=q.replace(v[0],"")}catch(J){}}}var o=q.match(/<script[^>]*>\s*newVideoPlayer[^<]*<\/script>/g);if(o==null){o=[]}for(var H=0;H<o.length;H++){var p=o[H].match(/\(\s*({.*})\s*\)/);if(p===null){var b=o[H].match(/newVideoPlayer\s*\((.*?)\)/);if(b!==null){var k=b[1].split(",");
var E=[];for(var D=0;D<k.length;D++){E.push(k[D].replace(/^[\s'"]+|[\s'"]+$/g,""))}if(E.length>0){p=VideoHandler.parseParams(E[0],E[1],E[2],E[3])}}if(p===null){continue}}else{try{p=jQuery.parseJSON(p[1])}catch(J){continue}}ret=VideoHandler.load(p,true);q=q.replace(o[H],ret.replacement);w.push(ret.handler)}var n=q.match(/<\!--\s*runScript\s*-->\s*<script[^>]*>[\w\W\n\r]*?<\/script>/g);if(n==null){n=[]}else{for(var H=0,z=n.length;H<z;H++){q=q.replace(n[H],'<protected_script id="'+H+'" />')}}var m=q.match(/<script[^>]*>[\w\W\n\r]*?<\/script>/g);if(m==null){m=[]}else{for(var H=0,z=m.length;H<z;H++){q=q.replace(m[H],"<!-- script deleted -->")}}if(n.length>0){var B=q.match(/<protected_script id="(\d*)" \/>/g);for(var H=0,z=B.length;H<z;H++){q=q.replace(B[H],n[H])}}jQuery("#sharemenu-wrap").unbind("clickoutside");var L=jQuery(".mainContent");var I=q;var g=this;if(this.oldPageType===undefined){this.oldPageType="frontpage"}var A=(h?"interstitial":"misc");var s=this;var C=function(){for(var j=0;j<w.length;j++){try{w[j]()}catch(l){}}jQuery("#container").css("visibility","visible");jQuery(".nextpost-overlay").css({visibility:"visible"});if(jQuery("#errorbar").length>0){jQuery(document).scrollTo("#errorbar",500)}else{jQuery(document).scrollTo("#main-container",250)}if(g.oldPageType=="interstitial"){jQuery("#bannercontainer").hide();g.raiseEvent("maincontent.interstitialHidden",{data:K})}g.oldPageType=A;jQuery("#postTransitionOverlay").hide();if(!h){if(K.action=="post"||K.action=="tag"){g.asyncRaiseEvent("maincontent.postloaded",{data:K})}else{if(K.action=="forum"){g.raiseEvent("maincontent.forumloaded",{data:K})}else{if(K.action=="classic_frontpage"){g.raiseEvent("maincontent.classicfrontpageloaded",{data:K})}}}g.raiseEvent("maincontent.finished",{data:K});g.raiseEvent("rightbar.resumeNavigation",{})}else{g.raiseEvent("maincontent.interstitialLoaded",{data:K})}jQuery(".safari .post-body iframe").css("display","block");SocialButtons.googleplusScript().then(function(){window.gapi.plusone.go(".gplus")});jQuery(".sitescontainer").css("visibility","visible")};var G=function(){jQuery(".mainContent").eq(0).html(I);g.loadSpongeStats();jQuery.each(jQuery(".mainContent").eq(0).find(".autolink"),function(e,ah){ah=jQuery(ah);ah.replaceWith(ah.html())});jQuery(".twitter-tweet").addClass("tw-align-center");if(K.action=="splash_post"){var U=g.getUrlParams();var Q={};if(U.sponsor_preview!==undefined){Q.sponsor_preview=parseInt(U.sponsor_preview,10)}g.raiseEvent("splashpost.sponsoredpost.show",Q);jQuery(".gaqtrack").bind("click",function(){_gaq.push(["_trackEvent",jQuery(this).data("gaqevent"),jQuery(this).data("gaqid")])})}jQuery(".author-contact .gaqtrack").bind("click",function(){_gaq.push(["_trackEvent",jQuery(this).data("gaqevent"),jQuery(this).data("gaqid")])});if(typeof K.tags!="undefined"&&K.tags.indexOf("gizmodogallery")>-1){jQuery("body").addClass("gizmodo-gallery")}else{if(jQuery("body").hasClass("gizmodo-gallery")){jQuery("body").removeClass("gizmodo-gallery")}}if(window.imgData!==undefined&&window.imgData!==null){try{var ae=window.imgData;var X=jQuery("div.post-body img, div.imgwrap.abovewrap img, img.editorial.above");var af=function(ao,ak,ah,am,ar){var ai=ao.width();var an=ao.height();var aj="left";if(ao.hasClass("right")){aj="right"}var aq=ao.attr("style");var al="";if(aq!==undefined){var ap=aq.match(/top:\s*([\-0-9]+)/);if(ap!==null){al+="top: "+ap[1]+"px;"}ap=aq.match(/left\:\s*([\-0-9]+)/);if(ap!==null){al+="left: "+ap[1]+"px;"}ap=aq.match(/display\:\s*([^ ]+)/);if(ap!==null){al+="display: "+ap[1]+"px;"}}aj+=" editorial";if(ao.css("display").toLowerCase()!="none"){var e='<div class="lyteboxContainer '+aj+'" style="'+al+"width: "+ai+"px; height: "+an+'px;">';if(ar&&ai==640){e+='<a href="'+ar+'" target="_blank"><img src="'+ak+'" width="'+ai+'" height="'+an+'" /></a>'}else{e+='<div class="lyteboxLink"><a href="'+ah+'" class="noHrefOverride" rel="lytebox">Full size</a></div>';e+='<img src="'+ak+'" width="'+ai+'" height="'+an+'" />'}e+="</div>";ao.replaceWith(e);jQuery(".mainContent").lytebox({pager:true})}};var ab=jQuery("#illustration_overlay");if(ab.length>0){var Y=ab.attr("data-src");overlaydiv=jQuery(document.createElement("div"));overlaydiv.attr("id","illustration_overlay");overlayimg=jQuery(document.createElement("img"));overlayimg.attr("src",Y);ab.remove();jQuery(".imgwrap.abovewrap").before(overlaydiv);overlaydiv.html(overlayimg);overlayimg.load(function(){overlaydiv.css("width",overlayimg.width());overlaydiv.css("height",overlayimg.height())})}var V={};var S;for(var Z=0;Z<X.length;Z++){var ag=jQuery(X[Z]);var T=null;try{if(X[Z].src){T=X[Z].src}else{T=ag.css("background-image").replace(/^url\((.*)\)$/,"$1")}}catch(aa){}var P=null;if(T!=null){P=T.replace(/http:\/\/[^\/]+/,"")}if(T.match(/^http:\/\/img.gawkerassets.com\/img\//)){S=T.match(/([^\/]+)\/(?:xlarge|medium|original)[^\/]+$/)}else{S=T.match(/\/(?:xlarge_|medium_)?([a-zA-Z0-9\.\_\-\%]+)$/)}if(S!==null){if(V[S[1]]!==undefined){ag.hide();continue}V[S[1]]=true}if(!ag.hasClass("avatar")&&ag.closest("div.post-body").length>0){var O=function(e){var aj=e.width();
var ai=e.height();var ah=!e.hasClass("v10_wide")?300:640;if(!aj||aj>ah){e.attr("width",ah);if(aj&&ai){e.attr("height",null)}}};var j=!ag.hasClass("v10_wide")?300:640;ag.css("max-width",j+"px");ag.one("load",function(ai){var ah=jQuery(ai.target);O(ah)});if(ag.complete){ag.trigger("load")}}if(jQuery(X[Z]).hasClass("noLytebox")||X[Z].parentNode.nodeName=="A"){continue}if(ae.lookup[P]===undefined){continue}var ad=ae.lookup[P];if(ae.data[ad.pos].original.width*0.9>jQuery(X[Z]).width()){var N=ae.data[ad.pos].original.url;var W=ae.splashlink||false;var M=ag.get(0).tagName.toLowerCase();if(M=="div"){af(ag,T,N,ae.data[ad.pos][ad.transform],W)}else{if(M=="img"){var R=function(){var ah=ae.data[ad.pos][ad.transform];var ai=T;var e=N;return function(aj){af(jQuery(aj.target),ai,e,ah,W)}};ag.one("load",R());if(ag.complete){ag.trigger("load")}}}}}}catch(ac){}}var l=function(){C();jQuery("#post_date_views .postpage_only").show();jQuery("#post_date_views .frontpage_only").hide();window.adRobot.initAdsense(K.google_hints,K.tags);g.handlePageAnchors();jQuery("body").removeClass("loading").addClass("loaded");if(K.action=="commenterpage"){g.raiseEvent("maincontent.profilepageloaded",{data:K})}if(K.action==="site_comments_admin"){g.raiseEvent("maincontent.forumloaded",{data:K})}jQuery(".mainContent").lytebox({pager:true});SocialButtons.update(a("#socialbuttons"));g.fixImagesNextToLongAds();g.removeFBAlt()};if(s.browser=="ie"){L.show();l()}else{jQuery("#postTransitionOverlay").find(".progress_indicator").spin(false).end().fadeTo(250,0,l)}};if(this.browser=="ie"){L.hide();G()}else{jQuery("#postTransitionOverlay").find(".progress_indicator").spin(false).end().fadeTo(250,1,G)}},setMetaTags:function(e){jQuery.each({title:e.title,description:e.metaDescription,keywords:e.metaKeywords,medium:"blog"},function(h,g){var f=jQuery("meta[name="+h+"]");f=f.length?f:jQuery('<meta name="'+h+'" />').appendTo("head");f.attr("content",g)});jQuery.each({image_src:e.metaImage,canonical:e.canonicalPermalink},function(h,g){var f=jQuery("link[rel="+h+"]");f=f.length?f:jQuery('<link rel="'+h+'" />').appendTo("head");f.attr("href",g)});if(typeof e.rssTagName!="undefined"){var d=jQuery("#rssTagNameLink");d=d.length?d:jQuery('<link rel="alternate" type="application/rss+xml" id="rssTagNameLink" />').appendTo("head");d.attr("href",e.rssTagLink);d.attr("title",e.rssTagTitle+" stories")}if(location.search.indexOf("tag=")!==-1){jQuery('meta[name="robots"]').attr("content","follow, noindex")}var d=jQuery("#rssCommentLink");if(e.action=="forum"){d=d.length?d:jQuery('<link rel="alternate" type="application/rss+xml" id="rssCommentLink" />').appendTo("head");d.attr("href","http://"+siteConfig.canonicalHost+e.sitetag.url+"forum?view=rss");d.attr("title",siteConfig.title+" - "+e.sitetag.name+" Comments Feed")}else{if(d.length>0){d.remove()}}var b=jQuery("#twitterMeta");if(e.action=="splash_post"&&siteConfig.twitterId!==null){b=b.length?b:jQuery('<meta property="twitter:account_id" id="twitterMeta" />').appendTo("head");b.attr("content",siteConfig.twitterId)}else{if(b.length>0){b.remove()}}},handlePageAnchors:function(){if(document.location.hash=="#comments"){setTimeout("jQuery(document).scrollTo('#comments', {duration: 500, offset: {top: -35}})",2000)}else{if(jQuery(document.location.hash).length>0){jQuery(document).scrollTo(document.location.hash,500)}}},reloadTrackers:function(b){trackers.reload(b)},loadSpongeStats:function(){var b=jQuery(".post-supp .post-meta").data("permalink");var d=[];if(b){d=[b]}if(typeof sponge_client!=="undefined"){if(!this.spongestats){this.spongestats=GawkerClientside.widgets.spongestatsclient[0]}this.spongestats.getStats(d,this,this.insertSpongeStatsResults)}},insertSpongeStatsResults:function(d){this.spongestats.requests_running--;var f,b,h,e,g,k,j;if(d.data===undefined){return false}e=jQuery(".post-meta");h=d.data[e.data("permalink")];if(h!==undefined){g=true;j=[];k=e.data("spongetries")>0?e.data("spongetries")+1:1;if(h.views!==undefined&&h.views.ready==true){e.find(".total_views").html(gawker_add_commas(h.views.totalViews));j.push(h.views.totalUniqueViews+" New Visitors")}else{g=false}if(h.comments!==undefined&&h.comments.ready==true){e.find(".comments").html(gawker_add_commas(h.comments.numComments))}else{g=false}e.data("statready",g);e.find(".views").attr("title",j.join(", "));e.find(".views").attr("alt",j.join(", "));if(g===false){e.data("spongetries",(e.data("spongetries")===undefined?1:Math.floor(e.data("spongetries"))+1))}}if((this.spongestats.requests_running==0)&&(e.data("statready")!==true)&&(e.data("spongetries")<this.spongesettings.retries)){setTimeout(jQuery.proxy(this.loadSpongeStats,this),(this.spongesettings.interval*1000))}},fixImagesNextToLongAds:function(){var f=jQuery(".post-supp");if(!f.length){return false}var e=f.height(),b=f.offset().top,d=e+b;this.element.find(".post-body img").each(function(j,g){var h=jQuery(g);if((h.offset().top<=d+3)&&(!h.hasClass("thumb"))&&(h.width()>150)){h.css("marginRight","0")}else{return false
}})},removeFBAlt:function(){jQuery(".fb_profile_pic_rendered img").live("mouseenter",function(){jQuery(this).removeAttr("alt");jQuery(this).removeAttr("title")})}});a.extend(a.ui.MainContentWidget,{version:"1.0",defaults:{controlClass:"mainContentControl"}})})(jQuery);(function(a){a.widget("ui.NavigationWidget",{initialize:function(){if(location.hash!=""&&location.hash.indexOf("#!")==0){var b=location.hash.substr(2);if(b.indexOf("/")!=0){b="/"+b}location.href=b}this.subscribeForEvent("navigation.",this.navigationEventHandler.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this));var d=this;this.listenToPopstate=(navigator.userAgent.indexOf("AppleWebKit")==-1);jQuery(window).bind("popstate",function(f){if(d.listenToPopstate){d.raiseEvent("navigation.load",{href:location.pathname,replace:true})}else{d.listenToPopstate=true}});jQuery("a").live("click",function(g){if(jQuery(this).attr("href")=="#"){d.listenToPopstate=false;return true}if(jQuery(this).hasClass("nocapture")){return true}if(g.metaKey){return true}if(jQuery(this).attr("href")=="/"){return true}var f=d.getCanonizedUrl(this.href);if(f!==null){d.raiseEvent("navigation.load",{href:f});g.stopPropagation();g.preventDefault()}})},getCanonizedUrl:function(b){if(b.substr(0,1)!="/"){var d=location.protocol+"//"+location.host;if(b.indexOf(d)!=0){return null}b=b.substr(d.length)}if(b.indexOf("#!")!=-1){b=b.replace("#!","")}return b},navigationEventHandler:function(h){switch(h.name){case"navigation.load":jQuery("body").removeClass("loaded").addClass("loading");var g=h.params.href;var f=h.params.replace;if(f===undefined){f=false}var d=this.getCanonizedUrl(g);if(d===null){window.location=g}else{if(typeof history.pushState!=="undefined"){jQuery("body").removeClass("loaded").addClass("loading");this.setLocationString(d,f);if(d=="/"){this.raiseEvent("splashpost.load",{})}else{this.raiseEvent("maincontent.load",{href:d})}}else{window.location=d}}break;case"navigation.loaded":jQuery("body").removeClass("loading").addClass("loaded");var b="unknown";if(h.params.data!==undefined&&h.params.data.action!==undefined){b=h.params.data.action;window.pageType=b}setBodyPageType(b);if(h.params.data.action=="forum"){jQuery("body").addClass("page-tag")}if(b!="classic_frontpage"){document.title=h.params.data.title.replace(/(<([^>]+)>)/ig,"")}if(!jQuery(".mainContent").hasClass("permalink")){jQuery(".mainContent").addClass("permalink")}break;case"navigation.setLocationString":var d=this.getCanonizedUrl(h.params.href);if(d!==null){this.setLocationString(d)}break;case"navigation.gotoclassic":this.gotoClassic();break}},setLocationString:function(b,d){if(d===undefined){d=false}if(typeof history.pushState!=="undefined"){if(d){history.replaceState(b,document.title,b)}else{history.pushState(b,document.title,b)}}},handleClick:function(d){var b=this.getParam("cn",jQuery(d.target));switch(b){case"classic_link":this.gotoClassic();break;default:return true}d.stopPropagation();d.preventDefault();return false},gotoClassic:function(){var f=new Date();f.setTime(f.getTime()+365*86400*1000);var e=location.hostname.match(/([^\.]+\.[^\.]+)$/);var b="____GCV=classic;expires="+f.toUTCString()+";path=/;domain=."+e[1];document.cookie=b;location.href="http://"+(location.hostname.indexOf("blog.")==-1?"blog.":"")+location.hostname+"/"}});a.extend(a.ui.NavigationWidget,{version:"1.0",defaults:{controlClass:"gnc",externalElement:".gnc_external"}})})(jQuery);(function(a){a.widget("ui.NotificationWidget",{initialize:function(){if(this.feature.isOn(this.feature.POWWOW)){this.subscribeForEvent("user.auth.",this.powwow_authEventHandler.bind(this));this.subscribeForEvent("notification.",this.powwow_notificationEventHandler.bind(this));this.subscribeForEvent("powwow.",this.powwow_powwowEventHandler.bind(this));this.subscribeForEvent("navigation.load",this.powwow_navigationEventHandler.bind(this));this.notificationLimit=4;this.notifications=[];this.hasMoreNotifications=false;this.unseenNotificationCount=0;this.notificationsVisible=false;this.lastSeenTimestamp=0;this.userId=null}else{this.xhr=new XHR({klass:"notification",success:this.handleAjaxSuccess.bind(this)});this.notificationType="latest";this.registerEventHandler(this.element,"click",this.handleClick.bind(this));var d=this;jQuery("#clearNotifications").click(function(f){d.handleClick(f)});var b=jQuery("#userMenu");this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("notification.",this.notificationHandler.bind(this));this.newpost_num=0;this.postIds={top:[],top10:[],latest:[]};this.newposts=[];this.postElement=jQuery("#post_notification");this.userElement=jQuery("#user_notification");this.notifications=[];this.notificationsVisible=false;this.loadUserTemplates()}},powwow_authEventHandler:function(b){switch(b.name){case"user.auth.ssoSuccess":this.isBurner=b.source.data.loggedIn&&b.source.data.user.authType==="burner";if(b.source.data.loggedIn){this.userId=b.source.data.user.id;this.powwow_hideNotificationList();
this.powwow_clearNotificationList();this.powwow_getNotifications()}break;case"user.auth.ssoFailure":this.isBurner=false;this.powwow_hideNotificationList();this.powwow_clearNotificationList();break}},powwow_notificationEventHandler:function(d){switch(d.name){case"notification.togglelist":if(this.notificationsVisible===true){this.powwow_hideNotificationList()}else{var b=this;jQuery("#userMenu").bind("clickoutside",function(){b.powwow_hideNotificationList()});this.powwow_showNotificationList()}break}},powwow_powwowEventHandler:function(b){switch(b.name){case"powwow.notificationsCleared":this.unseenNotificationCount=0;this.powwow_notificationsChanged();break}},powwow_navigationEventHandler:function(b){switch(b.name){case"navigation.load":this.powwow_hideNotificationList();break}},powwow_ajax:function(b){jQuery.ajax({url:siteConfig.powwowBasePath+"api/v1/notification/",data:b,dataType:"jsonp",jsonp:"jsonP",success:this.powwow_handleAjaxSuccess.bind(this),error:this.powwow_handleAjaxFailure.bind(this)})},powwow_getNotifications:function(){if(!this.userId){return}this.powwow_ajax({method:"notification.get",username:this.userId})},powwow_flushNotifications:function(){if(!this.userId){return}if(this.notifications.length>0&&this.notifications[0].timestamp>0){this.powwow_ajax({method:"notification.flush",lastSeenTimestamp:this.notifications[0].timestamp,username:this.userId})}},powwow_handleAjaxSuccess:function(d){var b=(function(j,g){var h='<a href="/me/inbox" class="powwowInboxLink">View your Inbox</a>';if(j.length===0||g===0){this.powwow_addNotification(h,0);return}var k=[];for(var e=0;e<j.length;e++){if(k.length>=4){break}if(j[e].issued<=this.lastSeenTimestamp){continue}if(jQuery.inArray(j[e].author.displayName,k)===-1){k.push(j[e].author.displayName)}}switch(k.length){case 0:this.powwow_addNotification(h,0);this.unseenNotificationCount=0;return;case 1:k=k[0];break;case 2:k=k[0]+" and "+k[1];break;case 3:k=k[0]+", "+k[1]+" and "+k[2];break;default:k=k[0]+", "+k[1]+", "+k[2]+" and more";break}var f=(g===1)?"a new reply":g+" new replies";this.powwow_addNotification("You have "+f+" from "+k+". "+h,j[0].issued)}).bind(this);if(d.meta!==undefined&&d.meta.success===true){switch(d.meta.method.toLowerCase()){case"notification.get":this.hasMoreNotifications=(d.data.paging.hasMore||false)===true;this.lastSeenTimestamp=parseInt(d.data.lastSeenTimestamp||0);this.unseenNotificationCount=parseInt(d.data.newEntries||0);b(d.data.comment||[],this.unseenNotificationCount);break;case"notification.flush":this.lastSeenTimestamp=parseInt(d.data.lastSeenTimestamp||0);this.unseenNotificationCount=0;break}this.powwow_notificationsChanged()}},powwow_handleAjaxFailure:function(){this.powwow_hideNotificationList();this.powwow_clearNotificationList()},powwow_addNotification:function(d,b){this.notifications.push({text:d,timestamp:b});jQuery("#userMenu").addClass("notifications")},powwow_notificationsChanged:function(){this.notifications.sort(function(f,e){return e.timestamp-f.timestamp});var d="";for(var b=0;b<Math.min(this.notifications.length,this.notificationLimit);b++){d+='<div class="notice">'+this.notifications[b].text+"</div>"}jQuery("#userNotificationContainer").html(d);jQuery("#profileNotificationCounter").html(this.unseenNotificationCount).toggle(this.unseenNotificationCount>0);jQuery("#i_account_loggedin .icon").toggle(!(this.unseenNotificationCount>0));jQuery("#userNotificationContainer").click((function(f){window.location.href="/me/inbox"}).bind(this));jQuery("#userNotificationContainer a").click((function(f){this.powwow_hideNotificationList()}).bind(this))},powwow_showNotificationList:function(){jQuery("#userMenu").show();this.notificationsVisible=true;this.powwow_flushNotifications()},powwow_hideNotificationList:function(){jQuery("#userMenu").hide();jQuery("#userMenu").removeClass("notifications");this.notificationsVisible=false},powwow_clearNotificationList:function(){jQuery("#userNotificationContainer").html("");jQuery("#profileNotificationCounter").hide().html("");this.notifications=[];this.unseenNotificationCount=0},notificationHandler:function(d){jQuery(".presence_control.cn_logout_panel").hide();switch(d.name){case"notification.togglelist":if(this.notificationsVisible===true){this.hideNotificationList()}else{var b=this;jQuery("#userMenu").bind("clickoutside",function(){b.hideNotificationList()});this.showNotificationList()}break}},handleClick:function(j){var h=jQuery(j.target);if(h.attr("id")=="clearNotifications"){this.clearNotifications();j.preventDefault();j.stopPropagation()}else{if(h.hasClass("cn_wrap")){var g=this;var d=jQuery("#post_notification");var f={width:d.outerWidth(),height:d.outerHeight(),"margin-top":-1*d.outerHeight(true)};var b=jQuery("#post_notification_overlay").css(f).html('<img src="/assets/base.v10/img/indicator/progressIndicator_roller.gif" />');b.fadeTo(500,0.8,function(){g.showNewPosts()});j.preventDefault();j.stopPropagation()}}},handleAjaxSuccess:function(b){if(b.action=="newposts"){if(b.success){this.updateNotification(b);
this.raiseEvent("notification.newpost",{data:b})}}else{if(b.action=="inflownotifications"){if(b.success){if(b.newPointer!==undefined){this.notificationsCleared()}else{if(b.items!==undefined){this.userNotificationLoaded(b)}}}}}},authEventHandler:function(b){if(this.auth.now!==undefined&&!isNaN(this.auth.now)){this.updateBase=this.auth.now;this.now=Math.round(new Date().getTime()/1000);this.setLastUpdate()}var d=this;switch(b.name){case"user.auth.success":this.getUserNotifications();break;case"user.auth.failure":this.hideNotificationList();this.clearNotificationList();break}},getUserNotifications:function(){var b={op:"commentinflow",countOnly:0,updatePointer:0,startIndex:0,r:this.auth.getRevision()};this.xhr.send("/index.php",b)},userNotificationLoaded:function(b){this.parseUserNotifications(b)},loadUserTemplates:function(){this.userTemplates={};var b=this;jQuery("#notif_templates span").each(function(){var d=jQuery(this);b.userTemplates[this.className]=d.html()})},createNotices:function(l,d,b){var h="";var k=["youAre","userName","you","time","youHave","postLink","postName","your","commentLink","messageLink"];if(!b){b=0}var e=b+d;if(e>l.length){e=l.length}for(var g=b;g<e;g++){var o=l[g];var n=this.userTemplates[o.type];for(var f=0;f<k.length;f++){var m=k[f];if(o[m]!==undefined){n=n.replace("%"+m+"%",o[m]);n=n.replace("#"+m+"#",o[m])}}h+='<div class="notice">'+n+"</div>";if(g==b+d-1&&l.length>b+d){h+='<div class="notice morelink pointer_'+g+'"><a href="#">more</a></div>';h+='<div class="notices_'+g+'" style="display: none;">';h+=this.createNotices(l,d,g+1);h+="</div>"}}return h},moreClickHandler:function(d){var b=jQuery(d.target);if(!b.hasClass("morelink")){b=b.closest(".morelink")}var f=this.getParam("pointer",b);jQuery("#userMenu div.morelink.pointer_"+f).hide();jQuery("#userMenu div.notices_"+f).show();d.stopPropagation=true;d.preventDefault=true},parseUserNotifications:function(d){var f=false;if(d.items===undefined){d.items=[]}this.notifications=d.items;if(d.items.length>0){var b=jQuery("#userNotificationContainer");b.html(this.createNotices(d.items,5));var e=this;jQuery("#userMenu div.morelink, #userMenu div.morelink a").click(function(g){e.moreClickHandler(g)});this.clearOnHide=false;jQuery("#profileNotificationCounter").html(d.items.length).show();jQuery("#clearNotifications").show()}else{jQuery("#clearNotifications").hide()}},showNotificationList:function(){var b=jQuery("#userMenu");b.show();this.notificationsVisible=true},hideNotificationList:function(){var b=jQuery("#userMenu");b.hide();this.notificationsVisible=false;if(this.controls.user_menu!==undefined){this.controls.user_menu.removeClass("notifications")}},clearNotifications:function(){if(this.feature.isOn(this.feature.SSOLOGIN)&&!jQuery.cookie("ssomigrate_notify")){jQuery.cookie("ssomigrate_notify",1,{path:"/",expires:3})}var b={op:"commentinflow",countOnly:1,updatePointer:1,r:this.auth.getRevision()};this.xhr.send("/index.php",b)},clearNotificationList:function(){jQuery("#userNotificationContainer").html("");jQuery("#profileNotificationCounter").hide().html("");jQuery("#clearNotifications").hide();this.notifications=[]},notificationsCleared:function(){this.hideNotificationList();this.clearNotificationList()},resetControls:function(){this.setControls()},checkNotifications:function(){if(this.notificationType=="latest"){var b={op:"ajax_remoteservice",type:"newpostd",siteId:this.options.siteId,lastUpdate:this.last_update}}},filterNotifications:function(k){var b=["top","top10","latest"];for(var e=0;e<b.length;e++){var g=b[e];var f=[];for(var d=0;d<k[g].length;d++){var h=k[g][d];if(jQuery.inArray(h,this.postIds[g])==-1){f.push(h);this.postIds[g].push(h)}}k[g]=f}return k},updateNotification:function(b){b=this.filterNotifications(b);if(b.latest.length>0){jQuery.merge(this.newposts,b.latest);this.showNewStoriesBadge(b.latest.length)}this.setLastUpdate()},showNewStoriesBadge:function(b){var d=this.controls.wrap;this.newpost_num+=b;d.html("<strong>"+this.newpost_num+" new stor"+(this.newpost_num>1?"ies":"y")+" published</strong>, click to view.");this.postElement.css("opacity",1).show()},showBreakingList:function(f){var e="";for(var d=0;d<f.posts.length;d++){var b=f.posts[d];e+='<div class="notifbadge breakingbadge"><a class="notificationControl cn_breakinglink postid_'+b.id+'" href="'+b.permalink+'"><b>Breaking</b>: '+b.title+"</a></div>"}jQuery("#breaking_notification").html(jQuery("#breaking_notification").html()+e);jQuery("#breaking_notification").show();jQuery("#breaking_notification a").bind("click",this.handleClick.bind(this))},showBreakingPost:function(e){var d=jQuery("#breaking_notification a.postid_"+e);var b=d.parents("div.breakingbadge");this.raiseEvent("navigation.load",{href:d.attr("href")});b.hide()},setLastUpdate:function(){this.last_update=this.updateBase+(Math.round(new Date().getTime()/1000)-this.now)},showNewPosts:function(){params={op:"newposts",ids:this.newposts};var b=this;jQuery.get("index.php",params,function(e){jQuery("#post_notification_overlay").fadeOut(500);
jQuery("#post_notification").fadeOut(500);var d={data:e.content.replace("post siteid","post notificationpost siteid")};b.raiseEvent("notification.loaded",d)});this.newpost_num=0;this.newposts=[]},showMoreUserNotifications:function(){this.controls.user_header.hide();this.getUserNotifications(false)}});a.extend(a.ui.NotificationWidget,{version:"1.0",defaults:{controlClass:"notificationControl"}})})(jQuery);(function($){$.widget("ui.PresenceWidget",{validator:null,xhr:null,initialize:function(){this.jwindow=jQuery(window);this.xhr=new XHR({klass:"presence",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClicks.bind(this));var panels={};if(this.controls.login_form){panels.login={el:this.controls.login_dialog,focus:this.controls.username};this.login_validator=new Validator(jQuery.extend({},{scope:this.controls.login_form}));this.registerEventHandler(this.controls.login_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.login_form,"submit",this.handleLoginSubmit.bind(this))}if(this.controls.resetpw_form){panels.resetpw={el:this.controls.resetpw_dialog,focus:this.controls.resetpwemail};this.resetpw_validator=new Validator(jQuery.extend({},{scope:this.controls.resetpw_form}));this.registerEventHandler(this.controls.resetpw_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.resetpw_form,"submit",this.handleResetPasswordSubmit.bind(this))}if(this.controls.register_form){panels.register={el:this.controls.register_dialog};this.register_validator=new Validator(jQuery.extend({},{scope:this.controls.register_form}));this.registerEventHandler(this.controls.register_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.register_form,"submit",this.handleRegisterSubmit.bind(this))}if(this.controls.emailreminder_form){panels.emailreminder={el:this.controls.emailreminder_dialog,focus:this.controls.emailreminder_email};this.emailreminder_validator=new Validator(jQuery.extend({},{scope:this.controls.emailreminder_form}));this.registerEventHandler(this.controls.emailreminder_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.emailreminder_form,"submit",this.handleEmailReminderSubmit.bind(this))}if(this.controls.subscribe_form){panels.subscribe={el:this.controls.subscribe_dialog,focus:this.controls.subscribe_email};this.subscribe_validator=new Validator(jQuery.extend({},{scope:this.controls.subscribe_form}));this.registerEventHandler(this.controls.subscribe_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.subscribe_form,"submit",this.handleSubscribeSubmit.bind(this))}if(this.controls.commentsettings_form){panels.commentsettings={el:this.controls.commentsettings_dialog};this.registerEventHandler(this.controls.commentsettings_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.commentsettings_form,"submit",this.handleCommentSettingsSubmit.bind(this))}if(this.controls.avatarupload_form){panels.avatarupload={el:this.controls.avatarupload_dialog,focus:this.controls.avatarupload_file};this.avatarupload_validator=new Validator(jQuery.extend({},{scope:this.controls.avatarupload_form}));this.registerEventHandler(this.controls.avatarupload_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.avatarupload_form,"submit",this.handleAvataruploadSubmit.bind(this));GawkerClientside.callbacks=jQuery.extend((GawkerClientside.callbacks?GawkerClientside.callbacks:{}),{avatarUploadResponse:this.handleAjaxSuccess.bind(this)})}if(this.controls.profileedit_form){panels.profileedit={el:this.controls.profileedit_dialog,focus:this.controls.profileedit_displayname};this.profileedit_validator=new Validator(jQuery.extend({},{scope:this.controls.profileedit_form}));this.registerEventHandler(this.controls.profileedit_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.profileedit_form,"submit",this.handleProfileeditSubmit.bind(this))}if(this.controls.editreminder_form){panels.editreminder={el:this.controls.editreminder_dialog,focus:this.controls.editreminder_email};this.editreminder_validator=new Validator(jQuery.extend({},{scope:this.controls.editreminder_form}));this.registerEventHandler(this.controls.editreminder_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.editreminder_form,"submit",this.handleEditReminderSubmit.bind(this))}if(this.controls.changepassword_form){panels.changepassword={el:this.controls.changepassword_dialog,focus:this.controls.changepassword_password};this.changepassword_validator=new Validator(jQuery.extend({},{scope:this.controls.changepassword_form}));this.registerEventHandler(this.controls.changepassword_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.changepassword_form,"submit",this.handleChangepasswordSubmit.bind(this))
}if(this.feature.isOn(this.feature.POWWOW)){if(this.controls.burnerpanel_form){panels.burnerpanel={el:this.controls.burnerpanel_dialog,focus:this.controls.burnerpanel_name};this.burnerpanel_validator=new Validator(jQuery.extend({},{scope:this.controls.burnerpanel_form}));this.registerEventHandler(this.controls.burnerpanel_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.burnerpanel_form,"submit",this.handleBurnerPanelSubmit.bind(this));var obj=this;(function(){var timer=null;jQuery("#burnerpanel_name").keyup(function(a){if(timer!==null){clearTimeout(timer)}if(this.value.length==0){obj.burnerpanel_validator.hideErrors()}else{timer=setTimeout(function(){jQuery(".burnerNameCheck").hide();jQuery("#burnerCheckingName").show();obj.xhr.send("/sso/checkLogin?username="+encodeURIComponent(jQuery("#burnerpanel_name").val()))},1000)}})})()}if(this.controls.burnersuccesspanel_dialog){panels.burnersuccess={el:this.controls.burnersuccesspanel_dialog}}}if(this.controls.guestpanel_form){panels.guestpanel={el:this.controls.guestpanel_dialog,focus:this.controls.guestpanelemail};this.guestpanel_validator=new Validator(jQuery.extend({},{scope:this.controls.guestpanel_form}));this.registerEventHandler(this.controls.guestpanel_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.guestpanel_form,"submit",this.handleGuestPanelSubmit.bind(this))}if(this.controls.deleteuser_form){panels.deleteuser={el:this.controls.deleteuser_dialog};this.registerEventHandler(this.controls.deleteuser_form,"submit",this.handleDeleteUserSubmit.bind(this))}if(this.controls.html5_dialog){panels.html5={el:this.controls.html5_dialog}}if(this.feature.isOn(this.feature.SSOLOGIN)){if(this.controls.ssousermigrate_dialog){panels.ssousermigrate={el:this.controls.ssousermigrate_dialog}}if(this.controls.ssousermigratesuccess_dialog){panels.ssousermigratesuccess={el:this.controls.ssousermigratesuccess_dialog}}if(this.controls.ssologin_dialog){panels.ssologin={el:this.controls.ssologin_dialog}}}this.commondialogs.initDialogs({overlay:this.controls.overlay,panels:panels,group:this.options.dialoggroup?this.options.dialoggroup:false});this.resetWidget();var hd=window.location.search.match(/[\?&](hd|ie9preview)(?:=|=([^&]+))?(?:&|$)/i);if(hd&&hd[2]!=="off"){this.commondialogs.toggleDialog({which:"html5"})}this.openAfterLogin=null;this.dialogHandler=0;this.subscribeForEvent("presence.requiredialog",this.dialogEventHandler.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("maincontent.profilepageloaded",this.profilePageLoadedHandler.bind(this));this.subscribeForEvent("presence.requiresequence.",this.sequenceHandler.bind(this));this.subscribeForEvent("dialog.beforeOpen.login",this.resetResetLoginDialog.bind(this));this.subscribeForEvent("dialog.beforeOpen.resetpw",this.resetResetPwDialog.bind(this));this.subscribeForEvent("dialog.beforeOpen.changepassword",this.resetChangePasswordDialog.bind(this))},dialogEventHandler:function(ev){var obj=this;var currentDialogHandler=this.dialogHandler;switch(ev.params.mode){case"register":this.dialogHandler=function(){var hashparts=ev.params.hash.split("|");if(hashparts.length>1&&obj.controls.register_invitecode){obj.controls.register_invitecode.val(hashparts[1]);if(hashparts.length>2){if(hashparts[2]=="a"){obj.controls.register_copy.html("Registering will give you a star user profile with the ability to comment immediately. You will also be able to add other users as friends.")}else{if(hashparts[2]=="s"){obj.controls.register_copy.html("Registering will give you a user profile with the ability to comment immediately. You will also be able to add other users as friends.")}}}}obj.commondialogs.toggleDialog({which:"register"})};break;case"login":this.dialogHandler=function(){obj.commondialogs.toggleDialog({which:"login"})};break;case"resetpassword":this.dialogHandler=function(){obj.commondialogs.toggleDialog({which:"resetpw"})};break;case"logout":this.dialogHandler=function(){obj.mystate="loggedin:logging_out:clicked";obj.xhr.send(obj.options.logout_action_url,{})};break;case"profileedit":this.dialogHandler=function(){obj.commondialogs.toggleDialog({which:"profileedit"})};break;case"deleteuser":this.dialogHandler=function(){if(obj.auth.authenticated){obj.commondialogs.toggleDialog({which:"deleteuser",cancel:function(){location.hash=""}})}};break}if(typeof(this.dialogHandler)=="function"&&currentDialogHandler==-1){this.dialogHandler();this.dialogHandler=-1}},authEventHandler:function(ev){this.authEventObject=ev;var is_init=this.inState("init");var max_name_length=22;var main_profile_controls=jQuery(".mainProfileControls");main_profile_controls.hide();this.setControls();switch(ev.name){case"user.auth.success":if(this.controls.profile_link){var profileLabel=this.auth.user.smartName;if(this.auth.user.smartName.length>max_name_length){profileLabel=this.auth.user.smartName.substr(0,max_name_length)+"..."}profileLabel+='<span id="profileNotificationCounter" class="site-bg-color" style="display:none"></span>';
this.controls.profile_link.attr("href","/me").html(profileLabel)}if(!is_init){this.fireEvent("onLoginPanelHide",this);this.syncEffect({el:this.controls.login_panel,fn:"hide"})}if(this.controls.profile_panel){this.syncEffect({el:this.controls.profile_panel,fn:"show"})}if(this.controls.avatarupload_form){if(this.controls.profileedit_avatarimage){if(this.auth.user.avatarPath.indexOf("http")===0){this.controls.profileedit_avatarimage.attr({src:this.auth.user.avatarPath+"avt-large."+this.auth.user.avatarPath.substr(-4,3)})}else{this.controls.profileedit_avatarimage.attr({src:this.options.commenterimage_host_prefix+this.auth.user.avatarPath+this.options.commenterimage_host_postfix})}}this.controls.avatarupload_authtoken.val(this.auth.user.authToken?this.auth.user.authToken:"")}this.mystate="loggedin";if(this.controls.profilepagecontrols){var profile_id=this.getParam("uid",this.controls.profilepagecontrols);if(this.auth.user.id===profile_id){this.xhr.send(this.options.isburner_action_url,{});main_profile_controls.show();if(!this.auth.user.fb_uid&&this.controls.main_changepassword_link){this.controls.main_changepassword_link.show()}if(!this.auth.user.fb_uid&&this.controls.main_deleteuser_link){this.controls.main_deleteuser_link.show()}this.controls.profilepagecontrols.show();this.setupProfileForms()}else{this.controls.profilepagecontrols.hide();this.controls.main_changepassword_link.hide()}}if(this.auth.hasLevel("authors")){Debug.enable()}else{Debug.disable()}if(typeof(this.openAfterLogin)=="function"){this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:this.openAfterLogin(this.auth.user),sync_this:this.syncEffect.bind(this)}});this.openAfterLogin=null}else{if(this.auth.showNonAsciiNotification!==undefined&&this.auth.showNonAsciiNotification===true){if(this.auth.user.emailuser){this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"resetpw",sync_this:this.syncEffect.bind(this)}})}else{this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"changepassword",sync_this:this.syncEffect.bind(this)}})}}}if(this.auth.sso_migrated&&this.auth.user.authApps.indexOf("ZAP")!=-1){this.showSsoMigratedDialog(this.auth.sso_migrated);GawkerClientside.widgets.notificationControl[0].clearNotificationList();GawkerClientside.widgets.notificationControl[0].getUserNotifications();this.auth.sso_migrated=null;this.auth.resetRevision()}break;case"user.auth.failure":jQuery("#mustaddemail").remove();jQuery("#profileClickMode").html("presence");if(!is_init){this.fireEvent("onLogoutPanelHide",this,true);this.syncEffect({el:this.controls.logout_panel,fn:"hide"})}this.fireEvent("onLoginPanelShow",this,true);this.syncEffect({el:this.controls.login_panel,fn:"show"});this.mystate="loggedout:no_dialog";if(this.controls.profilepagecontrols){if(this.controls.main_changepassword_link){this.controls.main_changepassword_link.hide()}if(this.controls.main_deleteuser_link){this.controls.main_deleteuser_link.hide()}this.controls.profilepagecontrols.hide();this.controls.profileedit_contactname[0].disabled=true;this.controls.profileedit_contactname_panel.hide();this.controls.profileedit_contactemail[0].disabled=true;this.controls.profileedit_contactemail_panel.hide()}if(this.options.loginNeeded==true){this.commondialogs.toggleDialog({which:"login"})}if(!this.auth.hasLevel("authors")){Debug.disable()}break}if(typeof(this.dialogHandler)=="function"){this.dialogHandler()}this.dialogHandler=-1;if(is_init&&window.location.hash.length>0){var hashparts=window.location.hash.split("|");if(hashparts.length>1){this.raiseEvent("presence.requiredialog",{mode:hashparts[1],hash:window.location.pathname})}}if(pageType=="frontpage"){jQuery.cookie("ad_url_visited_"+this.auth.site.canonicalHost.replace(/\./,"_"),"true",{expires:2592000,path:"/"})}},showSsoMigratedDialog:function(provider){jQuery("#sso-provider-name").html(provider);this.commondialogs.toggleDialog({which:"ssousermigratesuccess"})},profilePageLoadedHandler:function(){this.resetElements();this.setControls();this.registerEventHandler(this.element,"click",this.handleClicks.bind(this));if(this.authEventObject!==undefined){this.authEventHandler(this.authEventObject)}},sequenceHandler:function(ev){switch(ev.name){case"presence.requiresequence.fblogin":this.triggerFBLogin();break;case"presence.requiresequence.login":this.commondialogs.toggleDialog({which:"login"});break;case"presence.requiresequence.register":this.commondialogs.toggleDialog({which:"register"});break;case"presence.requiresequence.resetpw":this.commondialogs.toggleDialog({which:"resetpw"});break;case"presence.requiresequence.guest":if(!this.feature.isOn(this.feature.POWWOW)){this.commondialogs.toggleDialog({which:"guestpanel"})}break}},resetChangePasswordDialog:function(e){this.controls.changepassword_password.val("");this.controls.changepassword_new_password.val("");this.controls.changepassword_confirm_password.val("");jQuery(".validationmessage",this.controls.changepassword_dialog).hide();this.handleNoAsciiMessage("#noAsciiNotifyChangePassword")
},resetResetLoginDialog:function(e){this.controls.username.val("");this.controls.password.val("");this.controls.loginmessage.html("")},resetResetPwDialog:function(e){if(this.recaptchaKey===undefined){this.recaptchaKey=jQuery("#resetPwRecaptcha").html()}this.handleNoAsciiMessage("#noAsciiNotify");if(!this.feature.isOn(this.feature.POWWOW)){jQuery.getScript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js",jQuery.proxy(function(){Recaptcha.create(this.recaptchaKey,"resetPwRecaptcha");jQuery("#resetPassword1").show();jQuery("#resetPassword2").hide();this.controls.resetpwemail.val("")},this))}},handleNoAsciiMessage:function(id){if(this.auth!==undefined&&this.auth.showNonAsciiNotification!==undefined&&this.auth.showNonAsciiNotification===true){jQuery(id).show();this.xhr.send("/index.php?op=ajax_nonasciinotified");this.auth.showNonAsciiNotification=false}else{jQuery(id).hide()}},handleClicks:function(e){var t=this.getParam("cn",e.target);var shouldstop=false;switch(t){case"register_or_login":shouldstop=true;jQuery("div.modal.modalpopup.ssologin.presence_control.cn_ssologin_dialog").find("div.account_linked").hide();this.commondialogs.toggleDialog({which:"ssologin"});break;case"ssousermigrate_link":shouldstop=true;GawkerClientside.widgets.notificationControl[0].hideNotificationList();this.commondialogs.toggleDialog({which:"ssousermigrate"});break;case"ssousermigratesuccess_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"ssousermigratesuccess"});break;case"ssousermigratesuccess_ok":shouldstop=true;this.commondialogs.toggleDialog({which:"ssousermigratesuccess"});break;case"ssousermigrate_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"ssousermigrate"});break;case"ssousermigrate_ok":shouldstop=true;this.commondialogs.toggleDialog({which:"ssousermigratesuccess"});break;case"fullsitelist":shouldstop=true;var siteliststring='(<a href="http://gizmodo.com">Gizmodo</a>, <a href="http://gawker.com">Gawker</a>, <a href="http://lifehacker.com">Lifehacker</a>, <a href="http://deadspin.com">Deadspin</a>, <a href="http://kotaku.com">Kotaku</a>, <a href="http://jezebel.com">Jezebel</a>, <a href="http://io9.com">io9</a> and <a href="http://jalopnik.com">Jalopnik</a>)';jQuery(e.target).replaceWith(siteliststring);break;case"login_oauth":shouldstop=true;var loginType=this.getParam("type",e.target);var migrate=jQuery(e.target).hasClass("migrate");if(window.location.pathname.indexOf("/ccs")==0){migrate=false}this.oauthLogin(loginType,migrate);break;case"fb_login":shouldstop=true;this.triggerFBLogin();break;case"login_cancel":this.xhr.abort();case"togglelogindialog":shouldstop=true;if(this.inState("loggedout:no_dialog")){this.resetWidget()}this.commondialogs.toggleDialog({which:"login"});break;case"logout_link":shouldstop=true;this.mystate="loggedin:logging_out:clicked";this.controls.user_menu.hide();this.controls.loginmessage.html("");if(this.auth.user.authApps.indexOf("ZAP")!=-1){var s=document.createElement("script");s.type="text/javascript";s.src="/sso/logout_request";s.async=true;var obj=this;globalLogoutFunc=function(){obj.xhr.send(obj.options.logout_action_url,{})};jQuery("body").append(s);var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(s,r)}else{this.xhr.send(this.options.logout_action_url,{})}break;case"resetpw_submit":this.controls.resetpw_form.submit();break;case"toggleresetpwdialog":case"resetpw_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"resetpw"});break;case"ssousermigrate_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"ssousermigrate"});break;case"html5_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"html5"});break;case"register_submit":this.controls.register_form.submit();break;case"toggleregisterdialog":case"register_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"register"});break;case"emailreminder_cancel":shouldstop=true;this.controls.emailreminder_noemail.val(1);this.controls.emailreminder_form.submit();break;case"togglesubscribedialog":case"subscribe_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"subscribe"});break;case"togglecommentsettingsdialog":case"commentsettings_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"commentsettings"});break;case"profileedit_newUsername_change":if(this.feature.isOn(this.feature.POWWOW)&&!(this.auth.user.converted===1)){this.controls.profileedit_dialog.find(".feature_newcomments_newuser").show();this.controls.profileedit_dialog.find(".feature_newcomments_olduser").hide()}else{this.controls.profileedit_newUsername_text.hide();this.controls.profileedit_newUsername_change.hide();this.controls.profileedit_newUsername_change_warn.show();this.controls.profileedit_newUsername.show();this.controls.profileedit_newUsername.focus().select();this.controls.profileedit_dialog.find(".feature_newcomments_newuser").hide()}break;case"toggleprofileeditdialog":case"profileedit_cancel":if(this.feature.isOn(this.feature.POWWOW)&&!(this.auth.user.converted===1)){this.controls.profileedit_dialog.find(".feature_newcomments_newuser").show();
this.controls.profileedit_dialog.find(".feature_newcomments_olduser").hide()}else{if(this.auth.authenticated&&(typeof(this.auth.user.oldUsername)=="undefined"||this.auth.user.oldUsername==null)){this.controls.profileedit_newUsername[0].disabled=false;this.controls.profileedit_newUsername.parent().show();this.controls.profileedit_newUsername.val(this.auth.user.username);this.controls.profileedit_newUsername_change_warn.hide();this.controls.profileedit_newUsername.hide();this.controls.profileedit_newUsername_text.show();this.controls.profileedit_newUsername_change.show()}else{this.controls.profileedit_newUsername[0].disabled=true;this.controls.profileedit_newUsername.parent().hide()}this.controls.profileedit_dialog.find(".feature_newcomments_newuser").hide();this.controls.profileedit_dialog.find(".feature_newcomments_olduser").show()}shouldstop=true;this.commondialogs.toggleDialog({which:"profileedit"});break;case"profileedit_submit":if(this.controls.profileedit_newUsername.val()!=this.auth.user.username){if(!confirm("Warning! You are only able to change your username once. Once you save your new username, you will not be able to change it again. Are you sure you want to save?")){shouldstop=true}}break;case"editreminder_cancel":shouldstop=true;this.controls.editreminder_noemail.val(1);this.controls.editreminder_form.submit();break;case"togglechangepassworddialog":case"changepassword_cancel":shouldstop=true;if(this.auth.user){if(this.auth.user.emailuser){this.commondialogs.toggleDialog({which:"resetpw"})}else{this.commondialogs.toggleDialog({which:"changepassword"})}}else{this.openAfterLogin=function(user){if(user.emailuser){return"resetpw"}return"changepassword"};this.commondialogs.toggleDialog({which:"login"})}break;case"toggledeleteuserdialog":case"deleteuser_cancel":shouldstop=true;if(this.auth.user){this.commondialogs.toggleDialog({which:"deleteuser"})}else{this.openAfterLogin=function(user){return"deleteuser"};this.commondialogs.toggleDialog({which:"login"})}break;case"toggleavataruploaddialog":case"avatarupload_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"avatarupload"});break;case"guestpanel_cancel":this.commondialogs.toggleDialog({which:"guestpanel"});break;case"burnerpanel_cancel":this.commondialogs.toggleDialog({which:"burnerpanel"});break;case"burnersuccesspanel_cancel":this.commondialogs.toggleDialog({which:"burnersuccess"});break;case"profile_link":shouldstop=true;this.raiseEvent("notification.togglelist");break;case"goto_profile":shouldstop=false;this.raiseEvent("notification.togglelist");this.controls.user_menu.hide();break;case"dialog":shouldstop=true;var mode=this.getParam("dialog",e.target);this.raiseEvent("presence.requiredialog",{mode:mode,hash:window.location.pathname+window.location.search});break;case"overlay":if(jQuery(".cn_ssousermigrate_dialog:visible").length==0&&jQuery(".cn_burnercreatesuccess_dialog:visible").length==0){shouldstop=true;this.commondialogs.toggleDialog()}break}if(shouldstop){e.stopPropagation();e.preventDefault()}},triggerFBLogin:function(){FB.Bootstrap.requireFeatures(["Connect"],function(){FB.Connect.requireSession(function(){this.mystate="loggedout:login_dialog_active:request_sent";this.auth.fbWhenReady(function(){this.xhr.send(this.options.facebook_action_url,{action:"loginOrRegister"})}.bind(this))}.bind(this),true)}.bind(this));this.disableInputs("login")},oauthLogin:function(type,migrate){var url="";if(this.feature.isOn(this.feature.SSOLOGIN)){url="/sso/login_request?&provider="+type.replace(/[^a-z]/,"")+(migrate?"&migrate=1":"")}else{url="/index.php?op=ajax_oauth_init&type="+type.replace(/[^a-z]/,"")}var debug=location.search.indexOf("debugid=");var debugID="";if(debug>0){debugID=location.search.substring(debug).split("&")[0].split("=")[1]}if(debugID!=""){url+="&debugid="+debugID}var d=new Date();var needle="fetchUserState2=1";document.cookie=needle+";expires="+d.toGMTString()+";;";window.open(url,"","width=900,height=500");var obj=this;var checkCookies=function(){if(document.cookie.indexOf(needle)!=-1){obj.commondialogs.toggleDialog({which:obj.commondialogs.groups["default"].state.replace("active:","")});var d=new Date();jQuery.cookie("fetchUserState2",null,{path:"/",domain:"."+location.host.replace(/^(.+\.)?([a-zA-Z0-9]+\.[a-zA-Z0-9]+)$/,"$2")});var regNeedle="redirectToProfilePage=1";if(document.cookie.indexOf(regNeedle)!=-1){jQuery.cookie("redirectToProfilePage",null,{path:"/",domain:"."+location.host.replace(/^(.+\.)?([a-zA-Z0-9]+\.[a-zA-Z0-9]+)$/,"$2")});window.location="/me#|profileedit"}else{if(typeof Powwow!=="undefined"){Powwow.loadUser()}obj.auth.getUserState()}}else{setTimeout(checkCookies,200)}};this.auth.resetRevision();checkCookies()},handleKeyUp:function(e){switch(e.keyCode){case jQuery.ui.keyCode.ESCAPE:if(jQuery(".cn_ssousermigrate_dialog:visible").length==0&&jQuery(".cn_burnercreatesuccess_dialog:visible").length==0){this.commondialogs.toggleDialog()}break}},handleLoginSubmit:function(e){e.stopPropagation();e.preventDefault();
this.login_validator.hideErrors();if(this.login_validator.validate()){this.mystate="loggedout:login_dialog_active:request_sent";this.xhr.send(this.options.login_action_url,this.controls.login_form.serialize());this.disableInputs("login");this.controls.loginmessage.html("");jQuery(".spinner",this.controls.login_indicator).spin("small")}else{if(this.options.show_validation_errors){this.login_validator.showErrors()}}},handleResetPasswordSubmit:function(e){e.stopPropagation();e.preventDefault();this.resetpw_validator.hideErrors();if(this.resetpw_validator.validate()){this.mystate="loggedout:resetpw_dialog_active:request_sent";this.xhr.send(this.options.resetpw_action_url,this.controls.resetpw_form.serialize());this.disableInputs("resetpw");jQuery(this.controls.resetpw_indicator).spin("small")}else{if(this.options.show_validation_errors){this.resetpw_validator.showErrors()}}},handleRegisterSubmit:function(e){e.stopPropagation();e.preventDefault();this.register_validator.hideErrors();if(this.register_validator.validate()){if(this.controls.register_email[0].value==""){this.commondialogs.toggleDialog({which:"emailreminder"})}else{this.mystate="loggedout:register_dialog_active:request_sent";this.xhr.send(this.options.register_action_url,this.controls.register_form.serialize());this.disableInputs("register")}}else{if(this.options.show_validation_errors){this.register_validator.showErrors()}}},handleEmailReminderSubmit:function(e){e.stopPropagation();e.preventDefault();this.emailreminder_validator.hideErrors();if(this.emailreminder_validator.validate()||this.controls.emailreminder_noemail.val()==1){this.mystate="loggedout:emailreminder_dialog_active:request_sent";this.xhr.send(this.options.register_action_url,this.controls.emailreminder_form.serialize());this.disableInputs("emailreminder")}else{if(this.options.show_validation_errors){this.emailreminder_validator.showErrors()}}},handleSubscribeSubmit:function(e){this.subscribe_validator.hideErrors();if(!this.subscribe_validator.validate()){e.stopPropagation();e.preventDefault();if(this.options.show_validation_errors){this.subscribe_validator.showErrors()}}else{this.fireEvent("onSubscribeRequestSent",this);var _this=this;window.setTimeout(function(){_this.disableInputs("subscribe")},300)}},handleCommentSettingsSubmit:function(e){e.stopPropagation();e.preventDefault();this.mystate="loggedin:commentsettings_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.commentsettings_form.serialize());this.disableInputs("commentsettings")},handleAvataruploadSubmit:function(e){this.avatarupload_validator.hideErrors();if(!this.avatarupload_validator.validate()){e.stopPropagation();e.preventDefault();if(this.options.show_validation_errors){this.avatarupload_validator.showErrors()}}else{this.mystate="loggedin:avatarupload_dialog_active:avatar_request_sent";if(this.controls.avatarupload_indicator){this.controls.avatarupload_indicator.show()}jQuery(this.controls.avatarupload_indicator).spin("small");this.fireEvent("onAvataruploadRequestSent",this);var _this=this;window.setTimeout(function(){_this.disableInputs("avatarupload")},300)}},handleProfileeditSubmit:function(e){e.stopPropagation();e.preventDefault();this.profileedit_validator.hideErrors();if(this.profileedit_validator.validate()){if(this.controls.profileedit_email[0].value==""){this.controls.editreminder_newUsername[0].value=this.controls.profileedit_newUsername[0].value;this.controls.editreminder_displayName[0].value=this.controls.profileedit_displayname[0].value;this.controls.editreminder_url[0].value=this.controls.profileedit_url[0].value;this.controls.editreminder_aimname[0].value=this.controls.profileedit_aimname[0].value;if(this.controls.profileedit_contactname[0]!==undefined){this.controls.editreminder_contactname.val(this.controls.profileedit_contactname.val())}if(this.controls.profileedit_contactemail[0]!==undefined){this.controls.editreminder_contactemail.val(this.controls.profileedit_contactemail.val())}if(this.controls.profileedit_twitterusername[0]!==undefined){this.controls.editreminder_twitterusername.val(this.controls.profileedit_twitterusername.val())}if(this.controls.profileedit_facebookurl[0]!==undefined){this.controls.editreminder_facebookurl.val(this.controls.profileedit_facebookurl.val())}if(this.controls.profileedit_isFacebookFanPage[0]!==undefined){this.controls.editreminder_isFacebookFanPage.val(this.controls.profileedit_isFacebookFanPage.is(":checked")?"true":"false")}if(this.controls.profileedit_googleplusurl[0]!==undefined){this.controls.editreminder_googleplusurl.val(this.controls.profileedit_googleplusurl.val())}this.commondialogs.toggleDialog({which:"editreminder"})}else{this.mystate="loggedin:profileedit_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.profileedit_form.serialize());this.disableInputs("profileedit");jQuery(".cn_profileedit_indicator",this.controls.profileedit_form).spin("small")}}else{if(this.options.show_validation_errors){this.profileedit_validator.showErrors()
}}},handleEditReminderSubmit:function(e){e.stopPropagation();e.preventDefault();this.editreminder_validator.hideErrors();if(this.editreminder_validator.validate()||this.controls.editreminder_noemail.val()==1){this.mystate="loggedin:editreminder_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.editreminder_form.serialize());this.disableInputs("editreminder")}else{if(this.options.show_validation_errors){this.editreminder_validator.showErrors()}}},handleChangepasswordSubmit:function(e){e.stopPropagation();e.preventDefault();this.changepassword_validator.hideErrors();if(this.changepassword_validator.validate()){this.mystate="loggedin:changepassword_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.changepassword_form.serialize());this.disableInputs("changepassword")}else{if(this.options.show_validation_errors){this.changepassword_validator.showErrors()}}},handleDeleteUserSubmit:function(e){e.stopPropagation();e.preventDefault();if(confirm("Are you sure you want to delete your account?")){this.mystate="loggedin:deleteuser_dialog_active:request_sent";this.xhr.send(this.options.deleteuser_action_url,this.controls.deleteuser_form.serialize());this.disableInputs("deleteuser")}},handleBurnerPanelSubmit:function(e){e.stopPropagation();e.preventDefault();this.burnerpanel_validator.hideErrors();if(this.burnerpanel_validator.validate()){var s=document.createElement("script");s.async="async";var funcName="getBurner"+Math.round(Math.random()*1000000);var obj=this;eval(funcName+" = function(data) {obj.handleAjaxSuccess(data)};");s.src="/sso/burner_request?username="+encodeURIComponent(jQuery("#burnerpanel_name").val())+"&jsonP="+funcName;var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;head.insertBefore(s,head.firstChild);this.handleAjaxRequest();jQuery(".burnerNameCheck").hide();jQuery("#burnerCreate").show()}else{if(this.options.show_validation_errors){this.burnerpanel_validator.showErrors();this.controls.burnerpanel_name.focus()}}},handleGuestPanelSubmit:function(e){e.stopPropagation();e.preventDefault();this.guestpanel_validator.hideErrors();if(this.guestpanel_validator.validate()){this.commondialogs.toggleDialog({});var newsletter_check=false;if(this.controls.guestpanel_newsletter[0].checked){newsletter_check=true}this.raiseEvent("commentform.guestsubmit",{email:this.controls.guestpanelemail.val(),newsletter:newsletter_check})}else{if(this.options.show_validation_errors){this.guestpanel_validator.showErrors();this.controls.guestpanelemail.focus()}}},handleAjaxRequest:function(){if(this.inState("loggedin:logging_out:clicked")){if(this.controls.logout_indicator){this.controls.logout_indicator.css("display","inline-block");jQuery(this.controls.logout_indicator).spin("small")}this.fireEvent("onLogoutRequestSent",this);this.mystate="loggedin:logging_out"}else{if(this.inState("loggedout:login_dialog_active:request_sent")){if(this.controls.login_indicator){this.controls.login_indicator.show()}this.fireEvent("onLoginRequestSent",this)}else{if(this.inState("loggedout:resetpw_dialog_active:request_sent")){if(this.controls.resetpw_indicator){this.controls.resetpw_indicator.show()}this.fireEvent("onResetPWRequestSent",this)}else{if(this.inState("loggedout:register_dialog_active:request_sent")){if(this.controls.register_indicator){this.controls.register_indicator.show()}this.fireEvent("onRegisterRequestSent",this)}else{if(this.inState("loggedout:emailreminder_dialog_active:request_sent")){if(this.controls.emailreminder_indicator){this.controls.emailreminder_indicator.show()}this.fireEvent("onRegisterRequestSent",this)}else{if(this.inState("loggedin:commentsettings_dialog_active:request_sent")){if(this.controls.commentsettings_indicator){this.controls.commentsettings_indicator.css("display","inline")}this.fireEvent("onCommentSettingsRequestSent",this)}else{if(this.inState("loggedin:profileedit_dialog_active:request_sent")){if(this.controls.profileedit_indicator){this.controls.profileedit_indicator.show()}this.fireEvent("onProfileEditRequestSent",this)}else{if(this.inState("loggedin:editreminder_dialog_active:request_sent")){if(this.controls.editreminder_indicator){this.controls.editreminder_indicator.show()}this.fireEvent("onProfileEditRequestSent",this)}else{if(this.inState("loggedin:changepassword_dialog_active:request_sent")){if(this.controls.changepassword_indicator){this.controls.changepassword_indicator.show()}this.fireEvent("onChangePasswordRequestSent",this)}else{if(this.inState("loggedin:deleteuser_dialog_active:request_sent")){if(this.controls.deleteuser_indicator){this.controls.deleteuser_indicator.show()}this.fireEvent("onDeleteUserRequestSent",this)}}}}}}}}}}},handleAjaxSuccess:function(data){switch(data.action){case"login":jQuery(".spinner",this.controls.login_indicator).spin(false);case"fblogin":if(data.redirect!==undefined){location.href=data.redirect}Message.showMessage(data.message,this.controls.loginmessage[0],{stable:true});
this.enableInputs("login");if(data.success){this.auth.user=data.user;this.auth.authenticated=true;this.auth.showNonAsciiNotification=data.showNonAsciiNotification?data.showNonAsciiNotification:false;if(data.formToken){this.auth.formToken=data.formToken}this.fireEvent("onLoginSuccess",this,true);var dialogName=this.feature.isOn(this.feature.SSOLOGIN)?"ssousermigrate":"login";this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:dialogName,sync_this:this.syncEffect.bind(this)}});this.resetWidget({except:"login_form"});this.syncEffect({el:this,fn:"resetWidget",params:{only:"login_form"}});this.raiseEvent("user.auth.success",data);this.auth.resetRevision()}else{if(this.controls.login_indicator){this.controls.login_indicator.hide()}if(data.code&&data.code=="ACCOUNT_LINKED"){this.feature.on(this.feature.SSOLOGIN);this.commondialogs.toggleDialog({which:"ssologin"});jQuery("div.modal.modalpopup.ssologin.presence_control.cn_ssologin_dialog").find("div.account_linked").show()}this.fireEvent("onLoginFailure",this)}break;case"logout":if(data.success){this.auth.user=false;this.auth.authenticated=false;if(data.formToken){this.auth.formToken=data.formToken}this.fireEvent("onLogoutSuccess",this);this.raiseEvent("user.auth.failure",data);this.auth.resetRevision();if(typeof Powwow!=="undefined"){Powwow.loadUser()}}else{this.fireEvent("onLogoutFailure",this)}if(this.controls.logout_indicator){jQuery(this.controls.logout_indicator).spin(false);this.controls.logout_indicator.hide()}break;case"register":Message.showMessage(data.message,this.controls.registermessage[0]);Message.showMessage(data.message,this.controls.emailremindermessage[0]);if(this.controls.register_indicator){this.controls.register_indicator.hide()}if(this.controls.emailreminder_indicator){this.controls.emailreminder_indicator.hide()}this.enableInputs("register");this.enableInputs("emailreminder");if(data.success){this.auth.user=data.user;this.auth.authenticated=true;if(data.formToken){this.auth.formToken=data.formToken}this.fireEvent("onRegisterSuccess",this,true);this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:(this.inState("loggedout:register_dialog_active:request_sent")?"register":"emailreminder"),sync_this:this.syncEffect.bind(this)}});this.resetWidget({except:"register_form"});this.resetWidget({except:"emailreminder_form"});this.syncEffect({el:this,fn:"resetWidget",params:{only:"register_form"}});this.syncEffect({el:this,fn:"resetWidget",params:{only:"emailreminder_form"}});this.raiseEvent("user.auth.success",data);this.auth.resetRevision()}else{this.fireEvent("onRegisterFailure",this)}break;case"resetpassword":if(data.success){jQuery("#resetPassword1").hide();jQuery("#resetPassword2").show();this.fireEvent("onResetPWSuccess",this)}else{if(data.reason=="email"){this.fireEvent("onResetPWCaptchaFailure",this)}else{this.fireEvent("onResetPWFailure",this)}}jQuery(this.controls.resetpw_indicator).spin(false);Message.showMessage(data.message,this.controls.resetpwmessage[0]);if(this.controls.resetpw_indicator){this.controls.resetpw_indicator.hide()}this.enableInputs("resetpw");break;case"setprofile":if(this.inState("loggedin:changepassword_dialog_active:request_sent")){if(data.success){Message.showMessage("Password saved.",this.controls.changepassword_message[0],{stable:false});this.commondialogs.toggleDialog({which:"changepassword"})}else{Message.showMessage('<p>Old password is not correct.</p><p>To reset your password, please ensure that your email address is up to date in your profile, click the "reset password" link at the top of the page and enter your updated email address.</p><p>If you are still having trouble with your account, please contact us at <a href="mailto:help@gawker.com">help@gawker.com</a></p>',this.controls.changepassword_messagebig[0],{stable:true})}if(this.controls.changepassword_indicator){this.controls.changepassword_indicator.hide()}this.enableInputs("changepassword")}else{if(this.inState("loggedin:deleteuser_dialog_active:request_sent")){if(data.success){Message.showMessage("Account deleted.",this.controls.deleteuser_message[0],{stable:false});this.commondialogs.toggleDialog({which:"deleteuser"})}else{Message.showMessage('Account deletion failed. Please contact <a href="help@gawker.com">help@gawker.com</a>',this.controls.deleteuser_messagebig[0],{stable:true})}if(this.controls.deleteuser_indicator){this.controls.deleteuser_indicator.hide()}this.enableInputs("deleteuser");if(data.success){location.href="/people/"+data.username+"#logout"}}else{if(this.inState("loggedin:profileedit_dialog_active:request_sent")||this.inState("loggedin:editreminder_dialog_active:request_sent")){if(data.success){Message.showMessage("Profile saved.",this.controls.profileedit_message[0],{stable:false});Message.showMessage("Profile saved.",this.controls.editreminder_message[0],{stable:false});if(data.usernamechanged===true){location.href=data.redirectUrl}this.auth.user.username=this.controls.profileedit_newUsername.val();this.auth.user.smartName=((data.user.smartName!==undefined)?data.user.smartName:"");
this.auth.user.url=((data.user.url!==undefined)?data.user.url:"");this.auth.user.email=((data.user.email!==undefined)?data.user.email:"");this.auth.user.aimname=((data.user.aimname!==undefined)?data.user.aimname:"");if(this.controls.profileedit_extended){for(var i=0,l=this.controls.profileedit_extended.length;i<l;i++){var extname=this.getParam("ext",this.controls.profileedit_extended[i]);this.auth.user[extname]=this.controls.profileedit_extended.eq(i).val()}}this.commondialogs.toggleDialog({which:(this.inState("loggedin:profileedit_dialog_active:request_sent")?"profileedit":"editreminder")});this.auth.resetRevision()}else{Message.showMessage(data.message,this.controls.profileedit_message[0],{stable:false})}if(this.controls.profileedit_indicator){this.controls.profileedit_indicator.hide()}this.enableInputs("profileedit");jQuery(this.controls.profileedit_indicator).spin(false)}else{if(this.inState("loggedin:commentsettings_dialog_active:request_sent")){if(data.success){this.commondialogs.toggleDialog({which:"commentsettings"});this.auth.user.commentViewMode=data.user.commentViewMode;this.auth.user.commentRepliesMode=data.user.commentRepliesMode;this.auth.user.commentOrder=data.user.commentOrder;this.auth.resetRevision()}else{Message.showMessage("Save failed.",this.controls.commentsettings_message[0],{stable:false})}if(this.controls.commentsettings_indicator){this.controls.commentsettings_indicator.hide()}this.enableInputs("commentsettings")}}}}break;case"avatarupload":if(data.success){this.controls.profileedit_avatarimage.attr({src:data.big});this.auth.user.avatarPath=data.big;Message.showMessage(data.message,this.controls.avatarupload_message[0],{stable:false});this.mystate="loggedin:avatarupload_dialog_active";var obj=this;window.setTimeout(function(){obj.commondialogs.toggleDialog({which:"avatarupload"})},2000);this.auth.resetRevision();this.fireEvent("onAvataruploadSuccess",this)}else{this.fireEvent("onAvataruploadFailure",this);Message.showMessage(data.message,this.controls.avatarupload_message[0],{stable:false})}if(this.controls.avatarupload_indicator){this.controls.avatarupload_indicator.hide()}this.enableInputs("avatarupload");jQuery(this.controls.avatarupload_indicator).spin(false);break;case"saveLink":case"link":if(data.success&&data.redirectUrl){location.href=data.redirectUrl}break;case"burner":if(data.success){jQuery("#burnerLoginName").html(data.username);jQuery("#burnerToken").html(data.token);this.auth.getUserState();this.commondialogs.toggleDialog({which:"burnersuccess"})}else{jQuery(".burnerNameCheck").hide();jQuery("#burnerNameTaken").show()}break;case"checkLogin":jQuery(".burnerNameCheck").hide();if(data.success&&data.available){jQuery("#burnerNameAvailable").show()}else{jQuery("#burnerNameTaken").show()}break;case"isBurner":if(data.success){this.auth.user.isBurner=data.isBurner;if(this.auth.user.isBurner===true&&this.controls.profileedit_form){this.controls.profileedit_form.hide();this.controls.profileedit_burnermessage.show()}}break}},handleAjaxFail:function(){if(this.inState("loggedin")){if(this.inState("loggedin:logging_out")){if(this.controls.logout_indicator){this.controls.logout_indicator.hide()}this.fireEvent("onLogoutFailure",this);this.mystate="loggedin"}else{if(this.inState("loggedin:commentsettings_dialog_active:request_sent")){if(this.controls.commentsettings_indicator){this.controls.commentsettings_indicator.css("display","none")}this.fireEvent("onCommentSettingsRequestFail",this);this.mystate="loggedin:commentsettings_dialog_active"}else{if(this.inState("loggedin:profileedit_dialog_active:request_sent")){if(this.controls.profileedit_indicator){this.controls.profileedit_indicator.hide()}this.fireEvent("onProfileEditRequestFail",this);this.mystate="loggedin:profileedit_dialog_active"}else{if(this.inState("loggedout:editreminder_dialog_active:request_sent")){if(this.controls.editreminder_indicator){this.controls.editreminder_indicator.hide()}this.fireEvent("onProfileEditRequestFail",this);this.mystate="loggedout:editreminder_dialog_active"}else{if(this.inState("loggedin:changepassword_dialog_active:request_sent")){if(this.controls.changepassword_indicator){this.controls.changepassword_indicator.hide()}this.fireEvent("onChangePasswordRequestFail",this);this.mystate="loggedin:changepassword_dialog_active"}else{if(this.inState("loggedin:deleteuser_dialog_active:request_sent")){if(this.controls.deleteuser_indicator){this.controls.deleteuser_indicator.hide()}this.fireEvent("onDeleteUserRequestFail",this);this.mystate="loggedin:deleteuser_dialog_active"}}}}}}}else{if(this.inState("loggedout:login_dialog_active:request_sent")){if(this.controls.login_indicator){this.controls.login_indicator.hide()}this.fireEvent("onLoginRequestFail",this);this.mystate="loggedout:login_dialog_active";this.enableInputs("login")}else{if(this.inState("loggedout:resetpw_dialog_active:request_sent")){if(this.controls.resetpw_indicator){this.controls.resetpw_indicator.hide()}this.fireEvent("onResetPWRequestFail",this);
this.mystate="loggedout:resetpw_dialog_active";this.enableInputs("resetpw")}else{if(this.inState("loggedout:register_dialog_active:request_sent")){if(this.controls.register_indicator){this.controls.register_indicator.hide()}this.fireEvent("onRegisterRequestFail",this);this.mystate="loggedout:register_dialog_active";this.enableInputs("register")}else{if(this.inState("loggedout:emailreminder_dialog_active:request_sent")){if(this.controls.emailreminder_indicator){this.controls.emailreminder_indicator.hide()}this.fireEvent("onRegisterRequestFail",this);this.mystate="loggedout:emailreminder_dialog_active";this.enableInputs("emailreminder")}}}}}},disableInputs:function(which){switch(which){case"login":this.controls.username[0].disabled=true;this.controls.password[0].disabled=true;this.controls.login_button[0].disabled=true;break;case"resetpw":this.controls.resetpwemail[0].disabled=true;this.controls.resetpw_submit[0].disabled=true;this.controls.resetpw_cancel[0].disabled=true;break;case"register":this.controls.register_cancel[0].disabled=true;break;case"subscribe":this.controls.subscribe_email[0].disabled=true;this.controls.subscribe_submit[0].disabled=true;this.controls.subscribe_cancel[0].disabled=true;break;case"commentsettings":this.controls.commentsettings_submit[0].disabled=true;this.controls.commentsettings_cancel[0].disabled=true;this.controls.cvm_featured[0].disabled=true;this.controls.cvm_hidden[0].disabled=true;this.controls.crm_expanded[0].disabled=true;this.controls.crm_collapsed[0].disabled=true;break;case"profileedit":this.controls.profileedit_newUsername[0].disabled=true;this.controls.profileedit_displayname[0].disabled=true;this.controls.profileedit_url[0].disabled=true;this.controls.profileedit_email[0].disabled=true;this.controls.profileedit_aimname[0].disabled=true;if(this.controls.profileedit_extended){for(var i=0,l=this.controls.profileedit_extended.length;i<l;i++){var extname=this.getParam("ext",this.controls.profileedit_extended[i]);this.controls.profileedit_extended[i].disabled=true}}if(this.auth.authenticated&&this.auth.hasLevel("authors")){this.controls.profileedit_contactname[0].disabled=true;this.controls.profileedit_contactemail[0].disabled=true}this.controls.profileedit_twitterusername[0].disabled=true;this.controls.profileedit_facebookurl[0].disabled=true;this.controls.profileedit_isFacebookFanPage[0].disabled=true;this.controls.profileedit_googleplusurl[0].disabled=true;this.controls.profileedit_submit[0].disabled=true;this.controls.profileedit_cancel[0].disabled=true;break;case"changepassword":this.controls.changepassword_password[0].disabled=true;this.controls.changepassword_new_password[0].disabled=true;this.controls.changepassword_confirm_password[0].disabled=true;this.controls.changepassword_submit[0].disabled=true;this.controls.changepassword_cancel[0].disabled=true;break;case"deleteuser":this.controls.deleteuser_submit[0].disabled=true;this.controls.deleteuser_cancel[0].disabled=true;break;case"avatarupload":this.controls.avatarupload_file[0].disabled=true;this.controls.avatarupload_submit[0].disabled=true;this.controls.avatarupload_cancel[0].disabled=true;break}},enableInputs:function(which){switch(which){case"login":this.controls.username[0].disabled=false;this.controls.password[0].disabled=false;this.controls.login_button[0].disabled=false;break;case"resetpw":this.controls.resetpwemail[0].disabled=false;break;case"register":break;case"subscribe":this.controls.subscribe_email[0].disabled=false;this.controls.subscribe_submit[0].disabled=false;this.controls.subscribe_cancel[0].disabled=false;break;case"commentsettings":this.controls.commentsettings_submit[0].disabled=false;this.controls.commentsettings_cancel[0].disabled=false;if(this.controls.togglecommentsettingsdialog&&this.controls.togglecommentsettingsdialog[1]){this.controls.togglecommentsettingsdialog[1].disabled=false}this.controls.cvm_featured[0].disabled=false;this.controls.cvm_hidden[0].disabled=false;this.controls.crm_expanded[0].disabled=false;this.controls.crm_collapsed[0].disabled=false;break;case"profileedit":this.controls.profileedit_newUsername[0].disabled=false;this.controls.profileedit_displayname[0].disabled=false;this.controls.profileedit_url[0].disabled=false;this.controls.profileedit_email[0].disabled=false;this.controls.profileedit_aimname[0].disabled=false;if(this.controls.profileedit_extended){for(var i=0,l=this.controls.profileedit_extended.length;i<l;i++){var extname=this.getParam("ext",this.controls.profileedit_extended[i]);this.controls.profileedit_extended[i].disabled=false}}if(this.auth.authenticated&&this.auth.hasLevel("authors")){this.controls.profileedit_contactname[0].disabled=false;this.controls.profileedit_contactemail[0].disabled=false}this.controls.profileedit_twitterusername[0].disabled=false;this.controls.profileedit_facebookurl[0].disabled=false;this.controls.profileedit_isFacebookFanPage[0].disabled=false;this.controls.profileedit_googleplusurl[0].disabled=false;this.controls.profileedit_submit[0].disabled=false;
this.controls.profileedit_cancel[0].disabled=false;break;case"changepassword":this.controls.changepassword_password[0].disabled=false;this.controls.changepassword_new_password[0].disabled=false;this.controls.changepassword_confirm_password[0].disabled=false;this.controls.changepassword_submit[0].disabled=false;this.controls.changepassword_cancel[0].disabled=false;break;case"deleteuser":this.controls.deleteuser_submit[0].disabled=false;this.controls.deleteuser_cancel[0].disabled=false;break;case"avatarupload":this.controls.avatarupload_file[0].disabled=false;this.controls.avatarupload_submit[0].disabled=false;this.controls.avatarupload_cancel[0].disabled=false;break}},resetWidget:function(params){if(!params){params={except:false,only:false}}else{if(!params.except){params.except=false}if(!params.only){params.only=false}}var mustbreak=params.only?true:false;switch(params.only){default:case"login_form":if(this.controls.login_form&&params.except!=="login_form"){this.controls.login_form[0].reset();this.login_validator.hideErrors();this.controls.login_indicator.hide();this.enableInputs("login")}if(mustbreak){break}case"resetpw_form":if(this.controls.resetpw_form&&params.except!=="resetpw_form"){this.controls.resetpw_form[0].reset();this.resetpw_validator.hideErrors();this.enableInputs("resetpw")}if(mustbreak){break}case"register_form":if(this.controls.register_form&&params.except!=="register_form"){this.controls.register_form[0].reset();this.register_validator.hideErrors();this.enableInputs("register")}if(mustbreak){break}case"subscribe_form":if(this.controls.subscribe_form&&params.except!=="subscribe_form"){this.controls.subscribe_form[0].reset();this.subscribe_validator.hideErrors();this.enableInputs("subscribe")}if(mustbreak){break}case"commentsettings_form":if(this.controls.commentsettings_form&&params.except!=="commentsettings_form"){this.controls.commentsettings_form[0].reset();this.enableInputs("commentsettings")}if(mustbreak){break}case"profileedit_form":if(this.controls.profileedit_form&&params.except!=="profileedit_form"){this.controls.profileedit_form[0].reset();this.enableInputs("profileedit")}if(mustbreak){break}case"avatarupload_form":if(this.controls.avatarupload_form&&params.except!=="avatarupload_form"){this.controls.avatarupload_form[0].reset();this.enableInputs("avatarupload")}if(mustbreak){break}case"changepassword_form":if(this.controls.changepassword_form&&params.except!=="changepassword_form"){this.controls.changepassword_form[0].reset();this.enableInputs("changepassword")}if(mustbreak){break}case"deleteuser_form":if(this.controls.deleteuser_form&&params.except!=="deleteuser_form"){this.controls.deleteuser_form[0].reset();this.enableInputs("deleteuser")}if(mustbreak){break}}},setupProfileForms:function(){if(this.auth.authenticated){if(this.controls.profileedit_form){if(this.feature.isOn(this.feature.POWWOW)&&(this.auth.user.converted===1)){jQuery("#label_profileedit_newUsername").html("Screen name:");jQuery("#profileedit_newUsername_change").find("a").html("(change screen name)");jQuery("#profileedit_newUsername_change_warn").html("(You are only able to change your screen name once.)");jQuery(".validationmessage username_validmsg").html("That screen name is invalid and/or taken.");jQuery("#label_profileedit_displayName").html("Display name:")}this.controls.profileedit_newUsername_text.html(this.auth.user.username);this.controls.profileedit_screenName.html(this.auth.user.smartName);this.controls.profileedit_newUsername.val(this.auth.user.username);this.controls.profileedit_displayname.val(this.auth.user.smartName);this.controls.profileedit_url.val(this.auth.user.url?this.auth.user.url:"");this.controls.profileedit_email.val(this.auth.user.email?this.auth.user.email:"");this.controls.profileedit_aimname.val(this.auth.user.aimname?this.auth.user.aimname:"");if(this.controls.profileedit_extended){for(var i=0,l=this.controls.profileedit_extended.length;i<l;i++){var extname=this.getParam("ext",this.controls.profileedit_extended[i]);this.controls.profileedit_extended.eq(i).val(this.auth.user[extname]?this.auth.user[extname]:"")}}if(this.auth.hasLevel("authors")){this.controls.profileedit_contactname[0].disabled=false;this.controls.profileedit_contactname_panel.show();this.controls.profileedit_contactemail[0].disabled=false;this.controls.profileedit_contactemail_panel.show();this.controls.profileedit_contactname.val(this.auth.user.contactName?this.auth.user.contactName:"");this.controls.profileedit_contactemail.val(this.auth.user.contactEmail?this.auth.user.contactEmail:"")}else{this.controls.profileedit_contactname.val("");this.controls.profileedit_contactemail.val("");this.controls.profileedit_contactname[0].disabled=true;this.controls.profileedit_contactname_panel.hide();this.controls.profileedit_contactemail[0].disabled=true;this.controls.profileedit_contactemail_panel.hide()}this.controls.profileedit_twitterusername.val(this.auth.user.twitterUsername?this.auth.user.twitterUsername:"");this.controls.profileedit_facebookurl.val(this.auth.user.facebookUrl?this.auth.user.facebookUrl:"");
this.controls.profileedit_isFacebookFanPage.attr("checked",this.auth.user.isFacebookFanPage==="true"?true:false);this.controls.profileedit_googleplusurl.val(this.auth.user.googleplusUrl?this.auth.user.googleplusUrl:"");if(this.feature.isOn(this.feature.POWWOW)&&!(this.auth.user.converted===1)){this.controls.filter(".feature_newcomments_newuser").show();this.controls.filter(".feature_newcomments_olduser").hide()}else{this.controls.filter(".feature_newcomments_newuser").hide();this.controls.filter(".feature_newcomments_olduser").show()}}if(this.controls.changepassword_form){this.controls.changepassword_username.val(this.auth.user.username);this.controls.changepassword_id.val(this.auth.user.id);this.controls.changepassword_password.val("");this.controls.changepassword_new_password.val("");this.controls.changepassword_confirm_password.val("")}if(this.controls.deleteuser_form){this.controls.deleteuser_username.val(this.auth.user.username);this.controls.deleteuser_id.val(this.auth.user.id)}if(this.controls.commentsettings_form){if(this.auth.user.commentViewMode&&this.auth.user.commentViewMode=="featured"){this.controls.cvm_hidden[0].checked="false";this.controls.cvm_featured[0].checked="true"}else{this.controls.cvm_featured[0].checked="false";this.controls.cvm_hidden[0].checked="true"}if(this.auth.user.commentRepliesMode&&this.auth.user.commentRepliesMode=="expanded"){this.controls.crm_collapsed[0].checked="false";this.controls.crm_expanded[0].checked="true"}else{this.controls.crm_expanded[0].checked="false";this.controls.crm_collapsed[0].checked="true"}}}}});$.extend($.ui.PresenceWidget,{version:"1.0",defaults:{controlClass:"presence_control",selectors:{},show_validation_errors:true,isReloading:true,loginNeeded:false,facebook_action_url:"/index.php?op=fb",login_action_url:"/index.php?op=ajax_login",logout_action_url:"/index.php?op=ajax_logout",register_action_url:"/index.php?op=register",resetpw_action_url:"/index.php?op=emailpassword",setprofile_action_url:"/index.php?op=setprofile",deleteuser_action_url:"/index.php?op=deleteuser",burner_action_url:"/sso/burner_request",isburner_action_url:"/sso/isBurner",externalElement:".presence_control_external",commenterimage_host_prefix:"http://cache.gawkerassets.com/assets/images/commenter/",commenterimage_host_postfix:"_160.jpg",onLoginRequestSent:function(wg){},onLoginRequestFail:function(wg){},onLoginSuccess:function(wg){if(wg.options.isReloading==true){window.location.reload()}return"will_sync"},onLoginFailure:function(wg){},onLoginPanelShow:function(wg){wg.controls.login_panel.fadeIn(500,function(){wg.syncEffect()});return"will_sync"},onLoginPanelHide:function(wg){wg.controls.login_panel.fadeOut(500,function(){wg.syncEffect()});return"will_sync"},onLogoutRequestSent:function(wg){wg.controls.profile_link.html("Logging out...");wg.controls.logout_panel.hide()},onLogoutRequestFail:function(wg){wg.controls.profile_link.html("Logging out...");wg.controls.logout_panel.hide()},onLogoutSuccess:function(wg){if(wg.options.isReloading==true){window.location.reload()}else{wg.controls.profile_panel.hide();wg.controls.login_panel.show()}},onLogoutFailure:function(wg){Message.showMessage("Logout failed",wg.controls.logout_link[0],{nextMessage:"logout"})},onLogoutPanelShow:function(wg){wg.controls.logout_panel.fadeIn(500,function(){wg.syncEffect()});return"will_sync"},onLogoutPanelHide:function(wg){wg.controls.logout_panel.fadeOut(500,function(){wg.syncEffect()});return"will_sync"},onResetPWRequestSent:function(wg){wg.controls.resetpw_submit[0].value="Resetting..."},onResetPWRequestFail:function(wg){Message.showMessage("Reset failed",wg.controls.resetpw_submit[0],{nextMessage:"Reset"})},onResetPWSuccess:function(wg){Message.showMessage("Password sent",wg.controls.resetpw_submit[0],{nextMessage:"Reset"})},onResetPWFailure:function(wg){Message.showMessage("Reset failed",wg.controls.resetpw_submit[0],{nextMessage:"Reset"})},onResetPWCaptchaFailure:function(wg){Message.showMessage("Reset failed",wg.controls.resetpw_submit[0],{nextMessage:"Reset"});Recaptcha.reload()},onRegisterRequestSent:function(wg){wg.controls.register_submit[0].value="Registering..."},onRegisterRequestFail:function(wg){Message.showMessage("Register failed",wg.controls.register_submit[0],{nextMessage:"Register"})},onRegisterSuccess:function(wg){Message.showMessage("Done",wg.controls.register_submit[0],{nextMessage:"Register"});window.setTimeout(function(){wg.syncEffect()},1000);return"will_sync"},onRegisterFailure:function(wg){Message.showMessage("Register failed",wg.controls.register_submit[0],{nextMessage:"Register"})},onSubscribeRequestSent:function(wg){wg.controls.subscribe_submit[0].value="Subscribing..."},onCommentSettingsRequestSent:function(wg){},onProfileeditRequestSent:function(wg){wg.controls.profileedit_submit[0].value="Saving profile..."},onProfileeditRequestFail:function(wg){Message.showMessage("Profile save failed.",wg.controls.profileedit_submit[0],{nextMessage:"Save profile"})},onProfileeditSuccess:function(wg){Message.showMessage("Done",wg.controls.profileedit_submit[0],{nextMessage:"Save profile"})
},onProfileeditFailure:function(wg){Message.showMessage("Profile save failed.",wg.controls.profileedit_submit[0],{nextMessage:"Save profile"})},onChangepasswordRequestSent:function(wg){wg.controls.changepassword_submit[0].value="Saving password..."},onChangepasswordRequestFail:function(wg){Message.showMessage("Password save failed.",wg.controls.changepassword_submit[0],{nextMessage:"Save"})},onChangepasswordSuccess:function(wg){Message.showMessage("Done",wg.controls.changepassword_submit[0],{nextMessage:"Save"})},onChangepasswordFailure:function(wg){Message.showMessage('<p>To protect your account\'s security, we\'ve locked the ability for this account to change passwords without email authentication.</p><p>To reset your password, please ensure that your email address is up to date in your profile, click the "reset password" link at the top of the page and enter your updated email address.</p><p>If you are still having trouble with your account, please contact us at <a href="mailto:help@gawker.com">help@gawker.com</a></p>',wg.controls.changepassword_submit[0],{nextMessage:"Save",duration:10000})},onDeleteUserRequestSent:function(wg){wg.controls.deleteuser_submit[0].value="Deleting Account..."},onDeleteUserRequestFail:function(wg){Message.showMessage("Account deletion failed.",wg.controls.deleteuser_submit[0],{nextMessage:"Delete Account"})},onDeleteUserSuccess:function(wg){Message.showMessage("Done",wg.controls.changepassword_submit[0],{nextMessage:"Delete Account"})},onDeleteUserFailure:function(wg){Message.showMessage('Account deletion failed. Please contact <a href="mailto:help@gawker.com">help@gawker.com</a>.',wg.controls.deleteuser_submit[0],{nextMessage:"Delete Account",duration:10000})},onAvataruploadRequestSent:function(wg){wg.controls.avatarupload_submit[0].value="Sending image..."},onAvataruploadRequestFail:function(wg){Message.showMessage("Image upload failed.",wg.controls.avatarupload_submit[0],{nextMessage:"upload image"})},onAvataruploadSuccess:function(wg){Message.showMessage("Done",wg.controls.avatarupload_submit[0],{nextMessage:"upload image"})},onAvataruploadFailure:function(wg){Message.showMessage("Image upload failed.",wg.controls.avatarupload_submit[0],{nextMessage:"upload image"})}}})})(jQuery);(function(a){a.widget("ui.RepublishToolWidget",{initialize:function(){this.xhr=new XHR({klass:"republishcontrols",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});var d={};var e=false;if(this.controls.quickpost_dialog){d.quickpost={el:this.controls.quickpost_dialog,focus:this.controls.starinvite_email};e=true}if(this.controls.republish_dialog){d.republish={el:this.controls.republish_dialog,focus:this.controls.siteId};d.edit={el:this.controls.edit_dialog,focus:this.controls.siteId};this.registerEventHandler(this.controls.republish_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.republish_form,"submit",this.republish.bind(this));this.registerEventHandler(this.controls.edit_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.edit_form,"submit",this.edit.bind(this));e=true}if(e){var b={overlay:this.controls.overlay,panels:d,group:this.options.dialoggroup?this.options.dialoggroup:false};this.commondialogs.initDialogs(b)}this.bindDOMHandlers();this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("editorcontrols.loaded",this.loadedEventHandler.bind(this))},bindDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},authEventHandler:function(b){this.setupControls()},setupControls:function(){if(this.auth.hasLevel("authors","highest")&&this.controls.republish_link){this.controls.republish_link.show()}},quickpostOpen:function(){var g=jQuery("h1.headline.title a").html();var b="";jQuery("div.post-body > p:visible").each(function(){if(b.length>0){b+="\n\n"}b+=this.innerHTML.replace(/<span\s+class="pm_byline[^"]*"[^>]*>[\w\W\n\r]*?<\/span>/,"").replace(/<br[^>]*>/ig,"\n").replace(/<[^>]*>/g,"");var h=b.split(/[\s\n\r]+/).length;if(h>100){return false}});while(b.match(/[\r\n]{3,}/g)){b=b.replace(/[\r\n]{2,}/g,"\n\n")}b=b+'\n\n<a href="'+location.href+'">'+g+"</a>";jQuery('.republish_control.cn_quickpost_dialog input[name="title"]').val(g);jQuery('.republish_control.cn_quickpost_dialog input[name="entry"]').val(b);jQuery('.republish_control.cn_quickpost_dialog input[name="url"]').val(location.href);var f=this.controls.quickpostSiteId[0];f.options.length=0;for(var e=0;e<this.options.siteIds.length;e++){if(!this.auth.hasLevel("authors",this.options.siteIds[e])){continue}var d=new Option(this.options.sites[this.options.siteIds[e]],this.options.siteIds[e]);f.options[f.options.length]=d}this.commondialogs.toggleDialog({which:"quickpost"})},quickpostSubmit:function(){var e=this.controls.quickpostSiteId[0];var b=e.options[e.selectedIndex].text;if(jQuery.inArray(b,["deadspin","gizmodo","io9","jalopnik","jezebel","kotaku","lifehacker","sploid"])==-1){b="gawker"
}var d=this.controls.quickpostForm[0];d.action="https://publish."+b+".com/ged/index.php?op=selcont";this.commondialogs.toggleDialog({which:"quickpost"});d.submit()},loadedEventHandler:function(b){this.resetElements();this.setControls();this.bindDOMHandlers();this.setupControls()},handleClick:function(f){var d=this.getParam("cn",f.target);switch(d){case"republish_link":this.setupDialog();this.commondialogs.toggleDialog({which:"republish"});break;case"republish_cancel":this.commondialogs.toggleDialog({which:"republish"});break;case"republish_submit":this.controls.action.val("republish");this.republish();break;case"republish_promote":this.controls.action.val("promote");this.republish();break;case"edit_link":this.controls.postId.val(this.getParam("postId",this.controls.edit_link));var b=jQuery(".editorControlsWidget_external.popup_anchor");this.controls.edit_issued.val(this.getDate(this.getParam("issued",b)));this.controls.edit_pubstatus.val(this.getParam("pubstatus",b));this.commondialogs.toggleDialog({which:"edit"});break;case"edit_cancel":this.commondialogs.toggleDialog({which:"edit"});break;case"quickpostCancel":this.commondialogs.toggleDialog({which:"quickpost"});break;case"quickpostSubmit":this.quickpostSubmit();break;case"quickpost":jQuery("#editorControlsWidget").hide();this.quickpostOpen();break;default:return true}f.stopPropagation();f.preventDefault();return false},handleKeyUp:function(b){switch(b.keyCode){case jQuery.ui.keyCode.ESCAPE:this.commondialogs.toggleDialog();break}},handleAjaxRequest:function(){this.disableForm(true)},handleAjaxSuccess:function(b){if(b.success){this.controls.progress.hide();this.disableForm(false);var d=b.message;if(b.gedUrl!==undefined){d+=' View in <a href="'+b.gedUrl+'" target="_blank">GED</a>'}jQuery(".cn_republish_dialog button").toggleClass("hidden");this.showMessage(d,false,b.action=="edit"?"edit":"republish",true)}else{this.controls.progress.hide();this.disableForm(false);jQuery(".cn_republish_dialog button").toggleClass("hidden");this.showMessage(b.message,false,b.action=="edit"?"edit":"republish",true)}},handleAjaxFail:function(){this.controls.progress.hide();this.disableForm(false);this.showMessage("<b>Cannot republish the post.</b> Please try again later",false)},setupDialog:function(){var b=this.controls.siteId.get(0);for(var e=b.options.length;e>0;e--){b.options[0]=null}for(e=0;e<this.options.siteIds.length;e++){var g=this.options.siteIds[e];if(!this.auth.hasLevel("authors",g)){continue}opt=new Option(this.options.sites[g],g);b.add(opt,null)}var f=new Date();this.controls.postId.val(this.getParam("postId",this.controls.republish_link.get(0)));var d=jQuery(".editorControlsWidget_external.popup_anchor");this.controls.republish_issued.val(this.getDate(this.getParam("issued",d)));if(jQuery(".cn_republish_submit.hidden").length>0){jQuery(".cn_republish_dialog button").toggleClass("hidden")}},getDate:function(e){var d=new Date();var b=function(f){return(f<10?"0":"")+f};d.setTime(e*1000);return d.getFullYear()+"-"+b(d.getMonth()+1)+"-"+b(d.getDate())+" "+b(d.getHours())+":"+b(d.getMinutes())+":"+b(d.getSeconds())},republish:function(f){siteId=this.controls.siteId.val();site=this.options.sites[siteId];if(jQuery.inArray(site,["deadspin","gizmodo","io9","jalopnik","jezebel","kotaku","lifehacker","sploid"])==-1){site="gawker"}if(f!==undefined){f.stopPropagation();f.preventDefault()}if(this.controls.siteId.val()>0){var d=this.controls.republish_form.serialize()+"&pipeJsonP=?";var b="https://publish."+site+".com/ged/index.php?"+d;this.xhr.getJsonOwn(b);this.controls.progress.show()}else{this.showMessage("Please select site")}return false},edit:function(b){if(b!==undefined){b.stopPropagation();b.preventDefault()}this.xhr.send("/index.php",this.controls.edit_form.serialize());this.controls.progress.show()},disableForm:function(b){var d=(b==true);this.controls.siteId.get(0).disabled=d;this.controls.republish_issued.get(0).disabled=d;this.controls.republish_submit.get(0).disabled=d;this.controls.republish_cancel.get(0).disabled=d;this.controls.edit_issued.get(0).disabled=d;this.controls.edit_pubstatus.get(0).disabled=d;this.controls.edit_submit.get(0).disabled=d;this.controls.edit_cancel.get(0).disabled=d},showMessage:function(e,b,f,h){var d=this;this.controls.message.html(e).show();if(f===undefined){f="republish"}if(h===undefined){h=false}var g=function(){if(!h){d.controls.message.hide()}if(b){d.commondialogs.toggleDialog({which:f})}};setTimeout(g,3000)}});a.extend(a.ui.RepublishToolWidget,{version:"1.0",defaults:{controlClass:"republish_control",externalElement:".presence_control_external, .republish_external",show_validation_errors:true}})})(jQuery);var spongedebug;(function(a){a.widget("ui.RightBarWidget",{initialize:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.subscribeForEvent("rightbar.",this.rightbarEventHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.postLoadedHandler.bind(this));this.subscribeForEvent("navigation.load",this.rightbarEventHandlerLoad.bind(this));
this.subscribeForEvent("navigation.searchInitiated",this.rightbarEventHandlerLoad.bind(this));this.subscribeForEvent("navigation.loaded",this.rightbarEventHandlerLoaded.bind(this));this.subscribeForEvent("notification.loaded",this.rightbarEventHandlerLoaded.bind(this));this.subscribeForEvent("maincontent.interstitialLoaded",this.rightbarEventHandlerLoad.bind(this));this.subscribeForEvent("maincontent.interstitialHidden",this.rightbarEventHandlerLoad.bind(this));this.subscribeForEvent("threads.listloaded",this.resizeStaticSidebar.bind(this));this.mouseOverRightbar=false;this.keyboardNavigationActive=true;var e=new Date();this.lastKeystroke=e.getTime();this.currentPostId=-1;this.nextPostId=-1;this.checkListLengthTimeout=null;this.resize_timer=null;this.customSearchUrl=undefined;this.spongesettings={retries:10,interval:1};this.initAirportIterator();this.de={pane:jQuery("#pane"),rightcontainer:jQuery("#rightcontainer"),rightbar_list:jQuery(jQuery(".rightbar_list")[0]),rightbar_scroller:jQuery("#rightbar_scroller"),list_bottom:jQuery("#list-bottom"),nextheadlines:jQuery("#rightbar_nextheadlines"),date:jQuery("#date-nav .date"),pin_container:jQuery("#rightbar_pin_container")};this.de.posts=this.de.rightbar_list.children(".post");var b=this;jQuery(this.de.rightcontainer).bind("mouseenter",function(d){b.mouseOverRightbar=true});jQuery(this.de.rightcontainer).bind("mouseleave",function(d){b.mouseOverRightbar=false});jQuery(document).bind("keydown",function(d){b.keyboardNavigationHandler(d)});this.de.rightbar_scroller.height(this.de.rightcontainer.height()-this.de.rightbar_scroller.offset().top+jQuery(window).scrollTop());jQuery(window).resize(function(){if(!b.staticStyle){b.de.rightbar_scroller.height(b.de.rightcontainer.height()-b.de.rightbar_scroller.offset().top+jQuery(window).scrollTop());b.setOverlay(true)}});this.xhr=new XHR({klass:"rightbar",success:this.handleAjaxSuccess.bind(this)});var f=this;this.de.rightbar_scroller.scroll(function(d){adRobot.rightBarFixer.fix();window.clearTimeout(this.checkListLengthTimeout);this.checkListLengthTimeout=window.setTimeout(function(){this.checkListLength()}.bind(this),200)}.bind(this));this.de.rightbar_scroller.scroll(jQuery.debounce(500,jQuery.proxy(function(){if(this.currentParams.mode==="latest"){this.updateDate()}},this)));this.setPinned(false);this.resetPaging();this.updateContent();this.setDropdown();jQuery(".webkit #rightcontainer").mouseenter(function(){jQuery("#hidescroll").fadeOut(100)});jQuery(".webkit #rightcontainer").mouseleave(function(){jQuery("#hidescroll").fadeIn(500)});if(typeof sponge_client!=="undefined"){if(!this.sponge){this.sponge=jQuery("#date-nav .chartbeat").spongeclient(sponge_client).data("spongeclient");spongedebug=this.sponge}}},initAirportIterator:function(){this.airiterator=0;this.tid=setTimeout(jQuery.proxy(this.airportDisplayChange,this),5000);jQuery(".rightbar_list .airport").live("click",jQuery.proxy(this.airportDisplayChange,this))},postLoadedHandler:function(b){this.currentPostId=b.params.data.id;if(!this.setCurrentItem(this.currentPostId)){this.currentPostId=-1}this.updateContent();if(this.staticStyle===true){this.staticScroller()}},keyboardNavigationFinished:function(){var f=new Date();if(this.lastKeystroke<f.getTime()-950&&this.nextPostId!=-1){var b=this.nextPostId;this.nextPostId=-1;var e=decodeURIComponent(this.de.posts.filter(".postid_"+b).find("a.headline, span.headline a").eq(0).attr("href"));if(e!==null&&e){this.raiseEvent("navigation.load",{href:e})}}},keyboardNavigationHandler:function(k){var h=k.target.tagName.toLowerCase(),g=null;if(this.keyboardNavigationActive===false||h=="input"||h=="textarea"){return}if(k.altKey||k.ctrlKey||k.shiftKey||k.metaKey){return}if(k.which==75||(this.mouseOverRightbar&&k.which==37)){g=false;k.preventDefault();k.stopPropagation()}else{if(k.which==74||(this.mouseOverRightbar&&k.which==39)){g=true;k.preventDefault();k.stopPropagation()}}if(g!==null){var f=this.de.postsWithoutQuicklinks.filter(".current");var m=this.de.postsWithoutQuicklinks.index(f);var b=null;if(m>=0){if(g){b=this.de.postsWithoutQuicklinks.eq((m<this.de.postsWithoutQuicklinks.length-1)?(m+1):(this.de.postsWithoutQuicklinks.length-1))}else{b=this.de.postsWithoutQuicklinks.eq(m>0?m-1:0)}}else{b=jQuery(this.de.postsWithoutQuicklinks[0])}if(b.length===0){b=null}if(b!==null){var l=new Date();this.lastKeystroke=l.getTime();this.nextPostId=this.getParam("postid",b);this.setCurrentItem(this.nextPostId,true,true);var j=this;window.setTimeout(function(){j.keyboardNavigationFinished()},1000)}}},resetPaging:function(){this.paging={};this.pageTypes={}},setDropdown:function(){this.dropdown=jQuery("#sidebarmode").modeDropdown()},setPinned:function(b){var d=false;if(b){d=!jQuery("#rightwrapper").hasClass("staticstyle")}else{d=(jQuery.cookie("gawkermedia_rightbar")=="staticstyle")}if(d){this.sidebarToStatic()}else{this.sidebarToDefault()}},sidebarToStatic:function(b){jQuery("#rightwrapper").addClass("staticstyle");this.staticStyle=true;jQuery("a.cn_pager.upper").hide();
this.topPagerShown=false;jQuery.cookie("gawkermedia_rightbar",null,{expires:-1,path:"/"});jQuery.cookie("gawkermedia_rightbar","staticstyle",{expires:3650,domain:document.location.host,path:"/"});this.resizeStaticSidebar();this.staticScroller()},sidebarToDefault:function(){jQuery("#rightwrapper").removeClass("staticstyle");this.staticStyle=false;jQuery.cookie("gawkermedia_rightbar",null,{expires:-1,path:"/"});jQuery.cookie("gawkermedia_rightbar","",{expires:3650,domain:document.location.host,path:"/"});this.checkListLength()},resizeStaticSidebar:function(){if(!this.staticStyle){return false}if(this.resize_timer!==null){clearTimeout(this.resize_timer)}this.resize_timer=setTimeout(jQuery.proxy(function(){var b=parseInt(jQuery("#container").height(),10);if(b>3600){b=3600}this.de.rightbar_scroller.height(b);this.resize_timer=null;this.checkListLength()},this),1000)},calculateRightbarParams:function(b){b=b.replace(/^[\/ ]*|[\/ ]*$/g,"");var g=this;var f={};var h={latest:function(){if(window.location.search.match(/\b(popular|commented)=true/)){return false}if(b=="!!latest"){f.forceReload=true;b="!latest";g.newPostsLoading=true}if(b===""||b=="!latest"){f.jsonP="latest";return true}sortmatch=window.location.search.match(/(&|\?)abc=(asc|desc)(&|$)/);if(sortmatch){f.sort="abc";f.sortDir=sortmatch[2]}if(b.match(/^[0-9]{5,}/)){if(window.location.search.length>0&&location.search.match(/\btag=/)!==null){return}var p=jQuery(".postContainer");if(p.length>0){var k=g.getParam("issued",p)*1000;var j=(new Date()).getTime();var r=(j-k)/86400000;if(r<30){var q=g.options.daySpan*86400000;var n=Math.floor(g.options.currentTime/q)*q;var l=Math.floor(k/q)*q;if(n!=l){f.page=Math.round(l/1000)}}else{return false}}f.jsonP="latest";return true}var o=["people","communitypolicy","ccs"];for(var m=0;m<o.length;m++){if(b.indexOf(o[m])===0&&b.length==o[m].length){f.jsonP="latest";return true}}return false},popular:function(){if(b=="!commented"||b=="!latest"){return false}if(b.match(/^[0-9]{5,}/)&&jQuery(".postContainer").length>0&&!window.location.search.match(/\bcommented=true/)){if(location.search.length>0&&location.search.match(/tag=/)!==null){return}f.jsonP="popular";return true}if(b=="!popular"||b.match(/(.*)\/forum$/)||b=="me"||b.match(/^me\//)||b.match(/^people\//)||window.location.search.match(/\bpopular=true/)){f.jsonP="popular";return true}if(b.indexOf("advertisement")===0){return false}var j=["about","classic","advertisement"];for(var k=0;k<j.length;k++){if(b.indexOf(j[k])===0){f.jsonP="popular";return true}}return false},commented:function(){if(b=="!commented"||window.location.search.match(/\bcommented=true/)){f.jsonP="commented";return true}return false},search:function(){var j=b.match(/^search\/(.*?)(?:\/([^\/]+)\/([^\/]+))?$/);if(j===null){return false}f.jsonP=undefined;f.q=decodeURIComponent(j[1]);f.filter=decodeURIComponent(j[2]);f.sort=decodeURIComponent(j[3]);return true},tagpage:function(){if(typeof window.pinnedPost!="undefined"){f.pinnedPost=window.pinnedPost}var k=window.location.search.match(/[\?$]site=([a-z]+)/);if(k){f.site=k[1]}if(b.match(/^[0-9]{5,}/)){if(window.location.search.length>0){var k=window.location.search.match(/\btag=([A-Za-z0-9-\/\.:]+)/);if(k!==null){f.jsonP="tagpage";f.tags=k[1].split("/");return true}}return false}if(b.length>0){f.jsonP="tagpage";b=b.replace(/^([a-zA-Z0-9]+)\/[0-9]{5,}/,"$1");var j=b.split("/");for(var l=0;l<j.length;l++){f.jsonP+="_"+(j[l]+"").replace(/[^A-Za-z0=0]/g,"")}f.tags=j;return true}return false}};var e=["latest","popular","commented","search","tagpage"];for(var d=0;d<e.length;d++){if(h[e[d]]()){f.mode=e[d];break}}if(f.mode===undefined){return false}return f},setCurrentPost:function(e){var d=e.match(/^\/([0-9]{5,})/);if(d!==null){var b=d[1];var g=this.de.posts.filter(".postid_"+b);if(g.length>0){var f=decodeURIComponent(g.find("a.headline, span.headline a").eq(0).attr("href"));if(f.indexOf(e)>=0){this.setCurrentItem(b);return}}}},updateContent:function(g,o,e){if(o===undefined){if(this.customSearchUrl!==undefined){o=this.customSearchUrl}else{o=null}}if(e===undefined){e=-1}var t=null;if(g===undefined||g===0){var f="";g=0;if(o===null){f=window.location.pathname;this.setCurrentPost(f)}else{f=o}var u=this.calculateRightbarParams(f);if(u===false){return}if(u.page!==undefined){t=u.page;u.page=undefined}var v=false;if(typeof u.forceReload!=="undefined"){v=true;u.forceReload=undefined}var n="";for(var s in u){if(u.hasOwnProperty(s)){if(typeof(u[s])=="function"||u[s]===undefined||s=="jsonP"){continue}if(jQuery.isArray(u[s])){for(var r=0;r<u[s].length;r++){n+="&"+s+"[]="+encodeURIComponent(u[s][r])}}else{n+="&"+s+"="+encodeURIComponent(u[s])}}}if(this.currentUrl===undefined||this.currentUrl!=n||v){this.currentParams=u;this.currentUrl=n;this.resetPaging()}else{return false}}if(typeof this.currentParams=="undefined"){return false}var p=this.currentUrl;var h=this.currentParams.jsonP;if(g===0){var l=this.getUrlParams();if(typeof l.sponsor_preview!=="undefined"){p+="&sponsor_preview="+encodeURIComponent(l.sponsor_preview)
}if(t!==null){p+="&page="+t}}else{if(g>0){g=1;if(this.paging.next===undefined){return}p+="&page="+this.paging.next;t=this.paging.next;this.paging.next=undefined}else{g=-1;if(this.paging.prev===undefined){return}p+="&page="+this.paging.prev;t=this.paging.prev;this.paging.prev=undefined}}if(typeof this.currentParams.tags!="undefined"&&this.currentParams.tags.length&&this.currentParams.sort=="abc"){p+="&abc="+this.currentParams.sortDir}var k="";if(this.options.remoteHost!==undefined&&this.options.remoteHost!==""){k=this.options.remoteHost}else{k=window.location.host}var j=encodeURIComponent(decodeURIComponent(p));this.pageTypes[j]=g;p+="&fingerprint="+j;p="http://"+k+"/index.php?op=ajax_rightbar"+p+"&pipeJsonP=?";if(h!==undefined&&t!==null){h+="_"+(t+"").replace(/[^A-Za-z0-9]/g,"")}var m="http://"+k+"/static/sidebar/"+this.options.siteDomain+"/";if(this.currentParams.mode=="latest"){if(t){var b=Math.round(((new Date()).getTime()/1000-t)/86400);if(b<20){p=m+"latest/"+t+".js"}}else{if(typeof l.sponsor_preview=="undefined"){p=m+"latest.js"}}}if(this.currentParams.mode=="popular"){p=m+"popular.js"}else{if(this.currentParams.mode=="commented"){p=m+"commented.js"}}this.xhr.getJsonOwn(p,h);var q=this.de.rightbar_list;var d='<li class="rightbarSpinnerContainer %CLASS%">'+jQuery("#rightbarspinner").html()+"</li>";if(g>0){q.append(d.replace("%CLASS%","append"));jQuery(".rightbarlistspinner",q).spin("small");jQuery("#pane").css("margin-bottom","0")}else{if(g<0){q.prepend(d.replace("%CLASS%","prepend"));jQuery(".rightbarlistspinner",q).spin("small");jQuery("#pane").css("margin-bottom","0")}else{this.setOverlay(false);jQuery("#rightbarSpinnerOverlay").show();jQuery("#rightbarSpinnerOverlay").spin("small");jQuery("#pane").css("margin-bottom","0")}}if(this.staticStyle===true){f=window.location.pathname;this.setCurrentPost(f);this.staticScroller()}},setOverlay:function(e){var b="";if(e){b=":visible"}var d=jQuery("#rightbarSpinnerOverlay"+b);if(d.length===0){return}var f=this.de.pane.width()+10;d.css({height:this.de.rightbar_scroller.height()+"px",width:f+"px"})},setNextPost:function(){var e=this.de.posts;var j=e.filter(".current").eq(0).next("div.post");if(j.length===0){j=e.eq(0)}if(j.length===0){return}var d=jQuery("a.headline",j);var f=jQuery(".selector_tag",j);var b=d.attr("href");if(jQuery("span.item",d).length>0){d=jQuery("span.item",d)}var h='<span class="modfont">'+f.text()+"</span>&nbsp;&ndash;&nbsp;"+d.text();var g=jQuery("#hoveringNextPost");g.attr("href",b);g.find("span.headline").html(h).textOverflow();jQuery("#hoveringNextPostContainer").show()},parseList:function(e){if(e.loadPostHref!==undefined){this.raiseEvent("navigation.load",{href:e.loadPostHref})}var b=null;e.pageType=this.pageTypes[e.fingerprint];if(this.pageTypes[e.fingerprint]===undefined){return}this.pageTypes[e.fingerprint]=undefined;if(e.pageType>0){b=this.de.rightbar_list.find(".rightbarSpinnerContainer.append")}else{if(e.pageType<0){b=this.de.rightbar_list.find(".rightbarSpinnerContainer.prepend")}else{b=jQuery("#rightbarSpinnerOverlay")}}if(e.success===false){if(b!==null){b.spin(false);jQuery("#pane").css("margin-bottom","34px");b.hide()}return}if(e.pageType>=0){if(e.paging.next!==undefined){this.paging.next=e.paging.next}else{this.paging.next=undefined}}if(e.pageType<=0){if(e.paging.prev!==undefined){this.paging.prev=e.paging.prev}else{this.paging.prev=undefined}}var d=this.de.rightbar_list;if(e.pageType===0){d.html(e.content);var f=this;if(this.staticStyle===true){this.staticScroller()}else{this.de.rightbar_scroller.scrollTop(0)}if(e.mode=="popular"){this.dropdown.modeDropdown("set","popular");this.de.date.hide();this.showSponge();this.airportDisplayChange({},"uniques")}else{if(e.mode=="commented"){this.dropdown.modeDropdown("set","commented");this.de.date.hide();this.showSponge();this.airportDisplayChange({},"comments")}else{this.de.date.show();this.hideSponge();this.resetDate();this.airportDisplayChange({})}}this.raiseEvent("rightbar.loaded",e)}else{if(e.pageType>0){if(e.content!==undefined){d.append(e.content)}this.stopScrolling=false}else{if(e.content!==undefined){this.addContentBefore(e.content)}}}if(this.currentPostId!=-1&&!this.setCurrentItem(this.currentPostId)){this.currentPostId=-1}this.de.posts=this.de.rightbar_list.children(".post");if(this.browser=="ie"){this.de.rightbar_list.show()}else{this.de.rightbar_list.fadeTo(200,1)}if(e.mode!=="commented"){if(b!==null){b.spin(false);jQuery("#pane").css("margin-bottom","34px");b.hide()}}else{this.toHideAfterSponge=b}if(e.mode=="latest"){this.displaySponsoredPost();this.displayOldSponsoredPosts()}this.de.posts=this.de.rightbar_list.children(".post");this.de.postsWithoutQuicklinks=this.de.posts.filter(":not(.quicklink)");this.loadSpongeStats();this.checkListLength();this.raiseEvent("rightbar.contentUpdated",{})},displayOldSponsoredPosts:function(){var l=this.de.posts;var b=jQuery("#sponsored_posts");var n=b.children("li");var e=0;var k=0;var g=false;var d=false;var m=new Date().getTime();var f=0;
for(var h=0;(h<n.length)&&(f<l.length);h++){e=this.getParam("promoted",n[h])*1000;k=this.getParam("issued",n[h]);if(e<m){g=false;do{d=this.getParam("issued",l[f]);if((d<k)&&!jQuery(l[f]).hasClass("sponsored")){this.insertSponsoredPost(n.eq(h),l[f]);g=true}f++}while(!g&&f<l.length)}}},enableThumb:function(b){img=b.find("img").eq(0);if(!img.attr("src")&&(img.data("src")!=undefined)){img.attr("src",img.data("src"))}return b},insertSponsoredPost:function(g,f){this.enableThumb(g);g.remove().insertBefore(f);try{var b=g.find(".ad_tracker-rightbar-sp .ad_container").eq(0).attr("id").replace("ad_container_","");if(b){adRobot.runAdFromQueue(b)}}catch(d){}},displaySponsoredPost:function(){var m=this.de.posts;var b=jQuery("#sponsored_posts");var p=b.children("li");var f=null;if(this.sponsored_displayed||m.length<3){return false}var e=this.getUrlParams();if(e.sponsor_preview!==undefined){if(p[0]!==undefined){this.insertSponsoredPost(p.eq(0),m[3])}}else{var o=[];var q={ids:[],positions:{}};var r=false;var l=jQuery.cookie("rightbar_sponsored_posts_seen_v2");if(l){l=jQuery.secureEvalJSON(l)}else{l={ids:[],positions:{}}}for(var h=0;h<p.length;h++){o[h]=this.getParam("postid",p[h]);f=this.getParam("promoted",p[h])*1000;var n=new Date().getTime();if(l.ids.indexOf(o[h])==-1&&r===false&&f>n){r=h}}var d=null,g=null;for(g=0,h=0;h<l.ids.length;h++){d=l.ids[h];if(o.indexOf(d)!=-1){q.ids[g++]=d;q.positions["id_"+d]=l.positions["id_"+d];var j=this.de.rightbar_list.children(".postid_"+l.positions["id_"+d]);this.insertSponsoredPost(p.filter(".postid_"+d),j)}}if(r!==false){for(h=0;h<7&&!this.de.rightbar_list.children("div").eq(h).hasClass("sponsored");h++){}if(h==7){q.ids[g]=o[r];q.positions["id_"+o[r]]=this.getParam("postid",m[3]);this.insertSponsoredPost(p.eq(r),m[3])}}jQuery.cookie("rightbar_sponsored_posts_seen_v2",jQuery.toJSON(q),{path:"/"})}this.sponsored_displayed=true},addContentBefore:function(g){var f=this.de.rightcontainer.find(".rightbar_list_helper");f.html(g);var b=f.height();var d=0;try{d=parseInt(this.de.rightbar_list.css("top"),10)}catch(h){}if(isNaN(d)){d=0}this.de.rightbar_list.prepend(g);f.empty();this.de.rightbar_scroller.scrollTop(b)},handleClick:function(l){var k=jQuery(l.target);var f=this.getParam("cn",k);if(f=="prevDay"||f=="nextDay"){if(f=="nextDay"){this.date.setDate(this.date.getDate()+1)}else{this.date.setDate(this.date.getDate()-1)}this.loadOtherDay(f=="prevDay");l.preventDefault();l.stopPropagation()}else{if(f=="prevpage"||f=="nextpage"){this.doPaging(f=="prevpage");l.preventDefault();l.stopPropagation()}else{if(f=="search_open"){jQuery("#top_search_control").toggle();this.de.rightbar_scroller.animate({scrollTop:0},"fast");if(jQuery("#top_search_control:visible").length===0){this.updateContent()}this.de.rightcontainer.find("#switch_search").toggleClass("selected");l.preventDefault();l.stopPropagation()}else{if(f=="hdpreview"){var d=window.location.href.replace(/([\?&])(hd|ie9preview)(&|$|(=[^&]*))/i,"$1").replace(/&&/,"&").replace(/\?&/,"?").replace(/\?$/,"");d+=(d.match(/\?/)?"&":"?")+"hd";window.location.href=d;l.preventDefault();l.stopPropagation()}else{if(f=="nextpost"){try{var b=this.de.posts.filter(".current").next();if(b.length===0){b=this.de.posts.filter(".post").eq(0)}if(b.length===0){l.preventDefault();l.stopPropagation();return false}var h=jQuery("a.cn_link:not(.tag)",b).attr("href");if(h){this.raiseEvent("navigation.load",{href:h})}l.preventDefault();l.stopPropagation()}catch(g){}}else{if(f=="pin"){this.setPinned(true);l.preventDefault();l.stopPropagation()}else{if(f=="eye"){this.addEyeDropdownClick();l.preventDefault();l.stopPropagation()}else{if(f=="onepane"){this.sidebarToStatic();jQuery("#rightbar_pin_container ul").hide();l.preventDefault();l.stopPropagation()}else{if(f=="twopane"){this.sidebarToDefault();jQuery("#rightbar_pin_container ul").hide();l.preventDefault();l.stopPropagation()}else{if(f=="home"){jQuery("#top_search_control").hide();this.de.rightbar_scroller.animate({scrollTop:0},"fast");if(typeof history.pushState!=="undefined"){href=window.location.href.split("?",1)[0];history.pushState(href,document.title,href)}this.customSearchUrl=undefined;this.updateContent(0,"!latest");l.preventDefault();l.stopPropagation()}else{if(f=="title"){var j=jQuery(this.de.posts[0]);this.setCurrentItem(this.getParam("postid",firstpost));this.raiseEvent("navigation.load",{href:j.find("a.cn_link").attr("href")});l.preventDefault();l.stopPropagation()}else{if(f=="popular"){jQuery("#top_search_control").hide();this.de.rightbar_scroller.animate({scrollTop:0},"fast");this.customSearchUrl=undefined;this.updateContent(0,"!popular",0);l.preventDefault();l.stopPropagation()}else{if(f=="commented"){jQuery("#top_search_control").hide();this.de.rightbar_scroller.animate({scrollTop:0},"fast");this.customSearchUrl=undefined;this.updateContent(0,"!commented",0);l.preventDefault();l.stopPropagation()}else{if(f=="pager"){this.pagerClicked(l.target);l.preventDefault();l.stopPropagation()}else{if(f=="newstory"){jQuery("#top_search_control").hide();
this.de.rightbar_scroller.animate({scrollTop:0},"fast");this.customSearchUrl=undefined;jQuery(".newstory").slideUp("500");this.updateContent(0,"!!latest");this.sponge.refreshLatestPost();this.dropdown.modeDropdown("set","latest");l.preventDefault();l.stopPropagation()}}}}}}}}}}}}}}}},rightbarEventHandler:function(f){var b=f.name;var d;switch(b){case"rightbar.suspendNavigation":this.keyboardNavigationActive=false;break;case"rightbar.resumeNavigation":this.keyboardNavigationActive=true;break;case"rightbar.contentUpdated":if(this.newPostsLoading&&this.sponge.latestPostId){d=jQuery(".postid_"+this.sponge.latestPostId).prevAll(".post");if(d.length>0){d.addClass("hot highlighted").delay(3000).queue(function(){d.removeClass("highlighted")});this.newPostsLoading=false}}break;case"rightbar.innercontentchange":break}},rightbarEventHandlerLoad:function(d){interstitial_abort();var b=d.name;switch(b){case"navigation.load":this.currentPostId=-1;break;case"navigation.searchInitiated":trackers.trackSearch();if(this.loadSearch(d.params)==false){d.params.nochange=true;this.raiseEvent("searchform.searchFinished",d.params)}break;case"maincontent.interstitialLoaded":this.loadInterstitial(d);break;case"maincontent.interstitialHidden":this.hideInterstitial(d);break}},rightbarEventHandlerLoaded:function(b){if(b.name=="notification.loaded"){this.addContentBefore(b.params.data);this.de.rightbar_scroller.scrollTo(0,500);this.setControls()}else{this.updateContent();if(this.browser=="ie"){this.de.rightbar_list.show()}else{this.de.rightbar_list.fadeTo(200,1)}}this.resizeStaticSidebar()},handleAjaxSuccess:function(d){var e=this;if(d.action=="rightbar"){this.de.rightcontainer.find(".tool").removeClass("selected");if(d.mode==="latest"){this.de.rightcontainer.find(".tools .home").addClass("selected")}else{this.de.rightcontainer.find(".tools ."+d.mode).addClass("selected")}for(var b=0;b<d.extras.length;b++){if(d.extras[b].type==="search"){if(d.success){this.raiseEvent("searchform.searchFinished",d.extras[b])}else{this.raiseEvent("searchform.searchFailed",d.extras[b])}d.success=(d.extras[b].results>0)}}this.parseList(d)}},resetControls:function(){this.setControls()},loadSearch:function(b){this.customSearchUrl="search/"+encodeURIComponent(b.q)+"/"+encodeURIComponent(b.filter)+"/"+encodeURIComponent(b.sort);return this.updateContent(0,this.customSearchUrl)},loadOtherDay:function(b){this.doPaging(!b)},loadInterstitial:function(g){var f=this.de.posts.filter(".postid_"+g.params.data.id);var b=f.find("a.rightBarControl").attr("href");var d='<div title="Advertisement" class="post postid_'+Math.floor(Math.random()*100000001)+" siteid_ issued_ visibleItem interstitial interstitial_"+g.params.data.id+' site-bg-color"></div>';if(this.browser=="ie"){f.before(d).show()}else{f.before(d).fadeIn("fast")}f.removeClass("current").addClass("post_interstitial")},hideInterstitial:function(d){var b=this.de.rightcontainer.find(".interstitial_"+d.params.data.id);if(this.browser=="ie"){b.hide();a(this).remove()}else{b.fadeOut("fast",function(){a(this).remove()})}b.addClass("current")},checkListLength:function(){var b=0;var d=0;if(this.staticStyle===true){b=jQuery("ul.rightbar_list").height()-this.de.rightbar_scroller.height();if(parseInt(jQuery("#container").height(),10)>jQuery("div#pane").height()+200||b<0){d=1}}else{var e=this.de.rightbar_scroller.scrollTop();if(e==0){if(this.topPagerShown===undefined||this.topPagerShown===true){this.topPagerShown=false;jQuery("a.cn_pager.upper").hide()}}b=this.de.rightbar_scroller[0].scrollHeight-e-this.de.rightbar_scroller.height();if(b<Math.max(200,Math.min(3000,Math.floor(this.de.rightbar_scroller[0].scrollHeight/3)))){d=1}else{if(e<200){d=-1}}}jQuery("a.cn_pager.lower").toggle(b>10);if(d==1){this.updateContent(1)}else{if(d==-1){this.updateContent(-1)}}},doPaging:function(e){if(e===undefined){e=false}var d=this.de.rightbar_scroller.height();var b=this.de.rightbar_scroller.scrollTop();if(e){this.de.rightbar_scroller.animate({scrollTop:(b-d)},"fast")}else{this.de.rightbar_scroller.animate({scrollTop:(b+d)},"fast")}},setCurrentItem:function(e,f,g){var m=this.de.posts;m.filter(".current").removeClass("current ui-border ui-shade");if(f===undefined){f=true}if(e>0){var l=m.filter(".postid_"+e);if(l.length>0){m.filter(".interstitial").remove();if(f){l.addClass("current ui-border ui-shade")}if(this.options.autoScroll||g){var b=l.offset().top+l.height()-this.de.rightbar_scroller.offset().top;var h=l.offset().top-this.de.rightbar_scroller.offset().top;if(b>this.de.rightbar_scroller.height()||h<0){var j=this;var d=this.de.posts.index(l);var k=this.de.posts.eq(d>0?d-1:0);this.de.rightbar_scroller.scrollTo(k,"fast",{onAfter:function(){j.checkListLength()}})}}return true}}else{m.filter("current").removeClass("current");if(this.options.autoScroll||g){var j=this;this.de.rightbar_scroller.scrollTo(0,"fast",{onAfter:function(){j.checkListLength()}})}}return false},pagerClicked:function(d){d=jQuery(d);if(this.staticStyle===true){if(d.hasClass("upper")){this.de.rightbar_scroller.scrollTo(0);
d.hide()}else{if(d.hasClass("lower")){this.de.rightbar_scroller.height(this.de.rightbar_scroller.height()+jQuery(window).height()-(this.de.rightcontainer.find(".cn_pager.lower").height()*3))}}}else{var h=true;var f=null;var b=null;if(d.hasClass("upper")){h=false;f=d;b=jQuery("a.cn_pager.lower")}else{f=jQuery("a.cn_pager.upper");b=d}var j=this.de.rightbar_scroller.scrollTop();var e=b.offset().top-(f.offset().top+f.height());var g=j+(h?1:-1)*e;if(g<=0){g=0}this.de.rightbar_scroller.scrollTop(g)}this.checkListLength()},hideInactiveTags:function(){var b=this.getParam("tag",jQuery(".rightbar_list"));if(typeof b!="undefined"){jQuery(".rightbar_list :not(.taglink:contains('"+b+"'))").fadeTo("slow","0.3")}},airportDisplayChange:function(b,e){clearTimeout(this.tid);var d=[];if(e===undefined){if(jQuery("#pane .airport.views").length>0){d=["views"]}if(jQuery("#pane .airport.uniques").length>0){d.push("uniques")}if(jQuery("#pane .airport.date").length>0){d.push("date")}if(jQuery("#pane .airport.comments").length>0){d.push("comments")}if(jQuery("#pane .airport.timestamp").length>0){d.push("timestamp")}}else{d.push(e)}jQuery("#pane .airport").hide();jQuery("#pane .airport."+d[(this.airiterator%d.length)]).show();this.airiterator++;if(this.currentParams.mode!=="popular"&&this.currentParams.mode!=="commented"){this.tid=setTimeout(jQuery.proxy(this.airportDisplayChange,this),5000)}else{clearTimeout(this.tid)}},staticScroller:function(){var d=jQuery(".postid_"+this.currentPostId,this.de.rightbar_list);if(d.length>0){this.de.rightbar_scroller.scrollTo(d);if(!jQuery(".rightbar_list .post:first").hasClass("postid_"+this.currentPostId)){var b=jQuery("a.cn_pager.upper");this.topPagerShown=true;b.show();this.de.rightbar_scroller.scrollTo("-="+(parseInt(b.height(),10)+6)+"px")}}},updateDate:function(){if(!this.presentDate){this.presentDate=this.de.date.html()}var f=this.de.rightbar_list.find(".date-separator"),e=this.de.rightbar_scroller.offset().top;for(var d=0;d<f.length;d++){if(jQuery(f[d]).offset().top>e){break}}if(d>0){var b=jQuery(f[d-1]).find(".date").html();b=b.replace(/(\w+, )(\w{3})\w+/,"$1$2");this.de.date.html(b)}else{this.resetDate()}},resetDate:function(){if(this.presentDate){this.de.date.html(this.presentDate)}},getStatlessPostUrls:function(){var f=[],e;for(var d=0,b=this.de.posts.length;d<b;d++){e=jQuery(this.de.posts[d]);postid=this.getParam("postid",e);if(postid>0&&e.data("statready")!=true&&(e.data("spongetries")===undefined||e.data("spongetries")<this.spongesettings.retries)){f.push(e.find("a.headline").attr("href"))}}return f},loadSpongeStats:function(){var b=this.getStatlessPostUrls();if(typeof sponge_client!=="undefined"){if(!this.spongestats){if(GawkerClientside.widgets.spongestatsclient!==undefined){this.spongestats=GawkerClientside.widgets.spongestatsclient[0]}}if(this.spongestats!==undefined){this.spongestats.getStats(b,this,this.insertSpongeStatsResults)}}},insertSpongeStatsResults:function(d){this.spongestats.requests_running--;var f,b,h,e,g,k,j;if(d.data===undefined){return false}for(f=0,b=this.de.posts.length;f<b;f++){e=jQuery(this.de.posts[f]);h=d.data[e.find("a.headline").attr("href")];if(h!==undefined){g=true;j=[];k=e.data("spongetries")>0?e.data("spongetries")+1:1;if(h.views!==undefined&&h.views.ready==true){e.find(".views").html(gawker_add_commas(h.views.totalViews));e.find(".uniques").html(gawker_add_commas(h.views.totalUniqueViews));if(h.views.totalViews>this.spongestats.options.views_limit){e.find(".views").addClass("highlight")}j.push(h.views.totalViews+" pageviews, "+h.views.totalUniqueViews+" visitors");e.data("views",h.views.totalViews)}else{e.find(".views").html("");e.find(".uniques").html("");g=false}if(h.comments!==undefined&&h.comments.ready==true){e.find(".comments").html(gawker_add_commas(h.comments.numComments));if(h.comments.numComments>this.spongestats.options.comments_limit){e.find(".comments").addClass("highlight")}j.push(h.comments.numComments+" posts");e.data("comments",h.comments.numComments)}else{e.find(".comments").html("");g=false}e.find(".airport").css({opacity:1});e.find(".airport:empty").css({opacity:0});e.data("statready",g);e.find(".views, .uniques, .comments").attr("title",j.join(", "));e.find(".views, .uniques, .comments").attr("alt",j.join(", "));if(g===false){e.data("spongetries",(e.data("spongetries")===undefined?1:Math.floor(e.data("spongetries"))+1))}}}if((this.spongestats.requests_running==0)&&(this.getStatlessPostUrls().length>0)){setTimeout(jQuery.proxy(this.loadSpongeStats,this),(this.spongesettings.interval*1000))}else{if(this.getStatlessPostUrls().length===0&&this.currentParams.mode==="commented"){if(this.toHideAfterSponge!==null&&this.toHideAfterSponge!==undefined){this.toHideAfterSponge.spin(false);jQuery("#pane").css("margin-bottom","34px");this.toHideAfterSponge.hide()}this.sortPostsBy("comments")}}},showSponge:function(){if(typeof sponge_client!=="undefined"){this.sponge.element.show();this.sponge.start()}},hideSponge:function(){if(this.sponge){this.sponge.element.hide();
this.sponge.stop()}},addEyeDropdownClick:function(){if(jQuery("ul:visible",this.de.pin_container).length===0){jQuery("ul",this.de.pin_container).show();jQuery("#rightbar_pin",this.de.pin_container).bind("clickoutside",function(){jQuery("#rightbar_pin_container ul").hide();jQuery("#rightbar_pin").unbind("clickoutside")})}else{jQuery("ul",this.de.pin_container).hide()}},sortPostsBy:function(d){var b=jQuery(this.de.posts).sort(function(f,e){return jQuery(e).data(d)-jQuery(f).data(d)});this.de.rightbar_list.empty().append(b)}});a.extend(a.ui.RightBarWidget,{version:"1.0",defaults:{controlClass:"rightBarControl",externalElement:".rightbar_external"}});a.widget("ui.modeDropdown",{values:{popular:"MOST POPULAR",latest:"LATEST STORIES",commented:"MOST DISCUSSED"},initialize:function(){var d=this.element,b=this.element.find("ul");widget=this;d.bind("click",function(h){var g=a(h.target).closest("a");if(!b.is(":visible")){b.show();d.one("clickoutside",function(){b.hide()})}else{b.hide()}var f=widget.getParam("cn",g);if(f){widget.set(f==="home"?"latest":f)}})},set:function(b){this.element.find("span.selected").html(this.values[b])}})})(jQuery);(function(a){a.widget("ui.RoundupSnippetWidget",{snippet:null,initialize:function(){var d={};var e=false;if(this.controls.roundup_dialog){d.roundup={el:this.controls.roundup_dialog,focus:this.controls.roundup_snippet};this.registerEventHandler(this.controls.roundup_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.roundup_form,"submit",function(){return false});e=true}if(e){var b={overlay:this.controls.overlay,panels:d,group:this.options.dialoggroup?this.options.dialoggroup:false};this.commondialogs.initDialogs(b)}this.bindDOMHandlers();this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("editorcontrols.loaded",this.loadedEventHandler.bind(this))},bindDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},authEventHandler:function(b){this.setupControls()},setupControls:function(){if(this.auth.hasLevel("authors","highest")&&this.controls.roundup_link){this.controls.roundup_link.show()}},loadedEventHandler:function(b){this.resetElements();this.setControls();this.bindDOMHandlers();this.setupControls()},handleClick:function(d){var b=this.getParam("cn",d.target);switch(b){case"roundup_link":this.setupDialog();this.commondialogs.toggleDialog({which:"roundup"});break;case"roundup_cancel":this.commondialogs.toggleDialog({which:"roundup"});break;default:return true}d.stopPropagation();d.preventDefault();return false},handleKeyUp:function(b){switch(b.keyCode){case jQuery.ui.keyCode.ESCAPE:this.commondialogs.toggleDialog();break}},handleAjaxSuccess:function(b){this.snippet=b.content;this.controls.roundup_snippet.val(this.snippet);this.controls.progress.hide();this.disableForm(false);this.controls.roundup_snippet.select()},handleAjaxFail:function(){this.snippet=null;this.controls.progress.hide();this.disableForm(false);this.controls.roundup_snippet.val("Failed to get roundup snippet. Please try again later.")},setupDialog:function(){if(this.snippet===null){var b=this.getParam("postId",this.controls.roundup_link);this.controls.roundup_snippet.val("");this.controls.progress.show();this.disableForm(true);jQuery.ajax({type:"get",url:"/index.php?op=ajax_roundupsnippet",data:"refId="+b,success:this.handleAjaxSuccess.bind(this),error:this.handleAjaxFail.bind(this)})}},disableForm:function(b){var d=(b==true);this.controls.roundup_snippet.get(0).disabled=d}});a.extend(a.ui.RoundupSnippetWidget,{version:"1.0",defaults:{controlClass:"roundup_control",externalElement:".presence_control_external",show_validation_errors:true}})})(jQuery);jQuery.extend(settings.widgets,{simpleform:{klass:"SimpleFormWidget",byselector:{"#helpMessage":{eventHandlerBuilder:function(a){return{onInit:function(b){},onHide:function(b){},onShow:function(b){},onReset:function(b){},onClick:function(b){},onAjaxSuccessPre:function(b){},onAjaxSuccess:function(b){},onAjaxFailure:function(b){},onAuthEvent:function(b){},onKeyUp:function(b){}}},terminating_el:".terminating",options:{show_validation_errors:true,action_url:"/index.php",controlClass:"helpcontrol",xhrKlass:"helpmessage"}},".newsletter_signup":{options:{show_validation_errors:true,action_url:"/index.php",controlClass:"newsletter_control",xhrKlass:"newsletter_signup",message_options:{stable:true,duration:10000},onAjaxSuccessPre:function(a){},onAjaxSuccess:function(a){var b=".cn_message."+a.data.success;jQuery(b).show();setTimeout("jQuery('#subscribeRect .cn_message').hide()",4000)}}},".authoremail":{options:{show_validation_errors:true,action_url:"/index.php?op=send_author_email",controlClass:"authoremail_control",xhrKlass:"authoremail",onInit:function(d){var b={};var e=false;var a=d.widget;if(a.controls.overlay){b.authoremail={el:a.controls.authoremail_dialog,focus:a.controls.emailfrom};e=true}if(e){a.commondialogs.initDialogs({overlay:a.controls.overlay,panels:b,group:a.options.dialoggroup?a.options.dialoggroup:false})
}},onClick:function(a){var b=a.widget.getParam("cn",jQuery(a.e.target));switch(b){case"email":if(a.widget.controls.form!==undefined){a.widget.controls.form[0].reset()}a.widget.validator.hideErrors();jQuery("#author_message_sent").hide();jQuery("#author_message_failed").hide();a.widget.commondialogs.toggleDialog({which:"authoremail"});a.e.stopPropagation();a.e.preventDefault();break;case"authoremail_cancel":if(a.widget.controls.form!==undefined){a.widget.controls.form[0].reset()}a.widget.validator.hideErrors();jQuery("#author_message_sent").hide();jQuery("#author_message_failed").hide();a.widget.commondialogs.toggleDialog({which:"authoremail"});a.e.stopPropagation();a.e.preventDefault();break;case"authoremail_submit":a.e.stopPropagation();a.e.preventDefault();if(a.widget.validator.validate()){a.widget.validator.hideErrors();jQuery("#authorcontact_spinner").spin("small");jQuery.getJSON(a.widget.options.action_url,a.widget.controls.form.serialize(),function(e,d){jQuery("#authorcontact_spinner").spin(false);if(true==e.success){jQuery("#author_message_sent").show();setTimeout(function(){a.widget.commondialogs.toggleDialog({which:"authoremail"});jQuery("#author_message_sent").hide()},3000)}else{jQuery("#author_message_failed").show()}})}else{if(a.widget.options.show_validation_errors){jQuery("#author_message_sent").hide();jQuery("#author_message_failed").hide();a.widget.validator.showErrors()}}break}}}},"#mail2container":{options:{externalElement:".presence_control_external",show_validation_errors:true,action_url:"/index.php",controlClass:"mail2control",xhrKlass:"mail2",onInit:function(d){var b={};var e=false;var a=d.widget;if(a.controls.overlay){b.mail2={el:a.controls.mail2_dialog,focus:a.controls.from};e=true}if(e){a.commondialogs.initDialogs({overlay:a.controls.overlay,panels:b,group:a.options.dialoggroup?a.options.dialoggroup:false})}a.subscribeForEvent("user.auth.",a.authEventHandler.bind(a))},onHide:function(a){},onShow:function(a){},onReset:function(a){},onPostload:function(a){a.widget.resetElements();a.widget.setControls();a.widget.tearDownEventHandler(a.widget.element,"click",a.widget.handleClick.bind(a.widget));a.widget.registerEventHandler(a.widget.element,"click",a.widget.handleClick.bind(a.widget));a.widget.controls.title.val(a.post.title.replace(/"/g,""));a.widget.controls.post_title.text(a.post.title);a.widget.controls.uri.val(a.post.canonicalPermalink)},onFrontpageload:function(a){setTimeout(jQuery.proxy(function(){a.widget.resetElements();a.widget.setControls();a.widget.tearDownEventHandler(a.widget.element,"click",a.widget.handleClick.bind(a.widget));a.widget.registerEventHandler(a.widget.element,"click",a.widget.handleClick.bind(a.widget));a.widget.controls.title.val(jQuery(".permalink h1.headline").text().replace(/"/g,""));a.widget.controls.post_title.text(jQuery(".permalink h1.headline").text());a.widget.controls.uri.val(jQuery(".permalink h1.headline a").attr("href"))},this),1000)},onClick:function(a){var b=a.widget.getParam("cn",jQuery(a.e.target));switch(b){case"cancel":case"toggle":if(a.widget.controls.form!==undefined){a.widget.controls.form[0].reset()}a.widget.validator.hideErrors();a.widget.commondialogs.toggleDialog({which:"mail2"});a.e.stopPropagation();a.e.preventDefault();break}},onAjaxSuccess:function(a){if(true==a.data.success){setTimeout(function(){a.widget.commondialogs.toggleDialog({which:"mail2"})},3000)}},onAjaxFailure:function(a){},onAuthEvent:function(a){a.widget.controls.token[0].value=a.widget.auth.mail2token},onKeyUp:function(a){switch(a.e.keyCode){case jQuery.ui.keyCode.ESCAPE:a.widget.commondialogs.toggleDialog();break}}}},".surveyform":{eventHandlerBuilder:function(a){return{onInit:function(b){},onHide:function(b){},onShow:function(b){var d=b.widget.getParam("cookie");if(true==jQuery.cookie(d)){b.widget.controls.message[0].innerHTML="You took this survey earlier."}else{b.widget.controls.form.show()}},onReset:function(b){},onClick:function(b){},onAjaxSuccess:function(b){if(true==b.data.success){b.widget.controls.form.hide()}},onAjaxFailure:function(b){},onAuthEvent:function(b){},onKeyUp:function(b){}}},terminating_el:".terminating",options:{show_validation_errors:true,action_url:"/index.php",controlClass:"surveycontrol",xhrKlass:"survey"}}}}});(function(a){a.widget("ui.SimpleFormWidget",{validator:null,xhr:null,initialize:function(){this.registerEventHandler(this.controls.form,"submit",this.handleSubmit.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.registerEventHandler(this.controls.form,"keyup",this.handleKeyUp.bind(this));this.subscribeForEvent("maincontent.postloaded",this.handlePostload.bind(this));this.subscribeForEvent("maincontent.frontpageloaded",this.handleFrontpageload.bind(this));this.validator=new Validator(jQuery.extend({},{scope:this.controls.form}));this.xhr=new XHR({klass:this.options.xhrKlass,beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});
this.fireEvent("onInit",{widget:this})},handleSubmit:function(b){this.validator.hideErrors();if(this.validator.validate()){this.xhr.send(this.options.action_url,jQuery(b.target).serialize())}else{if(this.options.show_validation_errors){this.validator.showErrors()}}b.preventDefault();b.stopPropagation();return false},handleClick:function(b){this.fireEvent("onClick",{e:b,widget:this})},handleAjaxRequest:function(){this.disableInputs();this.controls.indicator.show()},handleAjaxSuccess:function(d){this.fireEvent("onAjaxSuccessPre",{data:d,widget:this});var b={};if(this.options.message_options!==undefined){b=this.options.message_options}Message.showMessage(d.message,this.controls.message[0],b);this.enableInputs();this.controls.indicator.hide();this.fireEvent("onAjaxSuccess",{data:d,widget:this})},handleAjaxFail:function(){var b="Error occurred, please try again later.";Message.showMessage(b,this.controls.message[0]);this.controls.indicator.hide();this.enableInputs();this.fireEvent("onAjaxFailure",{widget:this})},authEventHandler:function(b){this.fireEvent("onAuthEvent",{ev:b,widget:this})},handleKeyUp:function(b){this.fireEvent("onKeyUp",{e:b,widget:this})},hideWidget:function(){this.fireEvent("onHide",{widget:this})},showWidget:function(){this.fireEvent("onShow",{widget:this})},resetWidget:function(){this.fireEvent("onReset",{widget:this})},clearInputs:function(){jQuery("input:text, textarea",this.element).each(function(d,b){b.value=""})},disableInputs:function(){jQuery("input, textarea, select",this.element).each(function(d,b){b.disabled=true})},enableInputs:function(){jQuery("input, textarea, select",this.element).each(function(d,b){b.disabled=false})},handlePostload:function(b){this.fireEvent("onPostload",{widget:this,post:b.params.data})},handleFrontpageload:function(b){this.fireEvent("onFrontpageload",{widget:this})}});a.extend(a.ui.SimpleFormWidget,{version:"1.0",defaults:{}})})(jQuery);(function(a){a.widget("ui.SplashPostWidget",{initialize:function(){this.subscribeForEvent("splashpost.sponsoredpost.",this.sponsoredPostEventHandler.bind(this));if(typeof this.options.static_version=="undefined"){this.subscribeForEvent("splashpost.load",this.loadEventHandler.bind(this));jQuery(document).ready(function(){if(window.ganjaHost!==undefined){jQuery("#debug_server_info").html(window.ganjaHost.replace(/<br.?\/>/g,"\n")+"\n")}});this.xhr=new XHR({klass:"splashpost",success:this.handleAjaxSuccess.bind(this)});this.loadContent({})}},loadContent:function(k){var j=false;if(this.isFrontpage()){jQuery("#post_date_views .frontpage_only").html("TOP STORIES").show();jQuery("#post_date_views .postpage_only").hide();if(location.hash.indexOf("#!|splash=")!=-1){var h=location.hash.match(/#\!\|splash=([0-9]+)/);if(h!==null){var k={op:"splash_post",refId:h[1]};this.xhr.send("/index.php",k);j=true}location.hash=""}if(!j){jQuery("body").removeClass("loaded").addClass("loading");var g=this.getUrlParams();var f=(g.sponsor_preview!==undefined)?parseInt(g.sponsor_preview,10):0;var b=(g.adzone!==undefined)?g.adzone:"";var d=(g.view!==undefined)?g.view:"";var e=this.options.contentPath;if(f||b||d){e="/index.php?op=splash_post";if(f){e+="&sponsor_preview="+f}if(b){e+="&adzone="+b}if(d){e+="&view="+d}e+="&pipeJsonP=splashpostloader"}this.xhr.getJsonOwn(e,"splashpostloader")}}},handleAjaxSuccess:function(b){switch(b.action){case null:b.action="splash_post";b.sucess=true;break}this.raiseEvent("navigation.loaded",{data:b});jQuery("body").removeClass("loading").addClass("loaded")},isFrontpage:function(){if(location.pathname!="/"&&location.pathname!=""){return false}if(location.hash==""||location.hash=="#!"){return true}if(location.hash.indexOf("!")!=1||location.hash.indexOf("#!|splash=")!=-1){return true}return false},sponsoredPostEventHandler:function(b){if(b.name=="splashpost.sponsoredpost.show"){this.displaySkybarSponsoredPost(b.params.sponsor_preview)}},loadEventHandler:function(b){if(b.name=="splashpost.load"){this.loadContent(b.params)}},pickRandomSponsoredPost:function(b){found=null;percent_sum=0;percents=[];b.each(function(d,e){sponsored_post_id=this.getParam("spid",jQuery(e));percent=this.getParam("percent",jQuery(e));if(typeof percent!="undefined"){percent=parseInt(percent,10)}else{percent=100}percent_sum+=percent;percents[d]={sponsored_post_id:sponsored_post_id,percent_sum:percent_sum}}.bind(this));percent_max=percent_sum>100?percent_sum:100;rand=Math.floor(Math.random()*percent_max);i=0;while(i<percents.length&&rand>percents[i]["percent_sum"]){i++}if(rand<=percents[i]["percent_sum"]){found=percents[i]["sponsored_post_id"]}return found},displaySkybarSponsoredPost:function(b){var k=jQuery(".sponsored_splash_post"),d=null,g=null,h=null;if(b!==false&&b!==undefined){d=k.filter(".spid_"+b);if(d.length===0){d=k.eq(0)}if(d.length===0){return true}jQuery("#sponsor_replaceable").replaceWith(d.show());try{var f=jQuery(".ad_tracker-rightbar-sp .ad_container",d).eq(0).attr("id").replace("ad_container_","");if(f){adRobot.runAdFromQueue(f)}}catch(j){}return true
}h=this.pickRandomSponsoredPost(k);if(h!==null){d=k.filter(".spid_"+h);jQuery("#sponsor_replaceable").replaceWith(d.show());try{var f=jQuery(".ad_tracker-rightbar-sp .ad_container",d).eq(0).attr("id").replace("ad_container_","");if(f){adRobot.runAdFromQueue(f)}}catch(j){}}}});a.extend(a.ui.SplashPostWidget,{version:"1.0",defaults:{controlClass:"sppoc"}})})(jQuery);(function(a){a.widget("ui.StatsControlWidget",{initialize:function(){jQuery("#statsControl").delegate("input","change",this.handleChange.bind(this));this.handleChange()},handleChange:function(b){jQuery.ajax({url:"/index.php?op=sitestat&"+jQuery("#statsControl").serialize(),beforeSend:function(){jQuery("#statsData").css("opacity","0.2");jQuery("#statsSpinner").spin("large")},success:function(d){jQuery("#statsData").css("opacity","1");jQuery("#statsSpinner").spin(false);if(jQuery("input:radio[name=month]:checked").val()=="true"){jQuery("#statsData").removeClass("dayview")}else{jQuery("#statsData").addClass("dayview")}jQuery("#statsData").html(d.content);jQuery("#statsData table").tablesorter({sortInitialOrder:"desc"});if(typeof(history.pushState)=="function"){history.pushState("/stats/?"+jQuery("#statsControl").serialize(),document.title,"/stats/?"+jQuery("#statsControl").serialize())}}})}})})(jQuery);
